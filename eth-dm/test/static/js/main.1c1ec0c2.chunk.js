(this["webpackJsonpeth-dm"]=this["webpackJsonpeth-dm"]||[]).push([[0],{135:function(e,t,n){"use strict";(function(e){var r=n(0),i=n(14),o=n(12),s=n(13),a=n(64),u=n(115),c=n(79),l=n(28),d=n(29),f=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),p=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&f(t,e,n);return p(t,e),t},b=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuRelay=t.DefaultPubsubTopic=t.RelayCodec=void 0;var g=b(n(935)),h=n(93),m=n(959),y=b(n(39)),O=n(275),k=v(n(276)),P=n(276);Object.defineProperty(t,"DefaultPubsubTopic",{enumerable:!0,get:function(){return P.DefaultPubsubTopic}}),Object.defineProperty(t,"RelayCodec",{enumerable:!0,get:function(){return P.RelayCodec}});var j=n(460),T=n(960),w=function(t){l(f,t);var n=d(f);function f(e,t){var r;o(this,f),(r=n.call(this,e,Object.assign(t,{globalSignaturePolicy:m.SignaturePolicy.StrictNoSign}))).heartbeat=new T.RelayHeartbeat(a(r)),r.observers={};var i=[k.RelayCodec];return Object.assign(a(r),{multicodecs:i}),(null===t||void 0===t?void 0:t.pubsubTopic)?r.pubsubTopic=t.pubsubTopic:r.pubsubTopic=k.DefaultPubsubTopic,r}return s(f,[{key:"start",value:function(){u(c(f.prototype),"start",this).call(this),this.subscribe(this.pubsubTopic)}},{key:"send",value:function(){var t=i(r.mark((function t(n){var i;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.encode(),t.next=3,u(c(f.prototype),"publish",this).call(this,this.pubsubTopic,e.from(i));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addObserver",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===n.length?(this.observers[""]||(this.observers[""]=new Set),this.observers[""].add(e)):n.forEach((function(n){t.observers[n]||(t.observers[n]=new Set),t.observers[n].add(e)}))}},{key:"deleteObserver",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===n.length?this.observers[""]&&this.observers[""].delete(e):n.forEach((function(n){t.observers[n]&&t.observers[n].delete(e)}))}},{key:"getPeers",value:function(){var e=this;return j.getRelayPeers(this,this.pubsubTopic,this._options.D,(function(t){return e.score.score(t)>=e._options.scoreThresholds.publishThreshold}))}},{key:"subscribe",value:function(e){var t=this;this.on(e,(function(e){var n=O.WakuMessage.decode(e.data);t.observers[""]&&t.observers[""].forEach((function(e){e(n)})),n.contentTopic&&t.observers[n.contentTopic]&&t.observers[n.contentTopic].forEach((function(e){e(n)}))})),u(c(f.prototype),"subscribe",this).call(this,e)}},{key:"join",value:function(e){var t,n=this;if(!this.started)throw new Error("WakuRelayPubsub has not started");var r=this.fanout.get(e);if(r)r.forEach((function(e){n.score.score(e)<0&&r.delete(e)})),r.size<this._options.D&&j.getRelayPeers(this,e,this._options.D-r.size,(function(e){return!r.has(e)&&!n.direct.has(e)&&n.score.score(e)>=0})).forEach((function(e){return r.add(e)})),this.mesh.set(e,r),this.fanout.delete(e),this.lastpub.delete(e);else{var i=j.getRelayPeers(this,e,this._options.D,(function(e){return!n.direct.has(e)&&n.score.score(e)>=0}));this.mesh.set(e,i)}null===(t=this.mesh.get(e))||void 0===t||t.forEach((function(t){n.log("JOIN: Add mesh link to %s in %s",t,e),n._sendGraft(t,e)}))}},{key:"_publish",value:function(){var e=i(r.mark((function e(t){var n,i,o,s,a=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(t),this.gossipTracer.deliverMessage(t)),n=this.getMsgId(t),i=h.messageIdToString(n),this.seenCache.put(i),this.messageCache.put(t),o=new Set,t.topicIDs.forEach((function(e){if(a.topics.get(e)){a.direct.forEach((function(e){o.add(e)}));var t=a.mesh.get(e);if(!t||!t.size){if(!(t=a.fanout.get(e))){var n=j.getRelayPeers(a,e,a._options.D,(function(e){return a.score.score(e)>=a._options.scoreThresholds.publishThreshold}));n.size>0?(t=n,a.fanout.set(e,n)):t=new Set}a.lastpub.set(e,a._now())}null===t||void 0===t||t.forEach((function(e){o.add(e)}))}})),s=h.createGossipRpc([g.default.utils.normalizeOutRpcMessage(t)]),o.forEach((function(e){e!==t.from&&a._sendRpc(e,s)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_emitGossip",value:function(e,t){var n=this,r=this.messageCache.getGossipIDs(e);if(r.length){h.shuffle(r),r.length>k.RelayMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length);var i=[],o=this.topics.get(e);if(o){o.forEach((function(e){var r=n.peers.get(e);r&&!t.has(e)&&!n.direct.has(e)&&r.protocol==k.RelayCodec&&n.score.score(e)>=n._options.scoreThresholds.gossipThreshold&&i.push(e)}));var s=this._options.Dlazy,a=k.RelayGossipFactor*i.length;a>s&&(s=a),s>i.length?s=i.length:h.shuffle(i),i.slice(0,s).forEach((function(t){var i=r;r.length>k.RelayMaxIHaveLength&&(i=h.shuffle(i.slice()).slice(0,k.RelayMaxIHaveLength)),n._pushGossip(t,{topicID:e,messageIDs:i})}))}}}},{key:"_makePrune",value:function(e,t,n){var r=this,i=k.RelayPruneBackoff/1e3,o=[];n&&j.getRelayPeers(this,t,k.RelayPrunePeers,(function(t){return t!==e&&r.score.score(t)>=0})).forEach((function(e){var t=y.default.createFromB58String(e);o.push({peerID:t.toBytes(),signedPeerRecord:r._libp2p.peerStore.addressBook.getRawEnvelope(t)})}));return{topicID:t,peers:o,backoff:i}}}]),f}(g.default);t.WakuRelay=w}).call(this,n(15).Buffer)},142:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"c",(function(){return p}));var r=n(0),i=n.n(r),o=n(34),s=n(1),a=n(88),u=n(87),c=n(95),l=n(19),d="/eth-dm/1/public-key/proto",f="/eth-dm/1/direct-message/json";function p(e){var t=e.waku,n=e.setWaku,r=e.ethDmKeyPair,i=e.setPublicKeys,o=e.setMessages,a=e.address;Object(s.useEffect)((function(){t||function(){return v.apply(this,arguments)}().then((function(e){console.log("waku: ready"),n(e)})).catch((function(e){console.error("Failed to initiate Waku",e)}))}),[t,n]);var u=g.bind({},null===r||void 0===r?void 0:r.publicKey,i),c=r&&a?h.bind({},o,r.privateKey,a):void 0;return Object(s.useEffect)((function(){if(t)return t.relay.addObserver(u,[d]),function(){t&&t.relay.deleteObserver(u,[d])}})),Object(s.useEffect)((function(){if(t&&c)return t.relay.addObserver(c,[f]),function(){t&&c&&t.relay.deleteObserver(c,[f])}})),Object(l.jsx)(l.Fragment,{})}function v(){return(v=Object(o.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.Waku.create({keepAlive:0});case 2:return t=e.sent,e.next=5,b();case 5:return n=e.sent,e.next=8,Promise.all(n.map((function(e){return t.dial(e)})));case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){var t,n;return"development"===(null===(t=e)||void 0===t||null===(n=Object({NODE_ENV:"production",PUBLIC_URL:"/js-waku/eth-dm/test",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}))||void 0===n?void 0:n.NODE_ENV)?Object(a.getStatusFleetNodes)(a.Environment.Test):Object(a.getStatusFleetNodes)(a.Environment.Prod)}function g(e,t,n){if(console.log("Public Key Message received:",n),n.payload){var r=u.a.decode(n.payload);if(r){var i=Object(u.b)(r.ethDmPublicKey);if(i!==e){var o=Object(c.e)(r);console.log("Is Public Key Message valid?",o),t((function(e){return e.set(Object(u.b)(r.ethAddress),i),new Map(e)}))}}}}function h(e,t,n,r){return m.apply(this,arguments)}function m(){return(m=Object(o.a)(i.a.mark((function e(t,n,r,o){var s,a,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Direct Message received:",o),o.payload){e.next=3;break}return e.abrupt("return");case 3:if((s=Object(u.c)(o.payload)).toAddress!==r){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Object(c.b)(n,s);case 8:a=e.sent,l=o.timestamp?o.timestamp:new Date,console.log("Message decrypted:",a),t((function(e){var t=e.slice();return t.push({text:a,timestamp:l}),t}));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,n(42))},202:function(e,t,n){"use strict";(function(e){var r=n(24),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuMessage=t.protobufPackage=void 0;var o=i(n(201)),s=i(n(49));t.protobufPackage="waku.v2";var a={};t.WakuMessage={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return void 0!==e.payload&&t.uint32(10).bytes(e.payload),void 0!==e.contentTopic&&t.uint32(18).string(e.contentTopic),void 0!==e.version&&t.uint32(24).uint32(e.version),void 0!==e.timestamp&&t.uint32(33).double(e.timestamp),t},decode:function(e,t){for(var n=e instanceof s.default.Reader?e:new s.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},a);n.pos<r;){var o=n.uint32();switch(o>>>3){case 1:i.payload=n.bytes();break;case 2:i.contentTopic=n.string();break;case 3:i.version=n.uint32();break;case 4:i.timestamp=n.double();break;default:n.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},a);return void 0!==e.payload&&null!==e.payload&&(t.payload=function(e){for(var t=c(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}(e.payload)),void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=String(e.contentTopic):t.contentTopic=void 0,void 0!==e.version&&null!==e.version?t.version=Number(e.version):t.version=void 0,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=Number(e.timestamp):t.timestamp=void 0,t},toJSON:function(e){var t={};return void 0!==e.payload&&(t.payload=void 0!==e.payload?function(e){var t,n=[],i=r(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n.push(String.fromCharCode(o))}}catch(s){i.e(s)}finally{i.f()}return l(n.join(""))}(e.payload):void 0),void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),void 0!==e.version&&(t.version=e.version),void 0!==e.timestamp&&(t.timestamp=e.timestamp),t},fromPartial:function(e){var t=Object.assign({},a);return void 0!==e.payload&&null!==e.payload?t.payload=e.payload:t.payload=void 0,void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=e.contentTopic:t.contentTopic=void 0,void 0!==e.version&&null!==e.version?t.version=e.version:t.version=void 0,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=e.timestamp:t.timestamp=void 0,t}};var u=function(){if("undefined"!==typeof u)return u;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),c=u.atob||function(e){return u.Buffer.from(e,"base64").toString("binary")};var l=u.btoa||function(e){return u.Buffer.from(e,"binary").toString("base64")};s.default.util.Long!==o.default&&(s.default.util.Long=o.default,s.default.configure())}).call(this,n(36))},206:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return u}));var r=n(0),i=n.n(r),o=n(34);function s(e,t){return a.apply(this,arguments)}function a(){return(a=Object(o.a)(i.a.mark((function t(n,r){var o,s,a,u,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f(n,r);case 2:o=t.sent,s=o.salt,a=o.iv,u=o.cipher,c={salt:new e(s).toString("hex"),iv:new e(a).toString("hex"),cipher:new e(u).toString("hex")},localStorage.setItem("cipherEthDmKeyPair",JSON.stringify(c));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function u(e){return c.apply(this,arguments)}function c(){return(c=Object(o.a)(i.a.mark((function t(n){var r,o,s,a,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=localStorage.getItem("cipherEthDmKeyPair")){t.next=3;break}return t.abrupt("return");case 3:return o=JSON.parse(r),s=new e(o.salt,"hex"),a=new e(o.iv,"hex"),u=new e(o.cipher,"hex"),t.next=9,v(s,a,u,n);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function l(e){var t=new TextEncoder;return window.crypto.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}function d(e,t){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}function f(e,t){return p.apply(this,arguments)}function p(){return(p=Object(o.a)(i.a.mark((function e(t,n){var r,o,s,a,u,c,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(n);case 2:return r=e.sent,o=window.crypto.getRandomValues(new Uint8Array(16)),e.next=6,d(r,o);case 6:return s=e.sent,a=new TextEncoder,u=a.encode(JSON.stringify(t)),c=window.crypto.getRandomValues(new Uint8Array(12)),e.next=12,window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},s,u);case 12:return f=e.sent,e.abrupt("return",{salt:o,iv:c,cipher:f});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t,n,r){return b.apply(this,arguments)}function b(){return(b=Object(o.a)(i.a.mark((function e(t,n,r,o){var s,a,u,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(o);case 2:return s=e.sent,e.next=5,d(s,t);case 5:return a=e.sent,e.prev=6,e.next=9,window.crypto.subtle.decrypt({name:"AES-GCM",iv:n},a,r);case 9:return u=e.sent,c=new TextDecoder,e.abrupt("return",JSON.parse(c.decode(u)));case 14:return e.prev=14,e.t0=e.catch(6),e.abrupt("return");case 17:case"end":return e.stop()}}),e,null,[[6,14]])})))).apply(this,arguments)}}).call(this,n(15).Buffer)},255:function(e,t){},275:function(e,t,n){"use strict";(function(e){var r=n(12),i=n(13),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuMessage=t.DefaultContentTopic=void 0;var u=n(49),c=a(n(202));t.DefaultContentTopic="/waku/2/default-content/proto";var l=function(){function n(e){r(this,n),this.proto=e}return i(n,[{key:"encode",value:function(){return c.WakuMessage.encode(this.proto).finish()}},{key:"payloadAsUtf8",get:function(){return this.proto.payload?Array.from(this.proto.payload).map((function(e){return String.fromCharCode(e)})).join(""):""}},{key:"payload",get:function(){return this.proto.payload}},{key:"contentTopic",get:function(){return this.proto.contentTopic}},{key:"version",get:function(){return this.proto.version}},{key:"timestamp",get:function(){if(this.proto.timestamp)return new Date(1e3*this.proto.timestamp)}}],[{key:"fromUtf8String",value:function(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DefaultContentTopic,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,s=e.from(r,"utf-8");return new n({payload:s,version:0,contentTopic:i,timestamp:o.valueOf()/1e3})}},{key:"fromBytes",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DefaultContentTopic,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date;return new n({payload:e,timestamp:i.valueOf()/1e3,version:0,contentTopic:r})}},{key:"decode",value:function(e){return new n(c.WakuMessage.decode(u.Reader.create(e)))}}]),n}();t.WakuMessage=l}).call(this,n(15).Buffer)},276:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RelayMaxIHaveLength=t.RelayOpportunisticGraftPeers=t.RelayOpportunisticGraftTicks=t.RelayFanoutTTL=t.RelayPruneBackoff=t.RelayPrunePeers=t.RelayHeartbeatInterval=t.RelayHeartbeatInitialDelay=t.RelayGossipFactor=t.DefaultPubsubTopic=t.RelayCodec=t.minute=t.second=void 0,t.second=1e3,t.minute=60*t.second,t.RelayCodec="/vac/waku/relay/2.0.0-beta2",t.DefaultPubsubTopic="/waku/2/default-waku/proto",t.RelayGossipFactor=.25,t.RelayHeartbeatInitialDelay=100,t.RelayHeartbeatInterval=t.second,t.RelayPrunePeers=16,t.RelayPruneBackoff=t.minute,t.RelayFanoutTTL=t.minute,t.RelayOpportunisticGraftTicks=60,t.RelayOpportunisticGraftPeers=2,t.RelayMaxIHaveLength=5e3},451:function(e,t,n){"use strict";var r=n(0),i=n(14),o=n(12),s=n(13),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuLightPush=t.PushResponse=t.LightPushCodec=void 0;var u=a(n(452)),c=a(n(92)),l=a(n(66)),d=n(453);Object.defineProperty(t,"PushResponse",{enumerable:!0,get:function(){return d.PushResponse}});var f=n(454),p=n(135),v=n(961);t.LightPushCodec="/vac/waku/lightpush/2.0.0-beta1";var b=function(){function e(t,n){o(this,e),this.libp2p=t,(null===n||void 0===n?void 0:n.pubsubTopic)?this.pubsubTopic=n.pubsubTopic:this.pubsubTopic=p.DefaultPubsubTopic}return s(e,[{key:"push",value:function(){var e=i(r.mark((function e(n,i){var o,s,a,d,p,b,g,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===i||void 0===i?void 0:i.peerId)){e.next=6;break}if(o=this.libp2p.peerStore.get(i.peerId)){e.next=4;break}throw"Peer is unknown";case 4:e.next=7;break;case 6:o=f.selectRandomPeer(this.libp2p,t.LightPushCodec);case 7:if(o){e.next=9;break}throw"No peer available";case 9:if(o.protocols.includes(t.LightPushCodec)){e.next=11;break}throw"Peer does not register waku light push protocol";case 11:if(s=this.libp2p.connectionManager.get(o.id)){e.next=14;break}throw"Failed to get a connection to the peer";case 14:return e.next=16,s.newStream(t.LightPushCodec);case 16:return a=e.sent,d=a.stream,e.prev=18,p=(null===i||void 0===i?void 0:i.pubsubTopic)?i.pubsubTopic:this.pubsubTopic,b=v.PushRPC.createRequest(n,p),e.next=23,l.default([b.encode()],c.default.encode(),d,c.default.decode(),u.default);case 23:if(g=e.sent,e.prev=24,h=v.PushRPC.decode(g.slice()).response){e.next=29;break}return console.log("No response in PushRPC"),e.abrupt("return",null);case 29:return e.abrupt("return",h);case 32:e.prev=32,e.t0=e.catch(24),console.log("Failed to decode push reply",e.t0);case 35:e.next=40;break;case 37:e.prev=37,e.t1=e.catch(18),console.log("Failed to send waku light push request",e.t1);case 40:return e.abrupt("return",null);case 41:case"end":return e.stop()}}),e,this,[[18,37],[24,32]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.WakuLightPush=b},453:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PushRPC=t.PushResponse=t.PushRequest=t.protobufPackage=void 0;var i=r(n(201)),o=r(n(49)),s=n(202);t.protobufPackage="waku.v2";var a={pubsubTopic:""};t.PushRequest={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.default.Writer.create();return""!==e.pubsubTopic&&t.uint32(10).string(e.pubsubTopic),void 0!==e.message&&s.WakuMessage.encode(e.message,t.uint32(18).fork()).ldelim(),t},decode:function(e,t){for(var n=e instanceof o.default.Reader?e:new o.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},a);n.pos<r;){var u=n.uint32();switch(u>>>3){case 1:i.pubsubTopic=n.string();break;case 2:i.message=s.WakuMessage.decode(n,n.uint32());break;default:n.skipType(7&u)}}return i},fromJSON:function(e){var t=Object.assign({},a);return void 0!==e.pubsubTopic&&null!==e.pubsubTopic?t.pubsubTopic=String(e.pubsubTopic):t.pubsubTopic="",void 0!==e.message&&null!==e.message?t.message=s.WakuMessage.fromJSON(e.message):t.message=void 0,t},toJSON:function(e){var t={};return void 0!==e.pubsubTopic&&(t.pubsubTopic=e.pubsubTopic),void 0!==e.message&&(t.message=e.message?s.WakuMessage.toJSON(e.message):void 0),t},fromPartial:function(e){var t=Object.assign({},a);return void 0!==e.pubsubTopic&&null!==e.pubsubTopic?t.pubsubTopic=e.pubsubTopic:t.pubsubTopic="",void 0!==e.message&&null!==e.message?t.message=s.WakuMessage.fromPartial(e.message):t.message=void 0,t}};var u={isSuccess:!1,info:""};t.PushResponse={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.default.Writer.create();return!0===e.isSuccess&&t.uint32(8).bool(e.isSuccess),""!==e.info&&t.uint32(18).string(e.info),t},decode:function(e,t){for(var n=e instanceof o.default.Reader?e:new o.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},u);n.pos<r;){var s=n.uint32();switch(s>>>3){case 1:i.isSuccess=n.bool();break;case 2:i.info=n.string();break;default:n.skipType(7&s)}}return i},fromJSON:function(e){var t=Object.assign({},u);return void 0!==e.isSuccess&&null!==e.isSuccess?t.isSuccess=Boolean(e.isSuccess):t.isSuccess=!1,void 0!==e.info&&null!==e.info?t.info=String(e.info):t.info="",t},toJSON:function(e){var t={};return void 0!==e.isSuccess&&(t.isSuccess=e.isSuccess),void 0!==e.info&&(t.info=e.info),t},fromPartial:function(e){var t=Object.assign({},u);return void 0!==e.isSuccess&&null!==e.isSuccess?t.isSuccess=e.isSuccess:t.isSuccess=!1,void 0!==e.info&&null!==e.info?t.info=e.info:t.info="",t}};var c={requestId:""};t.PushRPC={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.default.Writer.create();return""!==e.requestId&&n.uint32(10).string(e.requestId),void 0!==e.request&&t.PushRequest.encode(e.request,n.uint32(18).fork()).ldelim(),void 0!==e.response&&t.PushResponse.encode(e.response,n.uint32(26).fork()).ldelim(),n},decode:function(e,n){for(var r=e instanceof o.default.Reader?e:new o.default.Reader(e),i=void 0===n?r.len:r.pos+n,s=Object.assign({},c);r.pos<i;){var a=r.uint32();switch(a>>>3){case 1:s.requestId=r.string();break;case 2:s.request=t.PushRequest.decode(r,r.uint32());break;case 3:s.response=t.PushResponse.decode(r,r.uint32());break;default:r.skipType(7&a)}}return s},fromJSON:function(e){var n=Object.assign({},c);return void 0!==e.requestId&&null!==e.requestId?n.requestId=String(e.requestId):n.requestId="",void 0!==e.request&&null!==e.request?n.request=t.PushRequest.fromJSON(e.request):n.request=void 0,void 0!==e.response&&null!==e.response?n.response=t.PushResponse.fromJSON(e.response):n.response=void 0,n},toJSON:function(e){var n={};return void 0!==e.requestId&&(n.requestId=e.requestId),void 0!==e.request&&(n.request=e.request?t.PushRequest.toJSON(e.request):void 0),void 0!==e.response&&(n.response=e.response?t.PushResponse.toJSON(e.response):void 0),n},fromPartial:function(e){var n=Object.assign({},c);return void 0!==e.requestId&&null!==e.requestId?n.requestId=e.requestId:n.requestId="",void 0!==e.request&&null!==e.request?n.request=t.PushRequest.fromPartial(e.request):n.request=void 0,void 0!==e.response&&null!==e.response?n.response=t.PushResponse.fromPartial(e.response):n.response=void 0,n}},o.default.util.Long!==i.default&&(o.default.util.Long=i.default,o.default.configure())},454:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.selectRandomPeer=void 0,t.selectRandomPeer=function(e,t){var n=Array.from(e.peerStore.peers.values()),r=n.length;if(0!==n.filter((function(e){return e.protocols.includes(t)})).length)return n[Math.round(Math.random()*(r-1))]}},460:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRelayPeers=void 0;var r=n(93),i=n(135);t.getRelayPeers=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},s=e.topics.get(t);if(!s)return new Set;var a=[];return s.forEach((function(t){var n=e.peers.get(t);n&&n.protocol==i.RelayCodec&&o(t)&&a.push(t)})),a=r.shuffle(a),n>0&&a.length>n&&(a=a.slice(0,n)),new Set(a)}},461:function(e,t,n){"use strict";var r=n(0),i=n(14),o=n(12),s=n(13),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuStore=t.Direction=t.StoreCodec=void 0;var u=a(n(452)),c=a(n(92)),l=a(n(66)),d=n(454),f=n(275),p=n(135),v=n(962);Object.defineProperty(t,"Direction",{enumerable:!0,get:function(){return v.Direction}}),t.StoreCodec="/vac/waku/store/2.0.0-beta3";var b=function(){function e(t,n){o(this,e),this.libp2p=t,(null===n||void 0===n?void 0:n.pubsubTopic)?this.pubsubTopic=n.pubsubTopic:this.pubsubTopic=p.DefaultPubsubTopic}return s(e,[{key:"queryHistory",value:function(){var e=i(r.mark((function e(n){var i,o,s,a,p,b,g,h,m,y,O,k,P,j,T,w,_,S,R;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(p=Object.assign({pubsubTopic:this.pubsubTopic,direction:v.Direction.BACKWARD,pageSize:10},n)).peerId){e.next=7;break}if(b=this.libp2p.peerStore.get(p.peerId)){e.next=5;break}throw"Peer is unknown";case 5:e.next=8;break;case 7:b=d.selectRandomPeer(this.libp2p,t.StoreCodec);case 8:if(b){e.next=10;break}throw"No peer available";case 10:if(b.protocols.includes(t.StoreCodec)){e.next=12;break}throw"Peer does not register waku store protocol";case 12:if(g=this.libp2p.connectionManager.get(b.id)){e.next=15;break}throw"Failed to get a connection to the peer";case 15:h=[],m=void 0;case 17:return e.prev=18,e.next=21,g.newStream(t.StoreCodec);case 21:return y=e.sent,O=y.stream,e.prev=23,k=Object.assign(p,{cursor:m}),P=v.HistoryRPC.createQuery(k),e.next=28,l.default([P.encode()],c.default.encode(),O,c.default.decode(),u.default);case 28:if(j=e.sent,e.prev=29,T=v.HistoryRPC.decode(j.slice()),w=T.response){e.next=35;break}return console.log("No response in HistoryRPC"),e.abrupt("return",null);case 35:if(w.messages&&w.messages.length){e.next=38;break}return console.log("No messages present in HistoryRPC response"),e.abrupt("return",h);case 38:if(_=w.messages.map((function(e){return new f.WakuMessage(e)})),p.callback&&p.callback(_),_.forEach((function(e){h.push(e)})),S=null===(i=w.pagingInfo)||void 0===i?void 0:i.pageSize,R=null===(s=null===(o=P.query)||void 0===o?void 0:o.pagingInfo)||void 0===s?void 0:s.pageSize,!(S&&R&&S<R)){e.next=45;break}return e.abrupt("return",h);case 45:if(void 0!==(m=null===(a=w.pagingInfo)||void 0===a?void 0:a.cursor)){e.next=49;break}return console.log("No cursor returned by peer."),e.abrupt("return",h);case 49:e.next=54;break;case 51:e.prev=51,e.t0=e.catch(29),console.log("Failed to decode store reply",e.t0);case 54:e.next=59;break;case 56:e.prev=56,e.t1=e.catch(23),console.log("Failed to send waku store query",e.t1);case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(18),console.log("Failed to negotiate waku store protocol stream with peer",e.t2);case 64:e.next=17;break;case 66:case"end":return e.stop()}}),e,this,[[18,61],[23,56],[29,51]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.WakuStore=b},462:function(e,t,n){"use strict";(function(e){var r=n(24),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.HistoryResponse=t.HistoryQuery=t.ContentFilter=t.PagingInfo=t.Index=t.pagingInfo_DirectionToJSON=t.pagingInfo_DirectionFromJSON=t.PagingInfo_Direction=t.protobufPackage=void 0;var o,s=i(n(201)),a=i(n(49)),u=n(202);function c(e){switch(e){case 0:case"DIRECTION_BACKWARD_UNSPECIFIED":return o.DIRECTION_BACKWARD_UNSPECIFIED;case 1:case"DIRECTION_FORWARD":return o.DIRECTION_FORWARD;case-1:case"UNRECOGNIZED":default:return o.UNRECOGNIZED}}function l(e){switch(e){case o.DIRECTION_BACKWARD_UNSPECIFIED:return"DIRECTION_BACKWARD_UNSPECIFIED";case o.DIRECTION_FORWARD:return"DIRECTION_FORWARD";default:return"UNKNOWN"}}t.protobufPackage="waku.v2",function(e){e[e.DIRECTION_BACKWARD_UNSPECIFIED=0]="DIRECTION_BACKWARD_UNSPECIFIED",e[e.DIRECTION_FORWARD=1]="DIRECTION_FORWARD",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(o=t.PagingInfo_Direction||(t.PagingInfo_Direction={})),t.pagingInfo_DirectionFromJSON=c,t.pagingInfo_DirectionToJSON=l;var d={receivedTime:0};t.Index={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.default.Writer.create();return 0!==e.digest.length&&t.uint32(10).bytes(e.digest),0!==e.receivedTime&&t.uint32(17).double(e.receivedTime),t},decode:function(e,t){var n=e instanceof a.default.Reader?e:new a.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},d);for(i.digest=new Uint8Array;n.pos<r;){var o=n.uint32();switch(o>>>3){case 1:i.digest=n.bytes();break;case 2:i.receivedTime=n.double();break;default:n.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},d);return t.digest=new Uint8Array,void 0!==e.digest&&null!==e.digest&&(t.digest=function(e){for(var t=m(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}(e.digest)),void 0!==e.receivedTime&&null!==e.receivedTime?t.receivedTime=Number(e.receivedTime):t.receivedTime=0,t},toJSON:function(e){var t={};return void 0!==e.digest&&(t.digest=function(e){var t,n=[],i=r(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n.push(String.fromCharCode(o))}}catch(s){i.e(s)}finally{i.f()}return y(n.join(""))}(void 0!==e.digest?e.digest:new Uint8Array)),void 0!==e.receivedTime&&(t.receivedTime=e.receivedTime),t},fromPartial:function(e){var t=Object.assign({},d);return void 0!==e.digest&&null!==e.digest?t.digest=e.digest:t.digest=new Uint8Array,void 0!==e.receivedTime&&null!==e.receivedTime?t.receivedTime=e.receivedTime:t.receivedTime=0,t}};var f={pageSize:0,direction:0};t.PagingInfo={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.default.Writer.create();return 0!==e.pageSize&&n.uint32(8).uint64(e.pageSize),void 0!==e.cursor&&t.Index.encode(e.cursor,n.uint32(18).fork()).ldelim(),0!==e.direction&&n.uint32(24).int32(e.direction),n},decode:function(e,n){for(var r=e instanceof a.default.Reader?e:new a.default.Reader(e),i=void 0===n?r.len:r.pos+n,o=Object.assign({},f);r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.pageSize=O(r.uint64());break;case 2:o.cursor=t.Index.decode(r,r.uint32());break;case 3:o.direction=r.int32();break;default:r.skipType(7&s)}}return o},fromJSON:function(e){var n=Object.assign({},f);return void 0!==e.pageSize&&null!==e.pageSize?n.pageSize=Number(e.pageSize):n.pageSize=0,void 0!==e.cursor&&null!==e.cursor?n.cursor=t.Index.fromJSON(e.cursor):n.cursor=void 0,void 0!==e.direction&&null!==e.direction?n.direction=c(e.direction):n.direction=0,n},toJSON:function(e){var n={};return void 0!==e.pageSize&&(n.pageSize=e.pageSize),void 0!==e.cursor&&(n.cursor=e.cursor?t.Index.toJSON(e.cursor):void 0),void 0!==e.direction&&(n.direction=l(e.direction)),n},fromPartial:function(e){var n=Object.assign({},f);return void 0!==e.pageSize&&null!==e.pageSize?n.pageSize=e.pageSize:n.pageSize=0,void 0!==e.cursor&&null!==e.cursor?n.cursor=t.Index.fromPartial(e.cursor):n.cursor=void 0,void 0!==e.direction&&null!==e.direction?n.direction=e.direction:n.direction=0,n}};var p={contentTopic:""};t.ContentFilter={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.default.Writer.create();return""!==e.contentTopic&&t.uint32(10).string(e.contentTopic),t},decode:function(e,t){for(var n=e instanceof a.default.Reader?e:new a.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},p);n.pos<r;){var o=n.uint32();switch(o>>>3){case 1:i.contentTopic=n.string();break;default:n.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},p);return void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=String(e.contentTopic):t.contentTopic="",t},toJSON:function(e){var t={};return void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),t},fromPartial:function(e){var t=Object.assign({},p);return void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=e.contentTopic:t.contentTopic="",t}};var v={};t.HistoryQuery={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.default.Writer.create();void 0!==e.pubsubTopic&&n.uint32(18).string(e.pubsubTopic);var i,o=r(e.contentFilters);try{for(o.s();!(i=o.n()).done;){var s=i.value;t.ContentFilter.encode(s,n.uint32(26).fork()).ldelim()}}catch(u){o.e(u)}finally{o.f()}return void 0!==e.pagingInfo&&t.PagingInfo.encode(e.pagingInfo,n.uint32(34).fork()).ldelim(),void 0!==e.startTime&&n.uint32(41).double(e.startTime),void 0!==e.endTime&&n.uint32(49).double(e.endTime),n},decode:function(e,n){var r=e instanceof a.default.Reader?e:new a.default.Reader(e),i=void 0===n?r.len:r.pos+n,o=Object.assign({},v);for(o.contentFilters=[];r.pos<i;){var s=r.uint32();switch(s>>>3){case 2:o.pubsubTopic=r.string();break;case 3:o.contentFilters.push(t.ContentFilter.decode(r,r.uint32()));break;case 4:o.pagingInfo=t.PagingInfo.decode(r,r.uint32());break;case 5:o.startTime=r.double();break;case 6:o.endTime=r.double();break;default:r.skipType(7&s)}}return o},fromJSON:function(e){var n=Object.assign({},v);if(n.contentFilters=[],void 0!==e.pubsubTopic&&null!==e.pubsubTopic?n.pubsubTopic=String(e.pubsubTopic):n.pubsubTopic=void 0,void 0!==e.contentFilters&&null!==e.contentFilters){var i,o=r(e.contentFilters);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.contentFilters.push(t.ContentFilter.fromJSON(s))}}catch(a){o.e(a)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromJSON(e.pagingInfo):n.pagingInfo=void 0,void 0!==e.startTime&&null!==e.startTime?n.startTime=Number(e.startTime):n.startTime=void 0,void 0!==e.endTime&&null!==e.endTime?n.endTime=Number(e.endTime):n.endTime=void 0,n},toJSON:function(e){var n={};return void 0!==e.pubsubTopic&&(n.pubsubTopic=e.pubsubTopic),e.contentFilters?n.contentFilters=e.contentFilters.map((function(e){return e?t.ContentFilter.toJSON(e):void 0})):n.contentFilters=[],void 0!==e.pagingInfo&&(n.pagingInfo=e.pagingInfo?t.PagingInfo.toJSON(e.pagingInfo):void 0),void 0!==e.startTime&&(n.startTime=e.startTime),void 0!==e.endTime&&(n.endTime=e.endTime),n},fromPartial:function(e){var n=Object.assign({},v);if(n.contentFilters=[],void 0!==e.pubsubTopic&&null!==e.pubsubTopic?n.pubsubTopic=e.pubsubTopic:n.pubsubTopic=void 0,void 0!==e.contentFilters&&null!==e.contentFilters){var i,o=r(e.contentFilters);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.contentFilters.push(t.ContentFilter.fromPartial(s))}}catch(a){o.e(a)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromPartial(e.pagingInfo):n.pagingInfo=void 0,void 0!==e.startTime&&null!==e.startTime?n.startTime=e.startTime:n.startTime=void 0,void 0!==e.endTime&&null!==e.endTime?n.endTime=e.endTime:n.endTime=void 0,n}};var b={};t.HistoryResponse={encode:function(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.default.Writer.create(),o=r(e.messages);try{for(o.s();!(n=o.n()).done;){var s=n.value;u.WakuMessage.encode(s,i.uint32(10).fork()).ldelim()}}catch(c){o.e(c)}finally{o.f()}return void 0!==e.pagingInfo&&t.PagingInfo.encode(e.pagingInfo,i.uint32(18).fork()).ldelim(),i},decode:function(e,n){var r=e instanceof a.default.Reader?e:new a.default.Reader(e),i=void 0===n?r.len:r.pos+n,o=Object.assign({},b);for(o.messages=[];r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.messages.push(u.WakuMessage.decode(r,r.uint32()));break;case 2:o.pagingInfo=t.PagingInfo.decode(r,r.uint32());break;default:r.skipType(7&s)}}return o},fromJSON:function(e){var n=Object.assign({},b);if(n.messages=[],void 0!==e.messages&&null!==e.messages){var i,o=r(e.messages);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.messages.push(u.WakuMessage.fromJSON(s))}}catch(a){o.e(a)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromJSON(e.pagingInfo):n.pagingInfo=void 0,n},toJSON:function(e){var n={};return e.messages?n.messages=e.messages.map((function(e){return e?u.WakuMessage.toJSON(e):void 0})):n.messages=[],void 0!==e.pagingInfo&&(n.pagingInfo=e.pagingInfo?t.PagingInfo.toJSON(e.pagingInfo):void 0),n},fromPartial:function(e){var n=Object.assign({},b);if(n.messages=[],void 0!==e.messages&&null!==e.messages){var i,o=r(e.messages);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.messages.push(u.WakuMessage.fromPartial(s))}}catch(a){o.e(a)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromPartial(e.pagingInfo):n.pagingInfo=void 0,n}};var g={requestId:""};t.HistoryRPC={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.default.Writer.create();return""!==e.requestId&&n.uint32(10).string(e.requestId),void 0!==e.query&&t.HistoryQuery.encode(e.query,n.uint32(18).fork()).ldelim(),void 0!==e.response&&t.HistoryResponse.encode(e.response,n.uint32(26).fork()).ldelim(),n},decode:function(e,n){for(var r=e instanceof a.default.Reader?e:new a.default.Reader(e),i=void 0===n?r.len:r.pos+n,o=Object.assign({},g);r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.requestId=r.string();break;case 2:o.query=t.HistoryQuery.decode(r,r.uint32());break;case 3:o.response=t.HistoryResponse.decode(r,r.uint32());break;default:r.skipType(7&s)}}return o},fromJSON:function(e){var n=Object.assign({},g);return void 0!==e.requestId&&null!==e.requestId?n.requestId=String(e.requestId):n.requestId="",void 0!==e.query&&null!==e.query?n.query=t.HistoryQuery.fromJSON(e.query):n.query=void 0,void 0!==e.response&&null!==e.response?n.response=t.HistoryResponse.fromJSON(e.response):n.response=void 0,n},toJSON:function(e){var n={};return void 0!==e.requestId&&(n.requestId=e.requestId),void 0!==e.query&&(n.query=e.query?t.HistoryQuery.toJSON(e.query):void 0),void 0!==e.response&&(n.response=e.response?t.HistoryResponse.toJSON(e.response):void 0),n},fromPartial:function(e){var n=Object.assign({},g);return void 0!==e.requestId&&null!==e.requestId?n.requestId=e.requestId:n.requestId="",void 0!==e.query&&null!==e.query?n.query=t.HistoryQuery.fromPartial(e.query):n.query=void 0,void 0!==e.response&&null!==e.response?n.response=t.HistoryResponse.fromPartial(e.response):n.response=void 0,n}};var h=function(){if("undefined"!==typeof h)return h;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),m=h.atob||function(e){return h.Buffer.from(e,"base64").toString("binary")};var y=h.btoa||function(e){return h.Buffer.from(e,"binary").toString("base64")};function O(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new h.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}a.default.util.Long!==s.default&&(a.default.util.Long=s.default,a.default.configure())}).call(this,n(36))},463:function(e,t,n){"use strict";(function(e){var r=n(24),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessage=t.protobufPackage=void 0;var o=i(n(201)),s=i(n(49));t.protobufPackage="chat.v2";var a={timestamp:0,nick:""};t.ChatMessage={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return 0!==e.timestamp&&t.uint32(8).uint64(e.timestamp),""!==e.nick&&t.uint32(18).string(e.nick),0!==e.payload.length&&t.uint32(26).bytes(e.payload),t},decode:function(e,t){var n=e instanceof s.default.Reader?e:new s.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},a);for(i.payload=new Uint8Array;n.pos<r;){var o=n.uint32();switch(o>>>3){case 1:i.timestamp=d(n.uint64());break;case 2:i.nick=n.string();break;case 3:i.payload=n.bytes();break;default:n.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},a);return t.payload=new Uint8Array,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=Number(e.timestamp):t.timestamp=0,void 0!==e.nick&&null!==e.nick?t.nick=String(e.nick):t.nick="",void 0!==e.payload&&null!==e.payload&&(t.payload=function(e){for(var t=c(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}(e.payload)),t},toJSON:function(e){var t={};return void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.nick&&(t.nick=e.nick),void 0!==e.payload&&(t.payload=function(e){var t,n=[],i=r(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n.push(String.fromCharCode(o))}}catch(s){i.e(s)}finally{i.f()}return l(n.join(""))}(void 0!==e.payload?e.payload:new Uint8Array)),t},fromPartial:function(e){var t=Object.assign({},a);return void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=e.timestamp:t.timestamp=0,void 0!==e.nick&&null!==e.nick?t.nick=e.nick:t.nick="",void 0!==e.payload&&null!==e.payload?t.payload=e.payload:t.payload=new Uint8Array,t}};var u=function(){if("undefined"!==typeof u)return u;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),c=u.atob||function(e){return u.Buffer.from(e,"base64").toString("binary")};var l=u.btoa||function(e){return u.Buffer.from(e,"binary").toString("base64")};function d(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new u.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}s.default.util.Long!==o.default&&(s.default.util.Long=o.default,s.default.configure())}).call(this,n(36))},495:function(e,t,n){},496:function(e,t,n){},506:function(e,t){},513:function(e,t){},520:function(e,t){},522:function(e,t){},533:function(e,t){},535:function(e,t){},547:function(e,t){},595:function(e,t){},596:function(e,t){},659:function(e,t,n){"use strict";var r=n(0),i=n(14),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getStatusFleetNodes=t.Environment=t.Protocol=void 0;var s,a,u=o(n(660));function c(){return(c=i(r.mark((function e(){var t,n,i,o,c=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:a.Prod,n=c.length>1&&void 0!==c[1]?c[1]:s.websocket,e.next=4,u.default.get("https://fleets.status.im/",{headers:{"Content-Type":"application/json"}});case 4:i=e.sent,o=i.data.fleets["wakuv2.".concat(t)],e.t0=n,e.next=e.t0===s.tcp?9:10;break;case 9:return e.abrupt("return",Object.values(o.waku));case 10:return e.abrupt("return",Object.values(o["waku-websocket"]));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e.websocket="websocket",e.tcp="tcp"}(s=t.Protocol||(t.Protocol={})),function(e){e.Test="test",e.Prod="prod"}(a=t.Environment||(t.Environment={})),t.getStatusFleetNodes=function(){return c.apply(this,arguments)}},678:function(e,t,n){"use strict";var r=n(98),i=n(0),o=n(14),s=n(12),a=n(13),u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Waku=void 0;var c=u(n(679)),l=u(n(882)),d=n(888),f=u(n(913)),p=u(n(450)),v=u(n(432)),b=n(53),g=u(n(39)),h=n(451),m=n(135),y=n(461),O=f.default.prototype[Symbol.toStringTag],k=function(){function e(t,n,r,i){var o=this;s(this,e),this.libp2p=n,this.relay=n.pubsub,this.store=r,this.lightPush=i,this.keepAliveTimers={};var a=void 0!==t.keepAlive?t.keepAlive:10;0!==a&&(n.connectionManager.on("peer:connect",(function(e){o.startKeepAlive(e.remotePeer,a)})),n.connectionManager.on("peer:disconnect",(function(e){o.stopKeepAlive(e.remotePeer)})))}return a(e,[{key:"dial",value:function(){var e=o(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.libp2p.dialProtocol(t,[m.RelayCodec,y.StoreCodec]));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addPeerToAddressBook",value:function(e,t){var n;n="string"===typeof e?g.default.createFromB58String(e):e;var r=t.map((function(e){return"string"===typeof e?b.multiaddr(e):e}));this.libp2p.peerStore.addressBook.set(n,r)}},{key:"stop",value:function(){var e=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.libp2p.stop());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLocalMultiaddrWithID",value:function(){var e=this.libp2p.multiaddrs.find((function(e){return e.toString().match(/127\.0\.0\.1/)}));if(!e||""===e.toString())throw"Not listening on localhost";return e+"/p2p/"+this.libp2p.peerId.toB58String()}},{key:"startKeepAlive",value:function(e,t){var n=this;this.stopKeepAlive(e);var r=e.toB58String();this.keepAliveTimers[r]=setInterval((function(){v.default(n.libp2p,e)}),1e3*t)}},{key:"stopKeepAlive",value:function(e){var t=e.toB58String();this.keepAliveTimers[t]&&(clearInterval(this.keepAliveTimers[t]),delete this.keepAliveTimers[t])}}],[{key:"create",value:function(){var t=o(i.mark((function t(n){var o,s,a,u,v,b,g;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(u=Object.assign({},null===n||void 0===n?void 0:n.libp2p)).config=Object.assign({transport:r({},O,{filter:p.default.all})},null===(o=null===n||void 0===n?void 0:n.libp2p)||void 0===o?void 0:o.config),(null===n||void 0===n?void 0:n.pubsubTopic)&&(u.config.pubsub=Object.assign({pubsubTopic:n.pubsubTopic},u.config.pubsub)),u.modules=Object.assign({},null===(s=null===n||void 0===n?void 0:n.libp2p)||void 0===s?void 0:s.modules),u.modules=Object.assign({transport:[f.default]},null===(a=null===n||void 0===n?void 0:n.libp2p)||void 0===a?void 0:a.modules),u.modules=Object.assign(u.modules,{streamMuxer:[l.default],connEncryption:[new d.Noise(null===n||void 0===n?void 0:n.staticNoiseKey)],pubsub:m.WakuRelay}),t.next=8,c.default.create(u);case 8:return v=t.sent,b=new y.WakuStore(v,{pubsubTopic:null===n||void 0===n?void 0:n.pubsubTopic}),g=new h.WakuLightPush(v),t.next=13,v.start();case 13:return t.abrupt("return",new e(n||{},v,b,g));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}();t.Waku=k},724:function(e,t){},725:function(e,t){},820:function(e,t){},87:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"c",(function(){return f}));var r=n(4),i=n(6),o=n(215),s=o.Root,a=o.Type,u=o.Field,c=function(){function e(t){Object(r.a)(this,e),this.payload=t}return Object(i.a)(e,[{key:"encode",value:function(){var t=e.Type.create(this.payload);return e.Type.encode(t).finish()}},{key:"ethDmPublicKey",get:function(){return this.payload.ethDmPublicKey}},{key:"ethAddress",get:function(){return this.payload.ethAddress}},{key:"signature",get:function(){return this.payload.signature}}],[{key:"decode",value:function(t){var n=e.Type.decode(t);if(n.signature&&n.ethDmPublicKey&&n.ethAddress)return new e(n);console.log("Field missing on decoded Public Key Message",n)}}]),e}();function l(t){return new e(t).toString("hex")}function d(t){var n=JSON.stringify(t);return e.from(n,"utf-8")}function f(t){var n=e.from(t).toString("utf-8");return JSON.parse(n)}c.Type=new a("PublicKeyMessage").add(new u("ethDmPublicKey",1,"bytes")).add(new u("ethAddress",2,"bytes")).add(new u("signature",3,"bytes")),c.Root=(new s).define("messages").add(c.Type)}).call(this,n(15).Buffer)},873:function(e,t){},88:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.proto=t.StoreCodec=t.WakuStore=t.Direction=t.RelayCodec=t.WakuRelay=t.PushResponse=t.LightPushCodec=t.WakuLightPush=t.ChatMessage=t.WakuMessage=t.Waku=t.Protocol=t.Environment=t.getStatusFleetNodes=void 0;var s=n(659);Object.defineProperty(t,"getStatusFleetNodes",{enumerable:!0,get:function(){return s.getStatusFleetNodes}}),Object.defineProperty(t,"Environment",{enumerable:!0,get:function(){return s.Environment}}),Object.defineProperty(t,"Protocol",{enumerable:!0,get:function(){return s.Protocol}});var a=n(678);Object.defineProperty(t,"Waku",{enumerable:!0,get:function(){return a.Waku}});var u=n(275);Object.defineProperty(t,"WakuMessage",{enumerable:!0,get:function(){return u.WakuMessage}});var c=n(963);Object.defineProperty(t,"ChatMessage",{enumerable:!0,get:function(){return c.ChatMessage}});var l=n(451);Object.defineProperty(t,"WakuLightPush",{enumerable:!0,get:function(){return l.WakuLightPush}}),Object.defineProperty(t,"LightPushCodec",{enumerable:!0,get:function(){return l.LightPushCodec}}),Object.defineProperty(t,"PushResponse",{enumerable:!0,get:function(){return l.PushResponse}});var d=n(135);Object.defineProperty(t,"WakuRelay",{enumerable:!0,get:function(){return d.WakuRelay}}),Object.defineProperty(t,"RelayCodec",{enumerable:!0,get:function(){return d.RelayCodec}});var f=n(461);Object.defineProperty(t,"Direction",{enumerable:!0,get:function(){return f.Direction}}),Object.defineProperty(t,"WakuStore",{enumerable:!0,get:function(){return f.WakuStore}}),Object.defineProperty(t,"StoreCodec",{enumerable:!0,get:function(){return f.StoreCodec}}),t.proto=o(n(964))},916:function(e,t){},95:function(e,t,n){"use strict";(function(e){n.d(t,"d",(function(){return c})),n.d(t,"a",(function(){return d})),n.d(t,"e",(function(){return p})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return g}));var r=n(0),i=n.n(r),o=n(34),s=(n(293),n(216)),a=n(213),u=n(87);function c(){return l.apply(this,arguments)}function l(){return(l=Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.a());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e,t){return f.apply(this,arguments)}function f(){return(f=Object(o.a)(i.a.mark((function t(n,r){var o,s,a,c,l;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getAddress();case 2:return o=t.sent,s=e.from(r,"hex"),t.next=6,n.signMessage(v(s));case 6:return a=t.sent,c=e.from(o.replace(/0x/,""),"hex"),l=e.from(a.replace(/0x/,""),"hex"),t.abrupt("return",new u.a({ethDmPublicKey:s,ethAddress:c,signature:l}));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){console.log("Verifying Public Key Message",t);var n=v(t.ethDmPublicKey);try{var r=a.a.utils.verifyMessage(n,t.signature),i=e.from(r.replace(/0x/,""),"hex");console.log("Address used to sign message",r,i),console.log("Address present in message",t.ethAddress);var o=i.compare(new e(t.ethAddress));return console.log("Buffer comparison result",o),0===o}catch(s){return console.log("Verify message failed"),!1}}function v(e){var t=JSON.stringify({ethDmPublicKey:Object(u.b)(e)});return console.log("Message formatted for signature",t),t}function b(e,t){return s.b(e,t.encMessage)}function g(e,t){return h.apply(this,arguments)}function h(){return(h=Object(o.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.c(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,n(15).Buffer)},960:function(e,t,n){"use strict";var r=n(12),i=n(13),o=n(28),s=n(29),a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),u=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return u(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RelayHeartbeat=void 0;var l=n(456),d=n(93),f=c(n(276)),p=n(460),v=function(e){o(n,e);var t=s(n);function n(e){return r(this,n),t.call(this,e)}return i(n,[{key:"start",value:function(){var e=this;if(!this._heartbeatTimer){var t=this._heartbeat.bind(this),n=setTimeout((function(){var n;t(),null===(n=e._heartbeatTimer)||void 0===n||n.runPeriodically(t,f.RelayHeartbeatInterval)}),f.RelayHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:function(t,n){e._heartbeatTimer._intervalId=setInterval(t,n)},cancel:function(){var t;clearTimeout(n),clearInterval(null===(t=e._heartbeatTimer)||void 0===t?void 0:t._intervalId)}}}}},{key:"stop",value:function(){this._heartbeatTimer&&(this._heartbeatTimer.cancel(),this._heartbeatTimer=null)}},{key:"_heartbeat",value:function(){var e=this,t=this.gossipsub._options,n=t.D,r=t.Dlo,i=t.Dhi,o=t.Dscore,s=t.Dout;this.gossipsub.heartbeatTicks++;var a=new Map,u=function(t){var n=a.get(t);return void 0===n&&(n=e.gossipsub.score.score(t),a.set(t,n)),n},c=new Map,l=new Map,v=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((function(t,a){var b=function(n){e.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",n,a),e.gossipsub.score.prune(n,a),e.gossipsub._addBackoff(n,a),t.delete(n);var r=l.get(n);r?r.push(a):l.set(n,[a])},g=function(n){e.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",n,a),e.gossipsub.score.graft(n,a),t.add(n);var r=c.get(n);r?r.push(a):c.set(n,[a])};if(t.forEach((function(t){var n=u(t);n<0&&(e.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",t,n,a),b(t),v.set(t,!0))})),t.size<r){var h=e.gossipsub.backoff.get(a),m=n-t.size;p.getRelayPeers(e.gossipsub,a,m,(function(n){return!t.has(n)&&!e.gossipsub.direct.has(n)&&(!h||!h.has(n))&&u(n)>=0})).forEach(g)}if(t.size>i){var y=Array.from(t);y.sort((function(e,t){return u(t)-u(e)})),y=y.slice(0,o).concat(d.shuffle(y.slice(o)));var O=0;if(y.slice(0,n).forEach((function(t){e.gossipsub.outbound.get(t)&&O++})),O<s){var k=function(e){for(var t=y[e],n=e;n>0;n--)y[n]=y[n-1];y[0]=t};if(O>0)for(var P=O,j=1;j<n&&P>0;j++)e.gossipsub.outbound.get(y[j])&&(k(j),P--);for(var T=n-O,w=n;w<y.length&&T>0;w++)e.gossipsub.outbound.get(y[w])&&(k(w),T--)}y.slice(n).forEach(b)}if(t.size>=r){var _=0;if(t.forEach((function(t){e.gossipsub.outbound.get(t)&&_++})),_<s){var S=s-_,R=e.gossipsub.backoff.get(a);p.getRelayPeers(e.gossipsub,a,S,(function(n){return!t.has(n)&&!e.gossipsub.direct.has(n)&&(!R||!R.has(n))&&u(n)>=0})).forEach(g)}}if(e.gossipsub.heartbeatTicks%f.RelayOpportunisticGraftTicks===0&&t.size>1){var I=Array.from(t).sort((function(e,t){return u(e)-u(t)})),x=t.size/2,D=u(I[x]);if(D<e.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){var C=e.gossipsub.backoff.get(a);p.getRelayPeers(e.gossipsub,a,f.RelayOpportunisticGraftPeers,(function(n){return t.has(n)&&!e.gossipsub.direct.has(n)&&(!C||!C.has(n))&&u(n)>D})).forEach((function(t){e.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,a),g(t)}))}}e.gossipsub._emitGossip(a,t)}));var b=this.gossipsub._now();this.gossipsub.lastpub.forEach((function(t,n){t+f.RelayFanoutTTL<b&&(e.gossipsub.fanout.delete(n),e.gossipsub.lastpub.delete(n))})),this.gossipsub.fanout.forEach((function(t,r){var i=e.gossipsub.topics.get(r);if(t.forEach((function(n){(!(null===i||void 0===i?void 0:i.has(n))||u(n)<e.gossipsub._options.scoreThresholds.publishThreshold)&&t.delete(n)})),t.size<n){var o=n-t.size;p.getRelayPeers(e.gossipsub,r,o,(function(n){return!t.has(n)&&!e.gossipsub.direct.has(n)&&u(n)>=e.gossipsub._options.scoreThresholds.publishThreshold})).forEach((function(e){t.add(e)}))}e.gossipsub._emitGossip(r,t)})),this.gossipsub._sendGraftPrune(c,l,v),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}]),n}(l.Heartbeat);t.RelayHeartbeat=v},961:function(e,t,n){"use strict";var r=n(12),i=n(13),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.PushRPC=void 0;var u=n(49),c=n(464),l=a(n(453)),d=n(135),f=function(){function e(t){r(this,e),this.proto=t}return i(e,[{key:"encode",value:function(){return l.PushRPC.encode(this.proto).finish()}},{key:"query",get:function(){return this.proto.request}},{key:"response",get:function(){return this.proto.response}}],[{key:"createRequest",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.DefaultPubsubTopic;return new e({requestId:c.v4(),request:{message:t.proto,pubsubTopic:n},response:void 0})}},{key:"decode",value:function(t){return new e(l.PushRPC.decode(u.Reader.create(t)))}}]),e}();t.PushRPC=f},962:function(e,t,n){"use strict";var r=n(12),i=n(13),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.Direction=void 0;var u,c=n(49),l=n(464),d=a(n(462));!function(e){e.BACKWARD="backward",e.FORWARD="forward"}(u=t.Direction||(t.Direction={}));var f=function(){function e(t){r(this,e),this.proto=t}return i(e,[{key:"encode",value:function(){return d.HistoryRPC.encode(this.proto).finish()}},{key:"query",get:function(){return this.proto.query}},{key:"response",get:function(){return this.proto.response}}],[{key:"createQuery",value:function(t){var n=function(e){switch(e){case u.BACKWARD:return d.PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED;case u.FORWARD:return d.PagingInfo_Direction.DIRECTION_FORWARD;default:return d.PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED}}(t.direction),r={pageSize:t.pageSize,cursor:t.cursor,direction:n},i=t.contentTopics.map((function(e){return{contentTopic:e}}));return new e({requestId:l.v4(),query:{pubsubTopic:t.pubsubTopic,contentFilters:i,pagingInfo:r,startTime:void 0,endTime:void 0},response:void 0})}},{key:"decode",value:function(t){return new e(d.HistoryRPC.decode(c.Reader.create(t)))}}]),e}();t.HistoryRPC=f},963:function(e,t,n){"use strict";(function(e){var r=n(12),i=n(13),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessage=void 0;var u=n(49),c=a(n(463)),l=function(){function t(e){r(this,t),this.proto=e}return i(t,[{key:"encode",value:function(){return c.ChatMessage.encode(this.proto).finish()}},{key:"timestamp",get:function(){return new Date(1e3*this.proto.timestamp)}},{key:"nick",get:function(){return this.proto.nick}},{key:"payloadAsUtf8",get:function(){return this.proto.payload?Array.from(this.proto.payload).map((function(e){return String.fromCharCode(e)})).join(""):""}}],[{key:"fromUtf8String",value:function(n,r,i){return new t({timestamp:Math.floor(n.valueOf()/1e3),nick:r,payload:e.from(i,"utf-8")})}},{key:"decode",value:function(e){return new t(c.ChatMessage.decode(u.Reader.create(e)))}}]),t}();t.ChatMessage=l}).call(this,n(15).Buffer)},964:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.HistoryResponse=t.HistoryQuery=t.ContentFilter=t.PagingInfo_Direction=t.PagingInfo=t.Index=t.WakuMessage=t.ChatMessage=void 0;var r=n(463);Object.defineProperty(t,"ChatMessage",{enumerable:!0,get:function(){return r.ChatMessage}});var i=n(202);Object.defineProperty(t,"WakuMessage",{enumerable:!0,get:function(){return i.WakuMessage}});var o=n(462);Object.defineProperty(t,"Index",{enumerable:!0,get:function(){return o.Index}}),Object.defineProperty(t,"PagingInfo",{enumerable:!0,get:function(){return o.PagingInfo}}),Object.defineProperty(t,"PagingInfo_Direction",{enumerable:!0,get:function(){return o.PagingInfo_Direction}}),Object.defineProperty(t,"ContentFilter",{enumerable:!0,get:function(){return o.ContentFilter}}),Object.defineProperty(t,"HistoryQuery",{enumerable:!0,get:function(){return o.HistoryQuery}}),Object.defineProperty(t,"HistoryResponse",{enumerable:!0,get:function(){return o.HistoryResponse}}),Object.defineProperty(t,"HistoryRPC",{enumerable:!0,get:function(){return o.HistoryRPC}})},969:function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),o=n(41),s=n.n(o),a=(n(495),n(60)),u=(n(293),n(496),n(213)),c=(n(497),n(1017)),l=n(1018),d=n(217),f=n(1019),p=n(1001),v=n(206),b=n(19);function g(e){var t=e.password,n=e.disabled,r=e.setEthDmKeyPair;return Object(b.jsx)(p.a,{variant:"contained",color:"primary",onClick:function(){n||t&&Object(v.a)(t).then((function(e){e&&(console.log("EthDm KeyPair loaded from storage"),r(e))}))},disabled:!t||n,children:"Load Eth-DM Key Pair from storage"})}function h(e){var t=e.password,n=e.ethDmKeyPair;return Object(b.jsx)(p.a,{variant:"contained",color:"primary",onClick:function(){n&&t&&Object(v.b)(n,t).then((function(){console.log("EthDm KeyPair saved to storage")}))},disabled:!t||!n,children:"Save Eth-DM Key Pair to storage"})}var m=n(95),y=n(1011),O=n(1021);function k(e){var t=e.password,n=e.setPassword;return Object(b.jsx)(O.a,{id:"password-input",label:"Password",variant:"filled",type:"password",onChange:function(e){n(e.target.value)},value:t})}var P=Object(y.a)({root:{textAlign:"center",display:"flex",alignItems:"center",flexDirection:"column",margin:"5px"},generate:{margin:"5px"},storage:{margin:"5px"},loadSave:{display:"flex",flexDirection:"row",margin:"5px"},loadSaveButton:{margin:"5px"}});function j(e){var t=e.ethDmKeyPair,n=e.setEthDmKeyPair,i=P(),o=Object(r.useState)(),s=Object(a.a)(o,2),u=s[0],c=s[1];return Object(b.jsxs)("div",{className:i.root,children:[Object(b.jsx)(p.a,{className:i.generate,variant:"contained",color:"primary",onClick:function(){t||Object(m.d)().then((function(e){n(e)})).catch((function(e){console.error("Failed to generate Key Pair",e)}))},disabled:!!t,children:"Generate Eth-DM Key Pair"}),Object(b.jsxs)("div",{className:i.storage,children:[Object(b.jsx)(k,{password:u,setPassword:function(e){return c(e)}}),Object(b.jsxs)("div",{className:i.loadSave,children:[Object(b.jsx)("div",{className:i.loadSaveButton,children:Object(b.jsx)(g,{setEthDmKeyPair:function(e){return n(e)},disabled:!!t,password:u})}),Object(b.jsx)("div",{className:i.loadSaveButton,children:Object(b.jsx)(h,{ethDmKeyPair:t,password:u})})]})]})]})}var T=n(142),w=n(477),_=n(1016),S=n(1014),R=n(1015),I=n(214),x=n(476),D=n.n(x),C=n(88);function N(e){var t=e.signer,n=e.ethDmKeyPair,i=e.waku,o=Object(r.useState)(),s=Object(a.a)(o,2),u=s[0],c=s[1];return Object(b.jsx)(p.a,{variant:"contained",color:"primary",onClick:function(){if(n&&t&&i)if(u){var e=M(u);i.lightPush.push(e).catch((function(e){console.error("Failed to send Public Key Message",e)}))}else Object(m.a)(t,n.publicKey).then((function(e){c(e);var t=M(e);i.lightPush.push(t).catch((function(e){console.error("Failed to send Public Key Message",e)}))})).catch((function(e){console.error("Failed to create public key message",e)}))},disabled:!n||!i,children:"Broadcast Eth-DM Public Key"})}function M(e){var t=e.encode();return C.WakuMessage.fromBytes(t,T.b)}var E=n(1010),A=n(972),W=n(1012);function q(e){var t=e.messages;return Object(b.jsx)(E.a,{dense:!0,children:F(t)})}function F(e){return e.map((function(e){var t="<".concat(K(e.timestamp),"> ").concat(e.text);return Object(b.jsx)(A.a,{children:Object(b.jsx)(W.a,{primary:t},K(e.timestamp))})}))}function K(e){return e.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!1})}var B=n(0),H=n.n(B),J=n(34),z=n(1013),L=n(1009),U=n(1023),G=n(1020),Q=n(87),V=Object(y.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},selectEmpty:{marginTop:e.spacing(2)}}}));function X(e){var t=e.waku,n=e.recipients,i=V(),o=Object(r.useState)(""),s=Object(a.a)(o,2),u=s[0],c=s[1],l=Object(r.useState)(),d=Object(a.a)(l,2),f=d[0],p=d[1],v=Array.from(n.keys()).map((function(e){return Object(b.jsx)(z.a,{value:e,children:e},e)})),g=function(){var e=Object(J.a)(H.a.mark((function e(r){var i;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==r.key||r.altKey||r.ctrlKey||r.shiftKey){e.next=11;break}if(t){e.next=3;break}return e.abrupt("return");case 3:if(u){e.next=5;break}return e.abrupt("return");case 5:if(f){e.next=7;break}return e.abrupt("return");case 7:if(i=n.get(u)){e.next=10;break}return e.abrupt("return");case 10:Y(t,u,i,f,(function(e){e&&(console.log("callback called with",e),p(""))}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(b.jsxs)("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap"},children:[Object(b.jsxs)(L.a,{className:i.formControl,children:[Object(b.jsx)(U.a,{id:"select-recipient-label",children:"Recipient"}),Object(b.jsx)(G.a,{labelId:"select-recipient",id:"select-recipient",value:u,onChange:function(e){c(e.target.value)},children:v})]}),Object(b.jsx)(O.a,{id:"message-input",label:"Message",variant:"filled",onChange:function(e){p(e.target.value)},onKeyDown:g,value:f})]})}function Z(){return(Z=Object(J.a)(H.a.mark((function e(t,n,r){var i,o,s;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.c)(n,t);case 2:return i=e.sent,o={toAddress:r,encMessage:i},s=Object(Q.d)(o),e.abrupt("return",C.WakuMessage.fromBytes(s,T.a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t,n,r,i){(function(e,t,n){return Z.apply(this,arguments)})(r,n,t).then((function(t){console.log("pushing"),e.lightPush.push(t).then((function(e){console.log("Message sent",e),i(!!e&&e.isSuccess)})).catch((function(e){console.error("Failed to send message",e),i(!1)}))})).catch((function(e){console.error("Cannot encode & encrypt message",e),i(!1)}))}var $=Object(y.a)({root:{display:"flex",alignItems:"left",flexDirection:"column",margin:"5px"}});function ee(e){var t=e.waku,n=e.recipients,r=e.messages,i=$();return Object(b.jsxs)("div",{className:i.root,children:[Object(b.jsx)(X,{recipients:n,waku:t}),Object(b.jsx)(q,{messages:r})]})}var te=Object(w.a)({palette:{primary:{main:S.a[500]},secondary:{main:R.a[600]}}}),ne=Object(y.a)({root:{textAlign:"center",display:"flex",flexDirection:"column",minHeight:"100vh"},appBar:{},container:{display:"flex",flex:1},main:{flex:1,margin:"10px"},wakuStatus:{}});var re=function(){var e,t=Object(r.useState)(),n=Object(a.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)(),p=Object(a.a)(s,2),v=p[0],g=p[1],h=Object(r.useState)(),m=Object(a.a)(h,2),y=m[0],O=m[1],k=Object(r.useState)(new Map),P=Object(a.a)(k,2),w=P[0],S=P[1],R=Object(r.useState)([]),x=Object(a.a)(R,2),C=x[0],M=x[1],E=Object(r.useState)(),A=Object(a.a)(E,2),W=A[0],q=A[1],F=ne();return Object(r.useEffect)((function(){if(!v)try{window.ethereum.request({method:"eth_requestAccounts"});var e=new u.a.providers.Web3Provider(window.ethereum);g(e)}catch(t){console.error("No web3 provider available")}}),[v]),Object(r.useEffect)((function(){null===v||void 0===v||v.getSigner().getAddress().then((function(e){return q(e)}))})),i&&(e=i.libp2p.connectionManager.connections.size),Object(b.jsx)(_.a,{theme:te,children:Object(b.jsxs)("div",{className:F.root,children:[Object(b.jsx)(c.a,{className:F.appBar,position:"static",children:Object(b.jsxs)(l.a,{children:[Object(b.jsx)(d.a,{children:"Ethereum Direct Message"}),Object(b.jsx)(f.a,{edge:"end",className:F.wakuStatus,"aria-label":"waku-status",children:Object(b.jsx)(D.a,{color:i?void 0:"disabled",style:i?{color:I.a[500]}:{}})}),Object(b.jsx)(d.a,{children:e})]})}),Object(b.jsx)("div",{className:F.container,children:Object(b.jsxs)("main",{className:F.main,children:[Object(b.jsx)(T.c,{ethDmKeyPair:y,setMessages:M,setPublicKeys:S,setWaku:o,waku:i,address:W}),Object(b.jsxs)("fieldset",{children:[Object(b.jsx)("legend",{children:"Eth-DM Key Pair"}),Object(b.jsx)(j,{ethDmKeyPair:y,setEthDmKeyPair:function(e){return O(e)}}),Object(b.jsx)(N,{signer:null===v||void 0===v?void 0:v.getSigner(),ethDmKeyPair:y,waku:i})]}),Object(b.jsxs)("fieldset",{children:[Object(b.jsx)("legend",{children:"Messaging"}),Object(b.jsx)(ee,{recipients:w,waku:i,messages:C})]})]})})]})})};s.a.render(Object(b.jsx)(i.a.StrictMode,{children:Object(b.jsx)(re,{})}),document.getElementById("root"))}},[[969,1,2]]]);
//# sourceMappingURL=main.1c1ec0c2.chunk.js.map