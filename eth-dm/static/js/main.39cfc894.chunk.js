(this["webpackJsonpeth-dm"]=this["webpackJsonpeth-dm"]||[]).push([[0],{103:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.proto=t.StoreCodec=t.WakuStore=t.Direction=t.RelayCodec=t.WakuRelay=t.PushResponse=t.LightPushCodec=t.WakuLightPush=t.ChatMessage=t.WakuMessage=t.Waku=t.utils=t.Protocol=t.Environment=t.getStatusFleetNodes=void 0;var a=r(568);Object.defineProperty(t,"getStatusFleetNodes",{enumerable:!0,get:function(){return a.getStatusFleetNodes}}),Object.defineProperty(t,"Environment",{enumerable:!0,get:function(){return a.Environment}}),Object.defineProperty(t,"Protocol",{enumerable:!0,get:function(){return a.Protocol}}),t.utils=o(r(39));var s=r(587);Object.defineProperty(t,"Waku",{enumerable:!0,get:function(){return s.Waku}});var u=r(232);Object.defineProperty(t,"WakuMessage",{enumerable:!0,get:function(){return u.WakuMessage}});var c=r(864);Object.defineProperty(t,"ChatMessage",{enumerable:!0,get:function(){return c.ChatMessage}});var l=r(394);Object.defineProperty(t,"WakuLightPush",{enumerable:!0,get:function(){return l.WakuLightPush}}),Object.defineProperty(t,"LightPushCodec",{enumerable:!0,get:function(){return l.LightPushCodec}}),Object.defineProperty(t,"PushResponse",{enumerable:!0,get:function(){return l.PushResponse}});var d=r(111);Object.defineProperty(t,"WakuRelay",{enumerable:!0,get:function(){return d.WakuRelay}}),Object.defineProperty(t,"RelayCodec",{enumerable:!0,get:function(){return d.RelayCodec}});var f=r(404);Object.defineProperty(t,"Direction",{enumerable:!0,get:function(){return f.Direction}}),Object.defineProperty(t,"WakuStore",{enumerable:!0,get:function(){return f.WakuStore}}),Object.defineProperty(t,"StoreCodec",{enumerable:!0,get:function(){return f.StoreCodec}}),t.proto=o(r(865))},111:function(e,t,r){"use strict";(function(e){var n=r(1),i=r(8),o=r(7),a=r(9),s=r(54),u=r(90),c=r(68),l=r(23),d=r(24),f=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),p=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&f(t,e,r);return p(t,e),t},b=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuRelay=t.DefaultPubsubTopic=t.RelayCodec=void 0;var g=b(r(19)),h=b(r(836)),y=r(76),m=r(860),P=b(r(30)),k=r(232),O=v(r(233)),j=r(233);Object.defineProperty(t,"DefaultPubsubTopic",{enumerable:!0,get:function(){return j.DefaultPubsubTopic}}),Object.defineProperty(t,"RelayCodec",{enumerable:!0,get:function(){return j.RelayCodec}});var T=r(403),w=r(861),_=g.default("waku:relay"),R=function(t){l(f,t);var r=d(f);function f(e,t){var n;o(this,f),(n=r.call(this,e,Object.assign(t,{globalSignaturePolicy:m.SignaturePolicy.StrictNoSign}))).heartbeat=new w.RelayHeartbeat(s(n)),n.observers={},n.decPrivateKeys=new Set;var i=[O.RelayCodec];return Object.assign(s(n),{multicodecs:i}),n.pubsubTopic=(null===t||void 0===t?void 0:t.pubsubTopic)||O.DefaultPubsubTopic,n}return a(f,[{key:"start",value:function(){u(c(f.prototype),"start",this).call(this),this.subscribe(this.pubsubTopic)}},{key:"send",value:function(){var t=i(n.mark((function t(r){var i;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=r.encode(),t.next=3,u(c(f.prototype),"publish",this).call(this,this.pubsubTopic,e.from(i));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addDecryptionPrivateKey",value:function(e){this.decPrivateKeys.add(e)}},{key:"deleteDecryptionPrivateKey",value:function(e){this.decPrivateKeys.delete(e)}},{key:"addObserver",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===r.length?(this.observers[""]||(this.observers[""]=new Set),this.observers[""].add(e)):r.forEach((function(r){t.observers[r]||(t.observers[r]=new Set),t.observers[r].add(e)}))}},{key:"deleteObserver",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===r.length?this.observers[""]&&this.observers[""].delete(e):r.forEach((function(r){t.observers[r]&&t.observers[r].delete(e)}))}},{key:"getPeers",value:function(){var e=this;return T.getRelayPeers(this,this.pubsubTopic,this._options.D,(function(t){return e.score.score(t)>=e._options.scoreThresholds.publishThreshold}))}},{key:"subscribe",value:function(e){var t=this;this.on(e,(function(r){_("Message received on ".concat(e)),k.WakuMessage.decode(r.data,Array.from(t.decPrivateKeys)).then((function(e){e?(t.observers[""]&&t.observers[""].forEach((function(t){t(e)})),e.contentTopic&&t.observers[e.contentTopic]&&t.observers[e.contentTopic].forEach((function(t){t(e)}))):_("Failed to decode Waku Message")})).catch((function(e){_("Failed to decode Waku Message",e)}))})),u(c(f.prototype),"subscribe",this).call(this,e)}},{key:"join",value:function(e){var t,r=this;if(!this.started)throw new Error("WakuRelayPubsub has not started");var n=this.fanout.get(e);if(n)n.forEach((function(e){r.score.score(e)<0&&n.delete(e)})),n.size<this._options.D&&T.getRelayPeers(this,e,this._options.D-n.size,(function(e){return!n.has(e)&&!r.direct.has(e)&&r.score.score(e)>=0})).forEach((function(e){return n.add(e)})),this.mesh.set(e,n),this.fanout.delete(e),this.lastpub.delete(e);else{var i=T.getRelayPeers(this,e,this._options.D,(function(e){return!r.direct.has(e)&&r.score.score(e)>=0}));this.mesh.set(e,i)}null===(t=this.mesh.get(e))||void 0===t||t.forEach((function(t){r.log("JOIN: Add mesh link to %s in %s",t,e),r._sendGraft(t,e)}))}},{key:"_publish",value:function(){var e=i(n.mark((function e(t){var r,i,o,a,s=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(t),this.gossipTracer.deliverMessage(t)),r=this.getMsgId(t),i=y.messageIdToString(r),this.seenCache.put(i),this.messageCache.put(t),o=new Set,t.topicIDs.forEach((function(e){if(s.topics.get(e)){s.direct.forEach((function(e){o.add(e)}));var t=s.mesh.get(e);if(!t||!t.size){if(!(t=s.fanout.get(e))){var r=T.getRelayPeers(s,e,s._options.D,(function(e){return s.score.score(e)>=s._options.scoreThresholds.publishThreshold}));r.size>0?(t=r,s.fanout.set(e,r)):t=new Set}s.lastpub.set(e,s._now())}null===t||void 0===t||t.forEach((function(e){o.add(e)}))}})),a=y.createGossipRpc([h.default.utils.normalizeOutRpcMessage(t)]),o.forEach((function(e){e!==t.from&&s._sendRpc(e,a)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_emitGossip",value:function(e,t){var r=this,n=this.messageCache.getGossipIDs(e);if(n.length){y.shuffle(n),n.length>O.RelayMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length);var i=[],o=this.topics.get(e);if(o){o.forEach((function(e){var n=r.peers.get(e);n&&!t.has(e)&&!r.direct.has(e)&&n.protocol==O.RelayCodec&&r.score.score(e)>=r._options.scoreThresholds.gossipThreshold&&i.push(e)}));var a=this._options.Dlazy,s=O.RelayGossipFactor*i.length;s>a&&(a=s),a>i.length?a=i.length:y.shuffle(i),i.slice(0,a).forEach((function(t){var i=n;n.length>O.RelayMaxIHaveLength&&(i=y.shuffle(i.slice()).slice(0,O.RelayMaxIHaveLength)),r._pushGossip(t,{topicID:e,messageIDs:i})}))}}}},{key:"_makePrune",value:function(e,t,r){var n=this,i=O.RelayPruneBackoff/1e3,o=[];r&&T.getRelayPeers(this,t,O.RelayPrunePeers,(function(t){return t!==e&&n.score.score(t)>=0})).forEach((function(e){var t=P.default.createFromB58String(e);o.push({peerID:t.toBytes(),signedPeerRecord:n._libp2p.peerStore.addressBook.getRawEnvelope(t)})}));return{topicID:t,peers:o,backoff:i}}}]),f}(h.default);t.WakuRelay=R}).call(this,r(14).Buffer)},167:function(e,t,r){"use strict";(function(e){var n=r(22),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuMessage=t.protobufPackage=void 0;var o=i(r(166)),a=i(r(40));t.protobufPackage="waku.v2";var s={};t.WakuMessage={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.default.Writer.create();return void 0!==e.payload&&t.uint32(10).bytes(e.payload),void 0!==e.contentTopic&&t.uint32(18).string(e.contentTopic),void 0!==e.version&&t.uint32(24).uint32(e.version),void 0!==e.timestamp&&t.uint32(33).double(e.timestamp),t},decode:function(e,t){for(var r=e instanceof a.default.Reader?e:new a.default.Reader(e),n=void 0===t?r.len:r.pos+t,i=Object.assign({},s);r.pos<n;){var o=r.uint32();switch(o>>>3){case 1:i.payload=r.bytes();break;case 2:i.contentTopic=r.string();break;case 3:i.version=r.uint32();break;case 4:i.timestamp=r.double();break;default:r.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},s);return void 0!==e.payload&&null!==e.payload&&(t.payload=function(e){for(var t=c(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}(e.payload)),void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=String(e.contentTopic):t.contentTopic=void 0,void 0!==e.version&&null!==e.version?t.version=Number(e.version):t.version=void 0,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=Number(e.timestamp):t.timestamp=void 0,t},toJSON:function(e){var t={};return void 0!==e.payload&&(t.payload=void 0!==e.payload?function(e){var t,r=[],i=n(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push(String.fromCharCode(o))}}catch(a){i.e(a)}finally{i.f()}return l(r.join(""))}(e.payload):void 0),void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),void 0!==e.version&&(t.version=e.version),void 0!==e.timestamp&&(t.timestamp=e.timestamp),t},fromPartial:function(e){var t=Object.assign({},s);return void 0!==e.payload&&null!==e.payload?t.payload=e.payload:t.payload=void 0,void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=e.contentTopic:t.contentTopic=void 0,void 0!==e.version&&null!==e.version?t.version=e.version:t.version=void 0,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=e.timestamp:t.timestamp=void 0,t}};var u=function(){if("undefined"!==typeof u)return u;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),c=u.atob||function(e){return u.Buffer.from(e,"base64").toString("binary")};var l=u.btoa||function(e){return u.Buffer.from(e,"binary").toString("base64")};a.default.util.Long!==o.default&&(a.default.util.Long=o.default,a.default.configure())}).call(this,r(32))},175:function(e,t,r){"use strict";var n=r(1),i=r(8),o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getPublicKey=t.generatePrivateKey=t.decryptAsymmetric=t.encryptAsymmetric=t.clearDecode=t.clearEncode=void 0;var u=r(14),c=s(r(458)),l=s(r(542)),d=r(312),f=s(r(313)),p=r(39);function v(){return(v=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.encrypt(p.hexToBuf(r),u.Buffer.from(t)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.decrypt(u.Buffer.from(r),u.Buffer.from(t)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return f.publicKeyCreate(e,!1)}function h(e){for(var t=1,r=e.length;r>=256;r/=256)t++;return t}function y(e){if("undefined"!==typeof window&&window&&window.crypto){var t=new Uint8Array(e);return window.crypto.getRandomValues(t),t}return c.randomBytes(e)}t.clearEncode=function(e,t){var r=u.Buffer.from([0]);r=function(e,t){var r=h(t),n=u.Buffer.alloc(4);return n.writeUInt32LE(t.length,0),n=n.slice(0,r),(e=u.Buffer.concat([e,n]))[0]|=r,e}(r,e),r=u.Buffer.concat([r,u.Buffer.from(e)]);var n=1+h(e)+e.length;t&&(n+=65);var i,o=256-n%256,a=u.Buffer.from(y(o));if(!function(e,t){if(e.length!==t)return!1;if(t>3&&u.Buffer.from(e).equals(u.Buffer.alloc(e.length)))return!1;return!0}(a,o))throw new Error("failed to generate random padding of size "+o);if(r=u.Buffer.concat([r,a]),t){r[0]|=4;var s=d.keccak256(r),c=f.ecdsaSign(p.hexToBuf(s),t);r=u.Buffer.concat([r,c.signature,u.Buffer.from([c.recid])]),i={signature:u.Buffer.from(c.signature),publicKey:g(t)}}return{payload:r,sig:i}},t.clearDecode=function(e){var t,r=u.Buffer.from(e),n=1,i=3&r.readUIntLE(0,1);if(0!==i){var o=r.readUIntLE(n,i);n+=i;var a=r.slice(n,n+o),s=4==(4&r.readUIntLE(0,1));if(s){var c=function(e){return e.slice(e.length-65,e.length)}(r),l=function(e,t){var r=t.slice(64).readIntBE(0,1);return f.ecdsaRecover(t.slice(0,64),r,p.hexToBuf(e),!1)}(function(e,t){if(t)return d.keccak256(e.slice(0,e.length-65));return d.keccak256(e)}(r,s),c);t={signature:c,publicKey:l}}return{payload:a,sig:t}}},t.encryptAsymmetric=function(e,t){return v.apply(this,arguments)},t.decryptAsymmetric=function(e,t){return b.apply(this,arguments)},t.generatePrivateKey=function(){return y(32)},t.getPublicKey=g},214:function(e,t){},232:function(e,t,r){"use strict";var n=r(1),i=r(8),o=r(7),a=r(9),s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),u=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return u(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuMessage=t.DefaultContentTopic=void 0;var d=r(14),f=l(r(19)),p=r(40),v=c(r(167)),b=c(r(175));t.DefaultContentTopic="/waku/2/default-content/proto";var g=f.default("waku:message"),h=function(){function e(t,r,n){o(this,e),this.proto=t,this._signaturePublicKey=r,this._signature=n}return a(e,[{key:"encode",value:function(){return v.WakuMessage.encode(this.proto).finish()}},{key:"payloadAsUtf8",get:function(){return this.proto.payload?Array.from(this.proto.payload).map((function(e){return String.fromCharCode(e)})).join(""):""}},{key:"payload",get:function(){return this.proto.payload}},{key:"contentTopic",get:function(){return this.proto.contentTopic}},{key:"version",get:function(){return this.proto.version}},{key:"timestamp",get:function(){if(this.proto.timestamp)return new Date(1e3*this.proto.timestamp)}},{key:"signaturePublicKey",get:function(){return this._signaturePublicKey}},{key:"signature",get:function(){return this._signature}}],[{key:"fromUtf8String",value:function(){var t=i(n.mark((function t(r,i){var o;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=d.Buffer.from(r,"utf-8"),t.abrupt("return",e.fromBytes(o,i));case 2:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"fromBytes",value:function(){var r=i(n.mark((function r(i,o){var a,s,u,c,l,d,f,p,v;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=Object.assign({timestamp:new Date,contentTopic:t.DefaultContentTopic},o||{}),s=a.timestamp,u=a.contentTopic,c=a.encPublicKey,l=a.sigPrivKey,d=i,f=0,!c){r.next=10;break}return v=b.clearEncode(d,l),r.next=7,b.encryptAsymmetric(v.payload,c);case 7:d=r.sent,p=v.sig,f=1;case 10:return r.abrupt("return",new e({payload:d,timestamp:s.valueOf()/1e3,version:f,contentTopic:u},null===p||void 0===p?void 0:p.publicKey,null===p||void 0===p?void 0:p.signature));case 11:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()},{key:"decode",value:function(){var t=i(n.mark((function t(r,i){var o;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=v.WakuMessage.decode(p.Reader.create(r)),t.abrupt("return",e.decodeProto(o,i));case 2:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"decodeProto",value:function(){var t=i(n.mark((function t(r,o){var a,s,u,c,l,d,f,p,v,h;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==r.payload){t.next=3;break}return g("Payload is undefined"),t.abrupt("return");case 3:if(u=r.payload,1!==r.version||!r.payload){t.next=26;break}if(void 0!==o){t.next=8;break}return g("Payload is encrypted but no private keys have been provided."),t.abrupt("return");case 8:return t.next=10,Promise.all(o.map(function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.decryptAsymmetric(u,t);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),g("Failed to decrypt asymmetric message",e.t0),e.abrupt("return");case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()));case 10:if(d=t.sent,f=function(e){return!!e},0!==(p=d.filter(f)).length){t.next=16;break}return g("Failed to decrypt payload."),t.abrupt("return");case 16:return v=p[0],t.next=19,b.clearDecode(v);case 19:if(h=t.sent){t.next=23;break}return g("Failed to decode payload."),t.abrupt("return");case 23:Object.assign(r,{payload:h.payload}),c=null===(a=h.sig)||void 0===a?void 0:a.publicKey,l=null===(s=h.sig)||void 0===s?void 0:s.signature;case 26:return t.abrupt("return",new e(r,c,l));case 27:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}]),e}();t.WakuMessage=h},233:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RelayMaxIHaveLength=t.RelayOpportunisticGraftPeers=t.RelayOpportunisticGraftTicks=t.RelayFanoutTTL=t.RelayPruneBackoff=t.RelayPrunePeers=t.RelayHeartbeatInterval=t.RelayHeartbeatInitialDelay=t.RelayGossipFactor=t.DefaultPubsubTopic=t.RelayCodec=t.minute=t.second=void 0,t.second=1e3,t.minute=60*t.second,t.RelayCodec="/vac/waku/relay/2.0.0-beta2",t.DefaultPubsubTopic="/waku/2/default-waku/proto",t.RelayGossipFactor=.25,t.RelayHeartbeatInitialDelay=100,t.RelayHeartbeatInterval=t.second,t.RelayPrunePeers=16,t.RelayPruneBackoff=t.minute,t.RelayFanoutTTL=t.minute,t.RelayOpportunisticGraftTicks=60,t.RelayOpportunisticGraftPeers=2,t.RelayMaxIHaveLength=5e3},39:function(e,t,r){"use strict";(function(e){function r(t){return"string"===typeof t?e.from(t.replace(/^0x/i,""),"hex"):e.from(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.equalByteArrays=t.bufToHex=t.hexToBuf=void 0,t.hexToBuf=r,t.bufToHex=function(t){return e.from(t).toString("hex")},t.equalByteArrays=function(t,n){var i,o;return i="string"===typeof t?r(t):e.from(t),o="string"===typeof n?r(n):e.from(n),0===i.compare(o)}}).call(this,r(14).Buffer)},394:function(e,t,r){"use strict";var n=r(1),i=r(8),o=r(7),a=r(9),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuLightPush=t.PushResponse=t.LightPushCodec=void 0;var u=s(r(395)),c=s(r(75)),l=s(r(55)),d=r(396);Object.defineProperty(t,"PushResponse",{enumerable:!0,get:function(){return d.PushResponse}});var f=r(397),p=r(111),v=r(862);t.LightPushCodec="/vac/waku/lightpush/2.0.0-beta1";var b=function(){function e(t,r){o(this,e),this.libp2p=t,(null===r||void 0===r?void 0:r.pubsubTopic)?this.pubsubTopic=r.pubsubTopic:this.pubsubTopic=p.DefaultPubsubTopic}return a(e,[{key:"push",value:function(){var e=i(n.mark((function e(r,i){var o,a,s,d,f,p,b,g;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===i||void 0===i?void 0:i.peerId)){e.next=6;break}if(o=this.libp2p.peerStore.get(i.peerId)){e.next=4;break}throw"Peer is unknown";case 4:e.next=7;break;case 6:o=this.randomPeer;case 7:if(o){e.next=9;break}throw"No peer available";case 9:if(o.protocols.includes(t.LightPushCodec)){e.next=11;break}throw"Peer does not register waku light push protocol";case 11:if(a=this.libp2p.connectionManager.get(o.id)){e.next=14;break}throw"Failed to get a connection to the peer";case 14:return e.next=16,a.newStream(t.LightPushCodec);case 16:return s=e.sent,d=s.stream,e.prev=18,f=(null===i||void 0===i?void 0:i.pubsubTopic)?i.pubsubTopic:this.pubsubTopic,p=v.PushRPC.createRequest(r,f),e.next=23,l.default([p.encode()],c.default.encode(),d,c.default.decode(),u.default);case 23:if(b=e.sent,e.prev=24,g=v.PushRPC.decode(b.slice()).response){e.next=29;break}return console.log("No response in PushRPC"),e.abrupt("return",null);case 29:return e.abrupt("return",g);case 32:e.prev=32,e.t0=e.catch(24),console.log("Failed to decode push reply",e.t0);case 35:e.next=40;break;case 37:e.prev=37,e.t1=e.catch(18),console.log("Failed to send waku light push request",e.t1);case 40:return e.abrupt("return",null);case 41:case"end":return e.stop()}}),e,this,[[18,37],[24,32]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"peers",get:function(){return f.getPeersForProtocol(this.libp2p,t.LightPushCodec)}},{key:"randomPeer",get:function(){return f.selectRandomPeer(this.peers)}}]),e}();t.WakuLightPush=b},396:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PushRPC=t.PushResponse=t.PushRequest=t.protobufPackage=void 0;var i=n(r(166)),o=n(r(40)),a=r(167);t.protobufPackage="waku.v2";var s={pubsubTopic:""};t.PushRequest={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.default.Writer.create();return""!==e.pubsubTopic&&t.uint32(10).string(e.pubsubTopic),void 0!==e.message&&a.WakuMessage.encode(e.message,t.uint32(18).fork()).ldelim(),t},decode:function(e,t){for(var r=e instanceof o.default.Reader?e:new o.default.Reader(e),n=void 0===t?r.len:r.pos+t,i=Object.assign({},s);r.pos<n;){var u=r.uint32();switch(u>>>3){case 1:i.pubsubTopic=r.string();break;case 2:i.message=a.WakuMessage.decode(r,r.uint32());break;default:r.skipType(7&u)}}return i},fromJSON:function(e){var t=Object.assign({},s);return void 0!==e.pubsubTopic&&null!==e.pubsubTopic?t.pubsubTopic=String(e.pubsubTopic):t.pubsubTopic="",void 0!==e.message&&null!==e.message?t.message=a.WakuMessage.fromJSON(e.message):t.message=void 0,t},toJSON:function(e){var t={};return void 0!==e.pubsubTopic&&(t.pubsubTopic=e.pubsubTopic),void 0!==e.message&&(t.message=e.message?a.WakuMessage.toJSON(e.message):void 0),t},fromPartial:function(e){var t=Object.assign({},s);return void 0!==e.pubsubTopic&&null!==e.pubsubTopic?t.pubsubTopic=e.pubsubTopic:t.pubsubTopic="",void 0!==e.message&&null!==e.message?t.message=a.WakuMessage.fromPartial(e.message):t.message=void 0,t}};var u={isSuccess:!1,info:""};t.PushResponse={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.default.Writer.create();return!0===e.isSuccess&&t.uint32(8).bool(e.isSuccess),""!==e.info&&t.uint32(18).string(e.info),t},decode:function(e,t){for(var r=e instanceof o.default.Reader?e:new o.default.Reader(e),n=void 0===t?r.len:r.pos+t,i=Object.assign({},u);r.pos<n;){var a=r.uint32();switch(a>>>3){case 1:i.isSuccess=r.bool();break;case 2:i.info=r.string();break;default:r.skipType(7&a)}}return i},fromJSON:function(e){var t=Object.assign({},u);return void 0!==e.isSuccess&&null!==e.isSuccess?t.isSuccess=Boolean(e.isSuccess):t.isSuccess=!1,void 0!==e.info&&null!==e.info?t.info=String(e.info):t.info="",t},toJSON:function(e){var t={};return void 0!==e.isSuccess&&(t.isSuccess=e.isSuccess),void 0!==e.info&&(t.info=e.info),t},fromPartial:function(e){var t=Object.assign({},u);return void 0!==e.isSuccess&&null!==e.isSuccess?t.isSuccess=e.isSuccess:t.isSuccess=!1,void 0!==e.info&&null!==e.info?t.info=e.info:t.info="",t}};var c={requestId:""};t.PushRPC={encode:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.default.Writer.create();return""!==e.requestId&&r.uint32(10).string(e.requestId),void 0!==e.request&&t.PushRequest.encode(e.request,r.uint32(18).fork()).ldelim(),void 0!==e.response&&t.PushResponse.encode(e.response,r.uint32(26).fork()).ldelim(),r},decode:function(e,r){for(var n=e instanceof o.default.Reader?e:new o.default.Reader(e),i=void 0===r?n.len:n.pos+r,a=Object.assign({},c);n.pos<i;){var s=n.uint32();switch(s>>>3){case 1:a.requestId=n.string();break;case 2:a.request=t.PushRequest.decode(n,n.uint32());break;case 3:a.response=t.PushResponse.decode(n,n.uint32());break;default:n.skipType(7&s)}}return a},fromJSON:function(e){var r=Object.assign({},c);return void 0!==e.requestId&&null!==e.requestId?r.requestId=String(e.requestId):r.requestId="",void 0!==e.request&&null!==e.request?r.request=t.PushRequest.fromJSON(e.request):r.request=void 0,void 0!==e.response&&null!==e.response?r.response=t.PushResponse.fromJSON(e.response):r.response=void 0,r},toJSON:function(e){var r={};return void 0!==e.requestId&&(r.requestId=e.requestId),void 0!==e.request&&(r.request=e.request?t.PushRequest.toJSON(e.request):void 0),void 0!==e.response&&(r.response=e.response?t.PushResponse.toJSON(e.response):void 0),r},fromPartial:function(e){var r=Object.assign({},c);return void 0!==e.requestId&&null!==e.requestId?r.requestId=e.requestId:r.requestId="",void 0!==e.request&&null!==e.request?r.request=t.PushRequest.fromPartial(e.request):r.request=void 0,void 0!==e.response&&null!==e.response?r.response=t.PushResponse.fromPartial(e.response):r.response=void 0,r}},o.default.util.Long!==i.default&&(o.default.util.Long=i.default,o.default.configure())},397:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPeersForProtocol=t.selectRandomPeer=void 0,t.selectRandomPeer=function(e){if(0!==e.length)return e[Math.round(Math.random()*(e.length-1))]},t.getPeersForProtocol=function(e,t){return Array.from(e.peerStore.peers.values()).filter((function(e){return e.protocols.includes(t)}))}},403:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRelayPeers=void 0;var n=r(76),i=r(111);t.getRelayPeers=function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},a=e.topics.get(t);if(!a)return new Set;var s=[];return a.forEach((function(t){var r=e.peers.get(t);r&&r.protocol==i.RelayCodec&&o(t)&&s.push(t)})),s=n.shuffle(s),r>0&&s.length>r&&(s=s.slice(0,r)),new Set(s)}},404:function(e,t,r){"use strict";var n=r(1),i=r(8),o=r(7),a=r(9),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuStore=t.Direction=t.StoreCodec=void 0;var u=s(r(19)),c=s(r(395)),l=s(r(75)),d=s(r(55)),f=r(397),p=r(232),v=r(111),b=r(863);Object.defineProperty(t,"Direction",{enumerable:!0,get:function(){return b.Direction}});var g=u.default("waku:store");t.StoreCodec="/vac/waku/store/2.0.0-beta3";var h=function(){function e(t,r){o(this,e),this.libp2p=t,(null===r||void 0===r?void 0:r.pubsubTopic)?this.pubsubTopic=r.pubsubTopic:this.pubsubTopic=v.DefaultPubsubTopic}return a(e,[{key:"queryHistory",value:function(){var e=i(n.mark((function e(r){var o,a,s,u,f,v,h,y,m,P,k,O,j,T,w;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=Object.assign({pubsubTopic:this.pubsubTopic,direction:b.Direction.BACKWARD,pageSize:10},r),g("Querying history with the following options",r),!f.peerId){e.next=8;break}if(v=this.libp2p.peerStore.get(f.peerId)){e.next=6;break}throw"Peer is unknown";case 6:e.next=9;break;case 8:v=this.randomPeer;case 9:if(v){e.next=11;break}throw"No peer available";case 11:if(v.protocols.includes(t.StoreCodec)){e.next=13;break}throw"Peer does not register waku store protocol";case 13:if(h=this.libp2p.connectionManager.get(v.id)){e.next=16;break}throw"Failed to get a connection to the peer";case 16:y=[],m=void 0;case 18:return e.prev=19,e.next=22,h.newStream(t.StoreCodec);case 22:return P=e.sent,k=P.stream,e.prev=24,O=Object.assign(f,{cursor:m}),j=b.HistoryRPC.createQuery(O),e.next=29,d.default([j.encode()],l.default.encode(),k,l.default.decode(),c.default);case 29:return T=e.sent,e.prev=30,e.delegateYield(n.mark((function e(){var t,r,c,l,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=b.HistoryRPC.decode(T.slice()),r=t.response){e.next=5;break}return console.log("No response in HistoryRPC"),e.abrupt("return",{v:null});case 5:if(r.messages&&r.messages.length){e.next=8;break}return console.log("No messages present in HistoryRPC response"),e.abrupt("return",{v:y});case 8:return g("".concat(r.messages.length," messages retrieved for pubsub topic ").concat(f.pubsubTopic)),c=[],e.next=12,Promise.all(r.messages.map(function(){var e=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.WakuMessage.decodeProto(t,f.decryptionPrivateKeys);case 2:(r=e.sent)&&(y.push(r),c.push(r));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 12:if(f.callback&&f.callback(c),l=null===(o=r.pagingInfo)||void 0===o?void 0:o.pageSize,d=null===(s=null===(a=j.query)||void 0===a?void 0:a.pagingInfo)||void 0===s?void 0:s.pageSize,!(l&&d&&l<d)){e.next=17;break}return e.abrupt("return",{v:y});case 17:if(void 0!==(m=null===(u=r.pagingInfo)||void 0===u?void 0:u.cursor)){e.next=21;break}return console.log("No cursor returned by peer."),e.abrupt("return",{v:y});case 21:case"end":return e.stop()}}),e)}))(),"t0",32);case 32:if("object"!==typeof(w=e.t0)){e.next=35;break}return e.abrupt("return",w.v);case 35:e.next=40;break;case 37:e.prev=37,e.t1=e.catch(30),console.log("Failed to decode store reply",e.t1);case 40:e.next=45;break;case 42:e.prev=42,e.t2=e.catch(24),console.log("Failed to send waku store query",e.t2);case 45:e.next=50;break;case 47:e.prev=47,e.t3=e.catch(19),console.log("Failed to negotiate waku store protocol stream with peer",e.t3);case 50:e.next=18;break;case 52:case"end":return e.stop()}}),e,this,[[19,47],[24,42],[30,37]])})));return function(t){return e.apply(this,arguments)}}()},{key:"peers",get:function(){return f.getPeersForProtocol(this.libp2p,t.StoreCodec)}},{key:"randomPeer",get:function(){return f.selectRandomPeer(this.peers)}}]),e}();t.WakuStore=h},405:function(e,t,r){"use strict";(function(e){var n=r(22),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.HistoryResponse=t.HistoryQuery=t.ContentFilter=t.PagingInfo=t.Index=t.pagingInfo_DirectionToJSON=t.pagingInfo_DirectionFromJSON=t.PagingInfo_Direction=t.protobufPackage=void 0;var o,a=i(r(166)),s=i(r(40)),u=r(167);function c(e){switch(e){case 0:case"DIRECTION_BACKWARD_UNSPECIFIED":return o.DIRECTION_BACKWARD_UNSPECIFIED;case 1:case"DIRECTION_FORWARD":return o.DIRECTION_FORWARD;case-1:case"UNRECOGNIZED":default:return o.UNRECOGNIZED}}function l(e){switch(e){case o.DIRECTION_BACKWARD_UNSPECIFIED:return"DIRECTION_BACKWARD_UNSPECIFIED";case o.DIRECTION_FORWARD:return"DIRECTION_FORWARD";default:return"UNKNOWN"}}t.protobufPackage="waku.v2",function(e){e[e.DIRECTION_BACKWARD_UNSPECIFIED=0]="DIRECTION_BACKWARD_UNSPECIFIED",e[e.DIRECTION_FORWARD=1]="DIRECTION_FORWARD",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(o=t.PagingInfo_Direction||(t.PagingInfo_Direction={})),t.pagingInfo_DirectionFromJSON=c,t.pagingInfo_DirectionToJSON=l;var d={receivedTime:0};t.Index={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return 0!==e.digest.length&&t.uint32(10).bytes(e.digest),0!==e.receivedTime&&t.uint32(17).double(e.receivedTime),t},decode:function(e,t){var r=e instanceof s.default.Reader?e:new s.default.Reader(e),n=void 0===t?r.len:r.pos+t,i=Object.assign({},d);for(i.digest=new Uint8Array;r.pos<n;){var o=r.uint32();switch(o>>>3){case 1:i.digest=r.bytes();break;case 2:i.receivedTime=r.double();break;default:r.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},d);return t.digest=new Uint8Array,void 0!==e.digest&&null!==e.digest&&(t.digest=function(e){for(var t=y(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}(e.digest)),void 0!==e.receivedTime&&null!==e.receivedTime?t.receivedTime=Number(e.receivedTime):t.receivedTime=0,t},toJSON:function(e){var t={};return void 0!==e.digest&&(t.digest=function(e){var t,r=[],i=n(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push(String.fromCharCode(o))}}catch(a){i.e(a)}finally{i.f()}return m(r.join(""))}(void 0!==e.digest?e.digest:new Uint8Array)),void 0!==e.receivedTime&&(t.receivedTime=e.receivedTime),t},fromPartial:function(e){var t=Object.assign({},d);return void 0!==e.digest&&null!==e.digest?t.digest=e.digest:t.digest=new Uint8Array,void 0!==e.receivedTime&&null!==e.receivedTime?t.receivedTime=e.receivedTime:t.receivedTime=0,t}};var f={pageSize:0,direction:0};t.PagingInfo={encode:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return 0!==e.pageSize&&r.uint32(8).uint64(e.pageSize),void 0!==e.cursor&&t.Index.encode(e.cursor,r.uint32(18).fork()).ldelim(),0!==e.direction&&r.uint32(24).int32(e.direction),r},decode:function(e,r){for(var n=e instanceof s.default.Reader?e:new s.default.Reader(e),i=void 0===r?n.len:n.pos+r,o=Object.assign({},f);n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:o.pageSize=P(n.uint64());break;case 2:o.cursor=t.Index.decode(n,n.uint32());break;case 3:o.direction=n.int32();break;default:n.skipType(7&a)}}return o},fromJSON:function(e){var r=Object.assign({},f);return void 0!==e.pageSize&&null!==e.pageSize?r.pageSize=Number(e.pageSize):r.pageSize=0,void 0!==e.cursor&&null!==e.cursor?r.cursor=t.Index.fromJSON(e.cursor):r.cursor=void 0,void 0!==e.direction&&null!==e.direction?r.direction=c(e.direction):r.direction=0,r},toJSON:function(e){var r={};return void 0!==e.pageSize&&(r.pageSize=e.pageSize),void 0!==e.cursor&&(r.cursor=e.cursor?t.Index.toJSON(e.cursor):void 0),void 0!==e.direction&&(r.direction=l(e.direction)),r},fromPartial:function(e){var r=Object.assign({},f);return void 0!==e.pageSize&&null!==e.pageSize?r.pageSize=e.pageSize:r.pageSize=0,void 0!==e.cursor&&null!==e.cursor?r.cursor=t.Index.fromPartial(e.cursor):r.cursor=void 0,void 0!==e.direction&&null!==e.direction?r.direction=e.direction:r.direction=0,r}};var p={contentTopic:""};t.ContentFilter={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return""!==e.contentTopic&&t.uint32(10).string(e.contentTopic),t},decode:function(e,t){for(var r=e instanceof s.default.Reader?e:new s.default.Reader(e),n=void 0===t?r.len:r.pos+t,i=Object.assign({},p);r.pos<n;){var o=r.uint32();switch(o>>>3){case 1:i.contentTopic=r.string();break;default:r.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},p);return void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=String(e.contentTopic):t.contentTopic="",t},toJSON:function(e){var t={};return void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),t},fromPartial:function(e){var t=Object.assign({},p);return void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=e.contentTopic:t.contentTopic="",t}};var v={};t.HistoryQuery={encode:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();void 0!==e.pubsubTopic&&r.uint32(18).string(e.pubsubTopic);var i,o=n(e.contentFilters);try{for(o.s();!(i=o.n()).done;){var a=i.value;t.ContentFilter.encode(a,r.uint32(26).fork()).ldelim()}}catch(u){o.e(u)}finally{o.f()}return void 0!==e.pagingInfo&&t.PagingInfo.encode(e.pagingInfo,r.uint32(34).fork()).ldelim(),void 0!==e.startTime&&r.uint32(41).double(e.startTime),void 0!==e.endTime&&r.uint32(49).double(e.endTime),r},decode:function(e,r){var n=e instanceof s.default.Reader?e:new s.default.Reader(e),i=void 0===r?n.len:n.pos+r,o=Object.assign({},v);for(o.contentFilters=[];n.pos<i;){var a=n.uint32();switch(a>>>3){case 2:o.pubsubTopic=n.string();break;case 3:o.contentFilters.push(t.ContentFilter.decode(n,n.uint32()));break;case 4:o.pagingInfo=t.PagingInfo.decode(n,n.uint32());break;case 5:o.startTime=n.double();break;case 6:o.endTime=n.double();break;default:n.skipType(7&a)}}return o},fromJSON:function(e){var r=Object.assign({},v);if(r.contentFilters=[],void 0!==e.pubsubTopic&&null!==e.pubsubTopic?r.pubsubTopic=String(e.pubsubTopic):r.pubsubTopic=void 0,void 0!==e.contentFilters&&null!==e.contentFilters){var i,o=n(e.contentFilters);try{for(o.s();!(i=o.n()).done;){var a=i.value;r.contentFilters.push(t.ContentFilter.fromJSON(a))}}catch(s){o.e(s)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?r.pagingInfo=t.PagingInfo.fromJSON(e.pagingInfo):r.pagingInfo=void 0,void 0!==e.startTime&&null!==e.startTime?r.startTime=Number(e.startTime):r.startTime=void 0,void 0!==e.endTime&&null!==e.endTime?r.endTime=Number(e.endTime):r.endTime=void 0,r},toJSON:function(e){var r={};return void 0!==e.pubsubTopic&&(r.pubsubTopic=e.pubsubTopic),e.contentFilters?r.contentFilters=e.contentFilters.map((function(e){return e?t.ContentFilter.toJSON(e):void 0})):r.contentFilters=[],void 0!==e.pagingInfo&&(r.pagingInfo=e.pagingInfo?t.PagingInfo.toJSON(e.pagingInfo):void 0),void 0!==e.startTime&&(r.startTime=e.startTime),void 0!==e.endTime&&(r.endTime=e.endTime),r},fromPartial:function(e){var r=Object.assign({},v);if(r.contentFilters=[],void 0!==e.pubsubTopic&&null!==e.pubsubTopic?r.pubsubTopic=e.pubsubTopic:r.pubsubTopic=void 0,void 0!==e.contentFilters&&null!==e.contentFilters){var i,o=n(e.contentFilters);try{for(o.s();!(i=o.n()).done;){var a=i.value;r.contentFilters.push(t.ContentFilter.fromPartial(a))}}catch(s){o.e(s)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?r.pagingInfo=t.PagingInfo.fromPartial(e.pagingInfo):r.pagingInfo=void 0,void 0!==e.startTime&&null!==e.startTime?r.startTime=e.startTime:r.startTime=void 0,void 0!==e.endTime&&null!==e.endTime?r.endTime=e.endTime:r.endTime=void 0,r}};var b={};t.HistoryResponse={encode:function(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create(),o=n(e.messages);try{for(o.s();!(r=o.n()).done;){var a=r.value;u.WakuMessage.encode(a,i.uint32(10).fork()).ldelim()}}catch(c){o.e(c)}finally{o.f()}return void 0!==e.pagingInfo&&t.PagingInfo.encode(e.pagingInfo,i.uint32(18).fork()).ldelim(),i},decode:function(e,r){var n=e instanceof s.default.Reader?e:new s.default.Reader(e),i=void 0===r?n.len:n.pos+r,o=Object.assign({},b);for(o.messages=[];n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:o.messages.push(u.WakuMessage.decode(n,n.uint32()));break;case 2:o.pagingInfo=t.PagingInfo.decode(n,n.uint32());break;default:n.skipType(7&a)}}return o},fromJSON:function(e){var r=Object.assign({},b);if(r.messages=[],void 0!==e.messages&&null!==e.messages){var i,o=n(e.messages);try{for(o.s();!(i=o.n()).done;){var a=i.value;r.messages.push(u.WakuMessage.fromJSON(a))}}catch(s){o.e(s)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?r.pagingInfo=t.PagingInfo.fromJSON(e.pagingInfo):r.pagingInfo=void 0,r},toJSON:function(e){var r={};return e.messages?r.messages=e.messages.map((function(e){return e?u.WakuMessage.toJSON(e):void 0})):r.messages=[],void 0!==e.pagingInfo&&(r.pagingInfo=e.pagingInfo?t.PagingInfo.toJSON(e.pagingInfo):void 0),r},fromPartial:function(e){var r=Object.assign({},b);if(r.messages=[],void 0!==e.messages&&null!==e.messages){var i,o=n(e.messages);try{for(o.s();!(i=o.n()).done;){var a=i.value;r.messages.push(u.WakuMessage.fromPartial(a))}}catch(s){o.e(s)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?r.pagingInfo=t.PagingInfo.fromPartial(e.pagingInfo):r.pagingInfo=void 0,r}};var g={requestId:""};t.HistoryRPC={encode:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return""!==e.requestId&&r.uint32(10).string(e.requestId),void 0!==e.query&&t.HistoryQuery.encode(e.query,r.uint32(18).fork()).ldelim(),void 0!==e.response&&t.HistoryResponse.encode(e.response,r.uint32(26).fork()).ldelim(),r},decode:function(e,r){for(var n=e instanceof s.default.Reader?e:new s.default.Reader(e),i=void 0===r?n.len:n.pos+r,o=Object.assign({},g);n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:o.requestId=n.string();break;case 2:o.query=t.HistoryQuery.decode(n,n.uint32());break;case 3:o.response=t.HistoryResponse.decode(n,n.uint32());break;default:n.skipType(7&a)}}return o},fromJSON:function(e){var r=Object.assign({},g);return void 0!==e.requestId&&null!==e.requestId?r.requestId=String(e.requestId):r.requestId="",void 0!==e.query&&null!==e.query?r.query=t.HistoryQuery.fromJSON(e.query):r.query=void 0,void 0!==e.response&&null!==e.response?r.response=t.HistoryResponse.fromJSON(e.response):r.response=void 0,r},toJSON:function(e){var r={};return void 0!==e.requestId&&(r.requestId=e.requestId),void 0!==e.query&&(r.query=e.query?t.HistoryQuery.toJSON(e.query):void 0),void 0!==e.response&&(r.response=e.response?t.HistoryResponse.toJSON(e.response):void 0),r},fromPartial:function(e){var r=Object.assign({},g);return void 0!==e.requestId&&null!==e.requestId?r.requestId=e.requestId:r.requestId="",void 0!==e.query&&null!==e.query?r.query=t.HistoryQuery.fromPartial(e.query):r.query=void 0,void 0!==e.response&&null!==e.response?r.response=t.HistoryResponse.fromPartial(e.response):r.response=void 0,r}};var h=function(){if("undefined"!==typeof h)return h;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),y=h.atob||function(e){return h.Buffer.from(e,"base64").toString("binary")};var m=h.btoa||function(e){return h.Buffer.from(e,"binary").toString("base64")};function P(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new h.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}s.default.util.Long!==a.default&&(s.default.util.Long=a.default,s.default.configure())}).call(this,r(32))},406:function(e,t,r){"use strict";(function(e){var n=r(22),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessage=t.protobufPackage=void 0;var o=i(r(166)),a=i(r(40));t.protobufPackage="chat.v2";var s={timestamp:0,nick:""};t.ChatMessage={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.default.Writer.create();return 0!==e.timestamp&&t.uint32(8).uint64(e.timestamp),""!==e.nick&&t.uint32(18).string(e.nick),0!==e.payload.length&&t.uint32(26).bytes(e.payload),t},decode:function(e,t){var r=e instanceof a.default.Reader?e:new a.default.Reader(e),n=void 0===t?r.len:r.pos+t,i=Object.assign({},s);for(i.payload=new Uint8Array;r.pos<n;){var o=r.uint32();switch(o>>>3){case 1:i.timestamp=d(r.uint64());break;case 2:i.nick=r.string();break;case 3:i.payload=r.bytes();break;default:r.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},s);return t.payload=new Uint8Array,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=Number(e.timestamp):t.timestamp=0,void 0!==e.nick&&null!==e.nick?t.nick=String(e.nick):t.nick="",void 0!==e.payload&&null!==e.payload&&(t.payload=function(e){for(var t=c(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}(e.payload)),t},toJSON:function(e){var t={};return void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.nick&&(t.nick=e.nick),void 0!==e.payload&&(t.payload=function(e){var t,r=[],i=n(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push(String.fromCharCode(o))}}catch(a){i.e(a)}finally{i.f()}return l(r.join(""))}(void 0!==e.payload?e.payload:new Uint8Array)),t},fromPartial:function(e){var t=Object.assign({},s);return void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=e.timestamp:t.timestamp=0,void 0!==e.nick&&null!==e.nick?t.nick=e.nick:t.nick="",void 0!==e.payload&&null!==e.payload?t.payload=e.payload:t.payload=new Uint8Array,t}};var u=function(){if("undefined"!==typeof u)return u;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),c=u.atob||function(e){return u.Buffer.from(e,"base64").toString("binary")};var l=u.btoa||function(e){return u.Buffer.from(e,"binary").toString("base64")};function d(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new u.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}a.default.util.Long!==o.default&&(a.default.util.Long=o.default,a.default.configure())}).call(this,r(32))},433:function(e,t,r){},434:function(e,t,r){},459:function(e,t){},461:function(e,t){},472:function(e,t){},474:function(e,t){},500:function(e,t){},501:function(e,t){},507:function(e,t){},526:function(e,t){},544:function(e,t){},545:function(e,t){},568:function(e,t,r){"use strict";var n=r(1),i=r(8),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getStatusFleetNodes=t.Environment=t.Protocol=void 0;var a,s,u=o(r(569));function c(){return(c=i(n.mark((function e(){var t,r,i,o,c=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:s.Prod,r=c.length>1&&void 0!==c[1]?c[1]:a.websocket,e.next=4,u.default.get("https://fleets.status.im/",{headers:{"Content-Type":"application/json"}});case 4:i=e.sent,o=i.data.fleets["wakuv2.".concat(t)],e.t0=r,e.next=e.t0===a.tcp?9:10;break;case 9:return e.abrupt("return",Object.values(o.waku));case 10:return e.abrupt("return",Object.values(o["waku-websocket"]));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e.websocket="websocket",e.tcp="tcp"}(a=t.Protocol||(t.Protocol={})),function(e){e.Test="test",e.Prod="prod"}(s=t.Environment||(t.Environment={})),t.getStatusFleetNodes=function(){return c.apply(this,arguments)}},587:function(e,t,r){"use strict";var n=r(79),i=r(1),o=r(8),a=r(7),s=r(9),u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Waku=void 0;var c=u(r(588)),l=u(r(783)),d=r(789),f=u(r(814)),p=u(r(393)),v=u(r(375)),b=r(45),g=u(r(30)),h=r(394),y=r(111),m=r(404),P=f.default.prototype[Symbol.toStringTag],k=function(){function e(t,r,n,i){var o=this;a(this,e),this.libp2p=r,this.relay=r.pubsub,this.store=n,this.lightPush=i,this.keepAliveTimers={};var s=t.keepAlive||0;0!==s&&(r.connectionManager.on("peer:connect",(function(e){o.startKeepAlive(e.remotePeer,s)})),r.connectionManager.on("peer:disconnect",(function(e){o.stopKeepAlive(e.remotePeer)})))}return s(e,[{key:"dial",value:function(){var e=o(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.libp2p.dialProtocol(t,[y.RelayCodec,m.StoreCodec]));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addPeerToAddressBook",value:function(e,t){var r;r="string"===typeof e?g.default.createFromB58String(e):e;var n=t.map((function(e){return"string"===typeof e?b.multiaddr(e):e}));this.libp2p.peerStore.addressBook.set(r,n)}},{key:"stop",value:function(){var e=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.libp2p.stop());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLocalMultiaddrWithID",value:function(){var e=this.libp2p.multiaddrs.find((function(e){return e.toString().match(/127\.0\.0\.1/)}));if(!e||""===e.toString())throw"Not listening on localhost";return e+"/p2p/"+this.libp2p.peerId.toB58String()}},{key:"startKeepAlive",value:function(e,t){var r=this;this.stopKeepAlive(e);var n=e.toB58String();this.keepAliveTimers[n]=setInterval((function(){v.default(r.libp2p,e)}),1e3*t)}},{key:"stopKeepAlive",value:function(e){var t=e.toB58String();this.keepAliveTimers[t]&&(clearInterval(this.keepAliveTimers[t]),delete this.keepAliveTimers[t])}}],[{key:"create",value:function(){var t=o(i.mark((function t(r){var o,a,s,u,v,b,g;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(u=Object.assign({},null===r||void 0===r?void 0:r.libp2p)).config=Object.assign({transport:n({},P,{filter:p.default.all})},null===(o=null===r||void 0===r?void 0:r.libp2p)||void 0===o?void 0:o.config),(null===r||void 0===r?void 0:r.pubsubTopic)&&(u.config.pubsub=Object.assign({pubsubTopic:r.pubsubTopic},u.config.pubsub)),u.modules=Object.assign({},null===(a=null===r||void 0===r?void 0:r.libp2p)||void 0===a?void 0:a.modules),u.modules=Object.assign({transport:[f.default]},null===(s=null===r||void 0===r?void 0:r.libp2p)||void 0===s?void 0:s.modules),u.modules=Object.assign(u.modules,{streamMuxer:[l.default],connEncryption:[new d.Noise(null===r||void 0===r?void 0:r.staticNoiseKey)],pubsub:y.WakuRelay}),t.next=8,c.default.create(u);case 8:return v=t.sent,b=new m.WakuStore(v,{pubsubTopic:null===r||void 0===r?void 0:r.pubsubTopic}),g=new h.WakuLightPush(v),t.next=13,v.start();case 13:return t.abrupt("return",new e(r||{},v,b,g));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}();t.Waku=k},721:function(e,t){},774:function(e,t){},817:function(e,t){},861:function(e,t,r){"use strict";var n=r(7),i=r(9),o=r(23),a=r(24),s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),u=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return u(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RelayHeartbeat=void 0;var l=r(399),d=r(76),f=c(r(233)),p=r(403),v=function(e){o(r,e);var t=a(r);function r(e){return n(this,r),t.call(this,e)}return i(r,[{key:"start",value:function(){var e=this;if(!this._heartbeatTimer){var t=this._heartbeat.bind(this),r=setTimeout((function(){var r;t(),null===(r=e._heartbeatTimer)||void 0===r||r.runPeriodically(t,f.RelayHeartbeatInterval)}),f.RelayHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:function(t,r){e._heartbeatTimer._intervalId=setInterval(t,r)},cancel:function(){var t;clearTimeout(r),clearInterval(null===(t=e._heartbeatTimer)||void 0===t?void 0:t._intervalId)}}}}},{key:"stop",value:function(){this._heartbeatTimer&&(this._heartbeatTimer.cancel(),this._heartbeatTimer=null)}},{key:"_heartbeat",value:function(){var e=this,t=this.gossipsub._options,r=t.D,n=t.Dlo,i=t.Dhi,o=t.Dscore,a=t.Dout;this.gossipsub.heartbeatTicks++;var s=new Map,u=function(t){var r=s.get(t);return void 0===r&&(r=e.gossipsub.score.score(t),s.set(t,r)),r},c=new Map,l=new Map,v=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((function(t,s){var b=function(r){e.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",r,s),e.gossipsub.score.prune(r,s),e.gossipsub._addBackoff(r,s),t.delete(r);var n=l.get(r);n?n.push(s):l.set(r,[s])},g=function(r){e.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",r,s),e.gossipsub.score.graft(r,s),t.add(r);var n=c.get(r);n?n.push(s):c.set(r,[s])};if(t.forEach((function(t){var r=u(t);r<0&&(e.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",t,r,s),b(t),v.set(t,!0))})),t.size<n){var h=e.gossipsub.backoff.get(s),y=r-t.size;p.getRelayPeers(e.gossipsub,s,y,(function(r){return!t.has(r)&&!e.gossipsub.direct.has(r)&&(!h||!h.has(r))&&u(r)>=0})).forEach(g)}if(t.size>i){var m=Array.from(t);m.sort((function(e,t){return u(t)-u(e)})),m=m.slice(0,o).concat(d.shuffle(m.slice(o)));var P=0;if(m.slice(0,r).forEach((function(t){e.gossipsub.outbound.get(t)&&P++})),P<a){var k=function(e){for(var t=m[e],r=e;r>0;r--)m[r]=m[r-1];m[0]=t};if(P>0)for(var O=P,j=1;j<r&&O>0;j++)e.gossipsub.outbound.get(m[j])&&(k(j),O--);for(var T=r-P,w=r;w<m.length&&T>0;w++)e.gossipsub.outbound.get(m[w])&&(k(w),T--)}m.slice(r).forEach(b)}if(t.size>=n){var _=0;if(t.forEach((function(t){e.gossipsub.outbound.get(t)&&_++})),_<a){var R=a-_,I=e.gossipsub.backoff.get(s);p.getRelayPeers(e.gossipsub,s,R,(function(r){return!t.has(r)&&!e.gossipsub.direct.has(r)&&(!I||!I.has(r))&&u(r)>=0})).forEach(g)}}if(e.gossipsub.heartbeatTicks%f.RelayOpportunisticGraftTicks===0&&t.size>1){var S=Array.from(t).sort((function(e,t){return u(e)-u(t)})),x=t.size/2,D=u(S[x]);if(D<e.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){var M=e.gossipsub.backoff.get(s);p.getRelayPeers(e.gossipsub,s,f.RelayOpportunisticGraftPeers,(function(r){return t.has(r)&&!e.gossipsub.direct.has(r)&&(!M||!M.has(r))&&u(r)>D})).forEach((function(t){e.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,s),g(t)}))}}e.gossipsub._emitGossip(s,t)}));var b=this.gossipsub._now();this.gossipsub.lastpub.forEach((function(t,r){t+f.RelayFanoutTTL<b&&(e.gossipsub.fanout.delete(r),e.gossipsub.lastpub.delete(r))})),this.gossipsub.fanout.forEach((function(t,n){var i=e.gossipsub.topics.get(n);if(t.forEach((function(r){(!(null===i||void 0===i?void 0:i.has(r))||u(r)<e.gossipsub._options.scoreThresholds.publishThreshold)&&t.delete(r)})),t.size<r){var o=r-t.size;p.getRelayPeers(e.gossipsub,n,o,(function(r){return!t.has(r)&&!e.gossipsub.direct.has(r)&&u(r)>=e.gossipsub._options.scoreThresholds.publishThreshold})).forEach((function(e){t.add(e)}))}e.gossipsub._emitGossip(n,t)})),this.gossipsub._sendGraftPrune(c,l,v),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}]),r}(l.Heartbeat);t.RelayHeartbeat=v},862:function(e,t,r){"use strict";var n=r(7),i=r(9),o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.PushRPC=void 0;var u=r(40),c=r(407),l=s(r(396)),d=r(111),f=function(){function e(t){n(this,e),this.proto=t}return i(e,[{key:"encode",value:function(){return l.PushRPC.encode(this.proto).finish()}},{key:"query",get:function(){return this.proto.request}},{key:"response",get:function(){return this.proto.response}}],[{key:"createRequest",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.DefaultPubsubTopic;return new e({requestId:c.v4(),request:{message:t.proto,pubsubTopic:r},response:void 0})}},{key:"decode",value:function(t){return new e(l.PushRPC.decode(u.Reader.create(t)))}}]),e}();t.PushRPC=f},863:function(e,t,r){"use strict";var n=r(7),i=r(9),o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.Direction=void 0;var u,c=r(40),l=r(407),d=s(r(405));!function(e){e.BACKWARD="backward",e.FORWARD="forward"}(u=t.Direction||(t.Direction={}));var f=function(){function e(t){n(this,e),this.proto=t}return i(e,[{key:"encode",value:function(){return d.HistoryRPC.encode(this.proto).finish()}},{key:"query",get:function(){return this.proto.query}},{key:"response",get:function(){return this.proto.response}}],[{key:"createQuery",value:function(t){var r=function(e){switch(e){case u.BACKWARD:return d.PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED;case u.FORWARD:return d.PagingInfo_Direction.DIRECTION_FORWARD;default:return d.PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED}}(t.direction),n={pageSize:t.pageSize,cursor:t.cursor,direction:r},i=t.contentTopics.map((function(e){return{contentTopic:e}}));return new e({requestId:l.v4(),query:{pubsubTopic:t.pubsubTopic,contentFilters:i,pagingInfo:n,startTime:void 0,endTime:void 0},response:void 0})}},{key:"decode",value:function(t){return new e(d.HistoryRPC.decode(c.Reader.create(t)))}}]),e}();t.HistoryRPC=f},864:function(e,t,r){"use strict";(function(e){var n=r(7),i=r(9),o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessage=void 0;var u=r(40),c=s(r(406)),l=function(){function t(e){n(this,t),this.proto=e}return i(t,[{key:"encode",value:function(){return c.ChatMessage.encode(this.proto).finish()}},{key:"timestamp",get:function(){return new Date(1e3*this.proto.timestamp)}},{key:"nick",get:function(){return this.proto.nick}},{key:"payloadAsUtf8",get:function(){return this.proto.payload?Array.from(this.proto.payload).map((function(e){return String.fromCharCode(e)})).join(""):""}}],[{key:"fromUtf8String",value:function(r,n,i){return new t({timestamp:Math.floor(r.valueOf()/1e3),nick:n,payload:e.from(i,"utf-8")})}},{key:"decode",value:function(e){return new t(c.ChatMessage.decode(u.Reader.create(e)))}}]),t}();t.ChatMessage=l}).call(this,r(14).Buffer)},865:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.HistoryResponse=t.HistoryQuery=t.ContentFilter=t.PagingInfo_Direction=t.PagingInfo=t.Index=t.WakuMessage=t.ChatMessage=void 0;var n=r(406);Object.defineProperty(t,"ChatMessage",{enumerable:!0,get:function(){return n.ChatMessage}});var i=r(167);Object.defineProperty(t,"WakuMessage",{enumerable:!0,get:function(){return i.WakuMessage}});var o=r(405);Object.defineProperty(t,"Index",{enumerable:!0,get:function(){return o.Index}}),Object.defineProperty(t,"PagingInfo",{enumerable:!0,get:function(){return o.PagingInfo}}),Object.defineProperty(t,"PagingInfo_Direction",{enumerable:!0,get:function(){return o.PagingInfo_Direction}}),Object.defineProperty(t,"ContentFilter",{enumerable:!0,get:function(){return o.ContentFilter}}),Object.defineProperty(t,"HistoryQuery",{enumerable:!0,get:function(){return o.HistoryQuery}}),Object.defineProperty(t,"HistoryResponse",{enumerable:!0,get:function(){return o.HistoryResponse}}),Object.defineProperty(t,"HistoryRPC",{enumerable:!0,get:function(){return o.HistoryRPC}})},870:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),o=r(33),a=r.n(o),s=(r(433),r(51)),u=(r(242),r(434),r(176)),c=(r(435),r(917)),l=r(918),d=r(919),f=r(180),p=r(902),v=r(1),b=r.n(v),g=r(27),h=r(39);function y(){return(y=Object(g.a)(b.a.mark((function e(t,r){var n,i,o,a,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t,r);case 2:n=e.sent,i=n.salt,o=n.iv,a=n.cipher,s={salt:Object(h.bufToHex)(i),iv:Object(h.bufToHex)(o),cipher:Object(h.bufToHex)(a)},localStorage.setItem("cipherEthDmKeyPair",JSON.stringify(s));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return(m=Object(g.a)(b.a.mark((function e(t){var r,n,i,o,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=localStorage.getItem("cipherEthDmKeyPair")){e.next=3;break}return e.abrupt("return");case 3:return n=JSON.parse(r),i=Object(h.hexToBuf)(n.salt),o=Object(h.hexToBuf)(n.iv),a=Object(h.hexToBuf)(n.cipher),e.next=9,T(i,o,a,t);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){var t=new TextEncoder;return window.crypto.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}function k(e,t){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}function O(e,t){return j.apply(this,arguments)}function j(){return(j=Object(g.a)(b.a.mark((function e(t,r){var n,i,o,a,s,u,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(r);case 2:return n=e.sent,i=window.crypto.getRandomValues(new Uint8Array(16)),e.next=6,k(n,i);case 6:return o=e.sent,a=new TextEncoder,s=a.encode(JSON.stringify(t)),u=window.crypto.getRandomValues(new Uint8Array(12)),e.next=12,window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},o,s);case 12:return c=e.sent,e.abrupt("return",{salt:i,iv:u,cipher:c});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,r,n){return w.apply(this,arguments)}function w(){return(w=Object(g.a)(b.a.mark((function e(t,r,n,i){var o,a,s,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(i);case 2:return o=e.sent,e.next=5,k(o,t);case 5:return a=e.sent,e.prev=6,e.next=9,window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},a,n);case 9:return s=e.sent,u=new TextDecoder,e.abrupt("return",JSON.parse(u.decode(s)));case 14:return e.prev=14,e.t0=e.catch(6),e.abrupt("return");case 17:case"end":return e.stop()}}),e,null,[[6,14]])})))).apply(this,arguments)}var _=r(13);function R(e){var t=e.password,r=e.disabled,n=e.setEthDmKeyPair;return Object(_.jsx)(p.a,{variant:"contained",color:"primary",onClick:function(){r||t&&function(e){return m.apply(this,arguments)}(t).then((function(e){e&&(console.log("EthDm KeyPair loaded from storage"),n(e))}))},disabled:!t||r,children:"Load Eth-DM Key Pair from storage"})}function I(e){var t=e.password,r=e.ethDmKeyPair;return Object(_.jsx)(p.a,{variant:"contained",color:"primary",onClick:function(){r&&t&&function(e,t){return y.apply(this,arguments)}(r,t).then((function(){console.log("EthDm KeyPair saved to storage")}))},disabled:!t||!r,children:"Save Eth-DM Key Pair to storage"})}var S=r(5),x=r(6),D=r(178),M=D.Root,C=D.Type,E=D.Field,N=function(){function e(t){Object(S.a)(this,e),this.payload=t}return Object(x.a)(e,[{key:"encode",value:function(){var t=e.Type.create(this.payload);return e.Type.encode(t).finish()}},{key:"ethDmPublicKey",get:function(){return this.payload.ethDmPublicKey}},{key:"ethAddress",get:function(){return this.payload.ethAddress}},{key:"signature",get:function(){return this.payload.signature}}],[{key:"decode",value:function(t){var r=e.Type.decode(t);if(r.signature&&r.ethDmPublicKey&&r.ethAddress)return new e(r);console.log("Field missing on decoded Public Key Message",r)}}]),e}();N.Type=new C("PublicKeyMessage").add(new E("ethDmPublicKey",1,"bytes")).add(new E("ethAddress",2,"bytes")).add(new E("signature",3,"bytes")),N.Root=(new M).define("messages").add(N.Type);var A=function(){function e(t){Object(S.a)(this,e),this.payload=t}return Object(x.a)(e,[{key:"encode",value:function(){var t=e.Type.create(this.payload);return e.Type.encode(t).finish()}},{key:"toAddress",get:function(){return this.payload.toAddress}},{key:"message",get:function(){return this.payload.message}}],[{key:"decode",value:function(t){var r=e.Type.decode(t);if(r.toAddress&&r.message)return new e(r);console.log("Field missing on decoded Direct Message",r)}}]),e}();A.Type=new C("DirectMessage").add(new E("toAddress",1,"bytes")).add(new E("message",2,"string")),A.Root=(new M).define("messages").add(A.Type);var q=r(175);function B(){return(B=Object(g.a)(b.a.mark((function e(){var t,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(q.generatePrivateKey)(),r=Object(q.getPublicKey)(t),e.abrupt("return",{privateKey:t,publicKey:r});case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=Object(g.a)(b.a.mark((function e(t,r){var n,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getAddress();case 2:return n=e.sent,e.next=5,t.signMessage(K(r));case 5:return i=e.sent,e.abrupt("return",new N({ethDmPublicKey:r,ethAddress:Object(h.hexToBuf)(n),signature:Object(h.hexToBuf)(i)}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return JSON.stringify({ethDmPublicKey:Object(h.bufToHex)(e)})}var W=r(911),H=r(921);function J(e){var t=e.password,r=e.setPassword;return Object(_.jsx)(H.a,{id:"password-input",label:"Password",variant:"filled",type:"password",onChange:function(e){r(e.target.value)},value:t})}var z=Object(W.a)({root:{textAlign:"center",display:"flex",alignItems:"center",flexDirection:"column",margin:"5px"},generate:{margin:"5px"},storage:{margin:"5px"},loadSave:{display:"flex",flexDirection:"row",margin:"5px"},loadSaveButton:{margin:"5px"}});function U(e){var t=e.ethDmKeyPair,r=e.setEthDmKeyPair,i=z(),o=Object(n.useState)(),a=Object(s.a)(o,2),u=a[0],c=a[1];return Object(_.jsxs)("div",{className:i.root,children:[Object(_.jsx)(p.a,{className:i.generate,variant:"contained",color:"primary",onClick:function(){t||function(){return B.apply(this,arguments)}().then((function(e){r(e)})).catch((function(e){console.error("Failed to generate Key Pair",e)}))},disabled:!!t,children:"Generate Eth-DM Key Pair"}),Object(_.jsxs)("div",{className:i.storage,children:[Object(_.jsx)(J,{password:u,setPassword:function(e){return c(e)}}),Object(_.jsxs)("div",{className:i.loadSave,children:[Object(_.jsx)("div",{className:i.loadSaveButton,children:Object(_.jsx)(R,{setEthDmKeyPair:function(e){return r(e)},disabled:!!t,password:u})}),Object(_.jsx)("div",{className:i.loadSaveButton,children:Object(_.jsx)(I,{ethDmKeyPair:t,password:u})})]})]})]})}var L=r(418),G=r(916),Q=r(914),V=r(915),X=r(177),Z=r(417),Y=r.n(Z),$=r(103),ee="/eth-dm/1/public-key/proto",te="/eth-dm/1/direct-message/proto";function re(){return(re=Object(g.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.Waku.create({});case 2:return t=e.sent,Object($.getStatusFleetNodes)().then((function(e){e.forEach((function(e){t.dial(e)}))})),e.next=6,new Promise((function(e,r){setTimeout(r,1e4),t.libp2p.connectionManager.on("peer:connect",(function(){e(null)}))}));case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e,t,r){if(console.log("Public Key Message received:",r),r.payload){var n=N.decode(r.payload);if(n){var i=Object(h.bufToHex)(n.ethDmPublicKey);if(console.log(i,e),!e||!Object(h.equalByteArrays)(n.ethAddress,e)){var o=function(e){var t=K(e.ethDmPublicKey);try{var r=u.a.utils.verifyMessage(t,e.signature);return Object(h.equalByteArrays)(r,e.ethAddress)}catch(n){return console.log("Failed to verify signature for Public Key Message",t,e),!1}}(n);console.log("Is Public Key Message valid?",o),o&&t((function(e){return e.set(Object(h.bufToHex)(n.ethAddress),i),new Map(e)}))}}}}function ie(e,t,r,n){return oe.apply(this,arguments)}function oe(){return(oe=Object(g.a)(b.a.mark((function e(t,r,n,i){var o,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Direct Message received:",i),i.payload){e.next=3;break}return e.abrupt("return");case 3:if(o=A.decode(i.payload)){e.next=7;break}return console.log("Failed to decode Direct Message"),e.abrupt("return");case 7:if(Object(h.equalByteArrays)(o.toAddress,n)){e.next=9;break}return e.abrupt("return");case 9:a=i.timestamp?i.timestamp:new Date,console.log("Message decrypted:",o.message),t((function(e){var t=e.slice();return t.push({text:o.message,timestamp:a}),t}));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){var t=e.signer,r=e.ethDmKeyPair,i=e.waku,o=Object(n.useState)(),a=Object(s.a)(o,2),u=a[0],c=a[1];return Object(_.jsx)(p.a,{variant:"contained",color:"primary",onClick:function(){r&&t&&i&&(u?se(u).then((function(e){i.lightPush.push(e).catch((function(e){console.error("Failed to send Public Key Message",e)}))})).catch((function(e){console.log("Failed to encode Public Key Message in Waku Message")})):function(e,t){return F.apply(this,arguments)}(t,r.publicKey).then((function(e){c(e),se(e).then((function(e){i.lightPush.push(e).then((function(e){return console.log("Public Key Message pushed",e)})).catch((function(e){console.error("Failed to send Public Key Message",e)}))})).catch((function(e){console.log("Failed to encode Public Key Message in Waku Message")}))})).catch((function(e){console.error("Failed to create public key message",e)})))},disabled:!r||!i,children:"Broadcast Eth-DM Public Key"})}function se(e){return ue.apply(this,arguments)}function ue(){return(ue=Object(g.a)(b.a.mark((function e(t){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.encode(),e.next=3,$.WakuMessage.fromBytes(r,{contentTopic:ee});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ce=r(910),le=r(873),de=r(912);function fe(e){var t=e.messages;return Object(_.jsx)(ce.a,{dense:!0,children:pe(t)})}function pe(e){return e.map((function(e){var t="<".concat(ve(e.timestamp),"> ").concat(e.text);return Object(_.jsx)(le.a,{children:Object(_.jsx)(de.a,{primary:t},ve(e.timestamp))})}))}function ve(e){return e.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!1})}var be=r(913),ge=r(909),he=r(923),ye=r(920),me=Object(W.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},selectEmpty:{marginTop:e.spacing(2)}}}));function Pe(e){var t=e.waku,r=e.recipients,i=me(),o=Object(n.useState)(""),a=Object(s.a)(o,2),u=a[0],c=a[1],l=Object(n.useState)(),d=Object(s.a)(l,2),f=d[0],p=d[1],v=Array.from(r.keys()).map((function(e){return Object(_.jsx)(be.a,{value:e,children:e},e)})),h=function(){var e=Object(g.a)(b.a.mark((function e(n){var i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==n.key||n.altKey||n.ctrlKey||n.shiftKey){e.next=11;break}if(t){e.next=3;break}return e.abrupt("return");case 3:if(u){e.next=5;break}return e.abrupt("return");case 5:if(f){e.next=7;break}return e.abrupt("return");case 7:if(i=r.get(u)){e.next=10;break}return e.abrupt("return");case 10:Oe(t,u,i,f,(function(e){e&&(console.log("callback called with",e),p(""))}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(_.jsxs)("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap"},children:[Object(_.jsxs)(ge.a,{className:i.formControl,children:[Object(_.jsx)(he.a,{id:"select-recipient-label",children:"Recipient"}),Object(_.jsx)(ye.a,{labelId:"select-recipient",id:"select-recipient",value:u,onChange:function(e){c(e.target.value)},children:v})]}),Object(_.jsx)(H.a,{id:"message-input",label:"Message",variant:"filled",onChange:function(e){p(e.target.value)},onKeyDown:h,value:f})]})}function ke(){return(ke=Object(g.a)(b.a.mark((function e(t,r,n){var i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new A({toAddress:Object(h.hexToBuf)(n),message:t}),o=i.encode(),e.abrupt("return",$.WakuMessage.fromBytes(o,{contentTopic:te,encPublicKey:r}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e,t,r,n,i){(function(e,t,r){return ke.apply(this,arguments)})(n,r,t).then((function(t){console.log("pushing"),e.lightPush.push(t).then((function(e){console.log("Message sent",e),i(!!e&&e.isSuccess)})).catch((function(e){console.error("Failed to send message",e),i(!1)}))})).catch((function(e){console.error("Cannot encode & encrypt message",e),i(!1)}))}var je=Object(W.a)({root:{display:"flex",alignItems:"left",flexDirection:"column",margin:"5px"}});function Te(e){var t=e.waku,r=e.recipients,n=e.messages,i=je();return Object(_.jsxs)("div",{className:i.root,children:[Object(_.jsx)(Pe,{recipients:r,waku:t}),Object(_.jsx)(fe,{messages:n})]})}var we=Object(L.a)({palette:{primary:{main:Q.a[500]},secondary:{main:V.a[600]}}}),_e=Object(W.a)({root:{textAlign:"center",display:"flex",flexDirection:"column",minHeight:"100vh"},appBar:{},container:{display:"flex",flex:1},main:{flex:1,margin:"10px"},wakuStatus:{marginRight:we.spacing(2)},title:{flexGrow:1},peers:{}});var Re=function(){var e=Object(n.useState)(),t=Object(s.a)(e,2),r=t[0],i=t[1],o=Object(n.useState)(),a=Object(s.a)(o,2),p=a[0],v=a[1],b=Object(n.useState)(),g=Object(s.a)(b,2),h=g[0],y=g[1],m=Object(n.useState)(new Map),P=Object(s.a)(m,2),k=P[0],O=P[1],j=Object(n.useState)([]),T=Object(s.a)(j,2),w=T[0],R=T[1],I=Object(n.useState)(),S=Object(s.a)(I,2),x=S[0],D=S[1],M=_e();Object(n.useEffect)((function(){try{window.ethereum.request({method:"eth_requestAccounts"}).then((function(e){var t=new u.a.providers.Web3Provider(window.ethereum);D(e[0]),v(t.getSigner())}))}catch(e){console.error("No web3 provider available")}}),[x,p]),Object(n.useEffect)((function(){r||function(){return re.apply(this,arguments)}().then((function(e){console.log("waku: ready"),i(e)})).catch((function(e){console.error("Failed to initiate Waku",e)}))}),[r]),Object(n.useEffect)((function(){if(r&&x){var e=ne.bind({},x,O);return r.relay.addObserver(e,[ee]),function(){r&&r.relay.deleteObserver(e,[ee])}}}),[r,x]),Object(n.useEffect)((function(){if(r&&h)return r.relay.addDecryptionPrivateKey(h.privateKey),function(){r&&h&&r.relay.deleteDecryptionPrivateKey(h.privateKey)}}),[r,h]),Object(n.useEffect)((function(){if(r&&h&&x){var e=ie.bind({},R,h.privateKey,x);return r.relay.addObserver(e,[te]),function(){r&&e&&r.relay.deleteObserver(e,[te])}}}),[r,x,h]);var C=0,E=0;r&&(C=r.relay.getPeers().size,E=r.lightPush.peers.length);var N="";return x&&(N=x.substr(0,6)+"..."+x.substr(x.length-4,4)),Object(_.jsx)(G.a,{theme:we,children:Object(_.jsxs)("div",{className:M.root,children:[Object(_.jsx)(c.a,{className:M.appBar,position:"static",children:Object(_.jsxs)(l.a,{children:[Object(_.jsx)(d.a,{edge:"start",className:M.wakuStatus,"aria-label":"waku-status",children:Object(_.jsx)(Y.a,{color:r?void 0:"disabled",style:r?{color:X.a[500]}:{}})}),Object(_.jsxs)(f.a,{className:M.peers,"aria-label":"connected-peers",children:["Peers: ",C," relay, ",E," light push"]}),Object(_.jsx)(f.a,{variant:"h6",className:M.title,children:"Ethereum Direct Message"}),Object(_.jsx)(f.a,{children:N})]})}),Object(_.jsx)("div",{className:M.container,children:Object(_.jsxs)("main",{className:M.main,children:[Object(_.jsxs)("fieldset",{children:[Object(_.jsx)("legend",{children:"Eth-DM Key Pair"}),Object(_.jsx)(U,{ethDmKeyPair:h,setEthDmKeyPair:function(e){return y(e)}}),Object(_.jsx)(ae,{signer:p,ethDmKeyPair:h,waku:r})]}),Object(_.jsxs)("fieldset",{children:[Object(_.jsx)("legend",{children:"Messaging"}),Object(_.jsx)(Te,{recipients:k,waku:r,messages:w})]})]})})]})})};a.a.render(Object(_.jsx)(i.a.StrictMode,{children:Object(_.jsx)(Re,{})}),document.getElementById("root"))}},[[870,1,2]]]);
//# sourceMappingURL=main.39cfc894.chunk.js.map