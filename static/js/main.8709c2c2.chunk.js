(this["webpackJsonpweb-chat"]=this["webpackJsonpweb-chat"]||[]).push([[0],{114:function(e,t){},144:function(e,t,n){"use strict";(function(e){var r=n(3),o=n(4),i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuMessage=t.DefaultContentTopic=void 0;var u=n(29),c=s(n(145));t.DefaultContentTopic="/waku/2/default-content/proto";var f=function(){function n(e){r(this,n),this.proto=e}return o(n,[{key:"encode",value:function(){return c.WakuMessage.encode(this.proto).finish()}},{key:"payloadAsUtf8",get:function(){return this.proto.payload?Array.from(this.proto.payload).map((function(e){return String.fromCharCode(e)})).join(""):""}},{key:"payload",get:function(){return this.proto.payload}},{key:"contentTopic",get:function(){return this.proto.contentTopic}},{key:"version",get:function(){return this.proto.version}}],[{key:"fromUtf8String",value:function(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DefaultContentTopic,i=e.from(r,"utf-8");return new n({payload:i,version:0,contentTopic:o})}},{key:"fromBytes",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DefaultContentTopic;return new n({payload:e,version:0,contentTopic:r})}},{key:"decode",value:function(e){return new n(c.WakuMessage.decode(u.Reader.create(e)))}}]),n}();t.WakuMessage=f}).call(this,n(7).Buffer)},145:function(e,t,n){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuMessage=t.protobufPackage=void 0;var o=r(n(146)),i=r(n(29));t.protobufPackage="waku.v2";var a={};t.WakuMessage={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.Writer.create();return void 0!==e.payload&&t.uint32(10).bytes(e.payload),void 0!==e.contentTopic&&t.uint32(18).string(e.contentTopic),void 0!==e.version&&t.uint32(24).uint32(e.version),void 0!==e.timestamp&&t.uint32(33).double(e.timestamp),t},decode:function(e,t){for(var n=e instanceof i.default.Reader?e:new i.default.Reader(e),r=void 0===t?n.len:n.pos+t,o=Object.assign({},a);n.pos<r;){var s=n.uint32();switch(s>>>3){case 1:o.payload=n.bytes();break;case 2:o.contentTopic=n.string();break;case 3:o.version=n.uint32();break;case 4:o.timestamp=n.double();break;default:n.skipType(7&s)}}return o},fromJSON:function(e){var t=Object.assign({},a);return void 0!==e.payload&&null!==e.payload&&(t.payload=function(e){for(var t=u(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}(e.payload)),void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=String(e.contentTopic):t.contentTopic=void 0,void 0!==e.version&&null!==e.version?t.version=Number(e.version):t.version=void 0,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=Number(e.timestamp):t.timestamp=void 0,t},toJSON:function(e){var t={};return void 0!==e.payload&&(t.payload=void 0!==e.payload?function(e){for(var t=[],n=0;n<e.byteLength;++n)t.push(String.fromCharCode(e[n]));return c(t.join(""))}(e.payload):void 0),void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),void 0!==e.version&&(t.version=e.version),void 0!==e.timestamp&&(t.timestamp=e.timestamp),t},fromPartial:function(e){var t=Object.assign({},a);return void 0!==e.payload&&null!==e.payload?t.payload=e.payload:t.payload=void 0,void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=e.contentTopic:t.contentTopic=void 0,void 0!==e.version&&null!==e.version?t.version=e.version:t.version=void 0,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=e.timestamp:t.timestamp=void 0,t}};var s=function(){if("undefined"!==typeof s)return s;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),u=s.atob||function(e){return s.Buffer.from(e,"base64").toString("binary")};var c=s.btoa||function(e){return s.Buffer.from(e,"binary").toString("base64")};i.default.util.Long!==o.default&&(i.default.util.Long=o.default,i.default.configure())}).call(this,n(34))},147:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RelayMaxIHaveLength=t.RelayOpportunisticGraftPeers=t.RelayOpportunisticGraftTicks=t.RelayFanoutTTL=t.RelayPruneBackoff=t.RelayPrunePeers=t.RelayHeartbeatInterval=t.RelayHeartbeatInitialDelay=t.RelayGossipFactor=t.DefaultPubsubTopic=t.RelayCodec=t.minute=t.second=void 0,t.second=1e3,t.minute=60*t.second,t.RelayCodec="/vac/waku/relay/2.0.0-beta2",t.DefaultPubsubTopic="/waku/2/default-waku/proto",t.RelayGossipFactor=.25,t.RelayHeartbeatInitialDelay=100,t.RelayHeartbeatInterval=t.second,t.RelayPrunePeers=16,t.RelayPruneBackoff=t.minute,t.RelayFanoutTTL=t.minute,t.RelayOpportunisticGraftTicks=60,t.RelayOpportunisticGraftPeers=2,t.RelayMaxIHaveLength=5e3},258:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRelayPeers=void 0;var r=n(49),o=n(97);t.getRelayPeers=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},a=e.topics.get(t);if(!a)return new Set;var s=[];return a.forEach((function(t){var n=e.peers.get(t);n&&n.protocol==o.RelayCodec&&i(t)&&s.push(t)})),s=r.shuffle(s),n>0&&s.length>n&&(s=s.slice(0,n)),new Set(s)}},259:function(e,t,n){"use strict";var r=n(1),o=n(5),i=n(3),a=n(4),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuStore=t.StoreCodec=void 0;var u=s(n(709)),c=s(n(60)),f=s(n(30)),d=n(144),l=n(97),p=n(711);t.StoreCodec="/vac/waku/store/2.0.0-beta3";var v=function(){function e(t){i(this,e),this.libp2p=t}return a(e,[{key:"queryHistory",value:function(){var e=o(r.mark((function e(n){var o,i,a,s,v,g,h,b,m,y,k,O,T,_,I,j,P,S,R;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v=Object.assign({pubsubTopic:l.DefaultPubsubTopic,direction:p.Direction.BACKWARD,pageSize:10},n),g=this.libp2p.peerStore.get(v.peerId)){e.next=4;break}throw"Peer is unknown";case 4:if(g.protocols.includes(t.StoreCodec)){e.next=6;break}throw"Peer does not register waku store protocol";case 6:if(h=this.libp2p.connectionManager.get(g.id)){e.next=9;break}throw"Failed to get a connection to the peer";case 9:b=[],m=void 0;case 11:return e.prev=12,e.next=15,h.newStream(t.StoreCodec);case 15:return y=e.sent,k=y.stream,e.prev=17,O=Object.assign(v,{cursor:m}),T=p.HistoryRPC.createQuery(O),e.next=22,f.default([T.encode()],c.default.encode(),k,c.default.decode(),u.default);case 22:if(_=e.sent,e.prev=23,I=p.HistoryRPC.decode(_.slice()),j=I.response){e.next=29;break}return console.log("No response in HistoryRPC"),e.abrupt("return",null);case 29:if(j.messages&&j.messages.length){e.next=32;break}return console.log("No messages present in HistoryRPC response"),e.abrupt("return",b);case 32:if(P=j.messages.map((function(e){return new d.WakuMessage(e)})),v.callback&&v.callback(P),P.forEach((function(e){b.push(e)})),S=null===(o=j.pagingInfo)||void 0===o?void 0:o.pageSize,R=null===(a=null===(i=T.query)||void 0===i?void 0:i.pagingInfo)||void 0===a?void 0:a.pageSize,!(S&&R&&S<R)){e.next=39;break}return e.abrupt("return",b);case 39:if(void 0!==(m=null===(s=j.pagingInfo)||void 0===s?void 0:s.cursor)){e.next=43;break}return console.log("No cursor returned by peer."),e.abrupt("return",b);case 43:e.next=48;break;case 45:e.prev=45,e.t0=e.catch(23),console.log("Failed to decode store reply",e.t0);case 48:e.next=53;break;case 50:e.prev=50,e.t1=e.catch(17),console.log("Failed to send waku store query",e.t1);case 53:e.next=58;break;case 55:e.prev=55,e.t2=e.catch(12),console.log("Failed to negotiate waku store protocol stream with peer",e.t2);case 58:e.next=11;break;case 60:case"end":return e.stop()}}),e,this,[[12,55],[17,50],[23,45]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.WakuStore=v},260:function(e,t,n){"use strict";(function(e){var r=n(6),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.HistoryResponse=t.HistoryQuery=t.ContentFilter=t.PagingInfo=t.Index=t.pagingInfo_DirectionToJSON=t.pagingInfo_DirectionFromJSON=t.PagingInfo_Direction=t.protobufPackage=void 0;var i,a=o(n(146)),s=o(n(29)),u=n(145);function c(e){switch(e){case 0:case"DIRECTION_BACKWARD_UNSPECIFIED":return i.DIRECTION_BACKWARD_UNSPECIFIED;case 1:case"DIRECTION_FORWARD":return i.DIRECTION_FORWARD;case-1:case"UNRECOGNIZED":default:return i.UNRECOGNIZED}}function f(e){switch(e){case i.DIRECTION_BACKWARD_UNSPECIFIED:return"DIRECTION_BACKWARD_UNSPECIFIED";case i.DIRECTION_FORWARD:return"DIRECTION_FORWARD";default:return"UNKNOWN"}}t.protobufPackage="waku.v2",function(e){e[e.DIRECTION_BACKWARD_UNSPECIFIED=0]="DIRECTION_BACKWARD_UNSPECIFIED",e[e.DIRECTION_FORWARD=1]="DIRECTION_FORWARD",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(i=t.PagingInfo_Direction||(t.PagingInfo_Direction={})),t.pagingInfo_DirectionFromJSON=c,t.pagingInfo_DirectionToJSON=f;var d={receivedTime:0};t.Index={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return 0!==e.digest.length&&t.uint32(10).bytes(e.digest),0!==e.receivedTime&&t.uint32(17).double(e.receivedTime),t},decode:function(e,t){var n=e instanceof s.default.Reader?e:new s.default.Reader(e),r=void 0===t?n.len:n.pos+t,o=Object.assign({},d);for(o.digest=new Uint8Array;n.pos<r;){var i=n.uint32();switch(i>>>3){case 1:o.digest=n.bytes();break;case 2:o.receivedTime=n.double();break;default:n.skipType(7&i)}}return o},fromJSON:function(e){var t=Object.assign({},d);return t.digest=new Uint8Array,void 0!==e.digest&&null!==e.digest&&(t.digest=function(e){for(var t=m(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}(e.digest)),void 0!==e.receivedTime&&null!==e.receivedTime?t.receivedTime=Number(e.receivedTime):t.receivedTime=0,t},toJSON:function(e){var t={};return void 0!==e.digest&&(t.digest=function(e){for(var t=[],n=0;n<e.byteLength;++n)t.push(String.fromCharCode(e[n]));return y(t.join(""))}(void 0!==e.digest?e.digest:new Uint8Array)),void 0!==e.receivedTime&&(t.receivedTime=e.receivedTime),t},fromPartial:function(e){var t=Object.assign({},d);return void 0!==e.digest&&null!==e.digest?t.digest=e.digest:t.digest=new Uint8Array,void 0!==e.receivedTime&&null!==e.receivedTime?t.receivedTime=e.receivedTime:t.receivedTime=0,t}};var l={pageSize:0,direction:0};t.PagingInfo={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return 0!==e.pageSize&&n.uint32(8).uint64(e.pageSize),void 0!==e.cursor&&t.Index.encode(e.cursor,n.uint32(18).fork()).ldelim(),0!==e.direction&&n.uint32(24).int32(e.direction),n},decode:function(e,n){for(var r=e instanceof s.default.Reader?e:new s.default.Reader(e),o=void 0===n?r.len:r.pos+n,i=Object.assign({},l);r.pos<o;){var a=r.uint32();switch(a>>>3){case 1:i.pageSize=k(r.uint64());break;case 2:i.cursor=t.Index.decode(r,r.uint32());break;case 3:i.direction=r.int32();break;default:r.skipType(7&a)}}return i},fromJSON:function(e){var n=Object.assign({},l);return void 0!==e.pageSize&&null!==e.pageSize?n.pageSize=Number(e.pageSize):n.pageSize=0,void 0!==e.cursor&&null!==e.cursor?n.cursor=t.Index.fromJSON(e.cursor):n.cursor=void 0,void 0!==e.direction&&null!==e.direction?n.direction=c(e.direction):n.direction=0,n},toJSON:function(e){var n={};return void 0!==e.pageSize&&(n.pageSize=e.pageSize),void 0!==e.cursor&&(n.cursor=e.cursor?t.Index.toJSON(e.cursor):void 0),void 0!==e.direction&&(n.direction=f(e.direction)),n},fromPartial:function(e){var n=Object.assign({},l);return void 0!==e.pageSize&&null!==e.pageSize?n.pageSize=e.pageSize:n.pageSize=0,void 0!==e.cursor&&null!==e.cursor?n.cursor=t.Index.fromPartial(e.cursor):n.cursor=void 0,void 0!==e.direction&&null!==e.direction?n.direction=e.direction:n.direction=0,n}};var p={contentTopic:""};t.ContentFilter={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return""!==e.contentTopic&&t.uint32(10).string(e.contentTopic),t},decode:function(e,t){for(var n=e instanceof s.default.Reader?e:new s.default.Reader(e),r=void 0===t?n.len:n.pos+t,o=Object.assign({},p);n.pos<r;){var i=n.uint32();switch(i>>>3){case 1:o.contentTopic=n.string();break;default:n.skipType(7&i)}}return o},fromJSON:function(e){var t=Object.assign({},p);return void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=String(e.contentTopic):t.contentTopic="",t},toJSON:function(e){var t={};return void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),t},fromPartial:function(e){var t=Object.assign({},p);return void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=e.contentTopic:t.contentTopic="",t}};var v={};t.HistoryQuery={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();void 0!==e.pubsubTopic&&n.uint32(18).string(e.pubsubTopic);var o,i=r(e.contentFilters);try{for(i.s();!(o=i.n()).done;){var a=o.value;t.ContentFilter.encode(a,n.uint32(26).fork()).ldelim()}}catch(u){i.e(u)}finally{i.f()}return void 0!==e.pagingInfo&&t.PagingInfo.encode(e.pagingInfo,n.uint32(34).fork()).ldelim(),void 0!==e.startTime&&n.uint32(41).double(e.startTime),void 0!==e.endTime&&n.uint32(49).double(e.endTime),n},decode:function(e,n){var r=e instanceof s.default.Reader?e:new s.default.Reader(e),o=void 0===n?r.len:r.pos+n,i=Object.assign({},v);for(i.contentFilters=[];r.pos<o;){var a=r.uint32();switch(a>>>3){case 2:i.pubsubTopic=r.string();break;case 3:i.contentFilters.push(t.ContentFilter.decode(r,r.uint32()));break;case 4:i.pagingInfo=t.PagingInfo.decode(r,r.uint32());break;case 5:i.startTime=r.double();break;case 6:i.endTime=r.double();break;default:r.skipType(7&a)}}return i},fromJSON:function(e){var n=Object.assign({},v);if(n.contentFilters=[],void 0!==e.pubsubTopic&&null!==e.pubsubTopic?n.pubsubTopic=String(e.pubsubTopic):n.pubsubTopic=void 0,void 0!==e.contentFilters&&null!==e.contentFilters){var o,i=r(e.contentFilters);try{for(i.s();!(o=i.n()).done;){var a=o.value;n.contentFilters.push(t.ContentFilter.fromJSON(a))}}catch(s){i.e(s)}finally{i.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromJSON(e.pagingInfo):n.pagingInfo=void 0,void 0!==e.startTime&&null!==e.startTime?n.startTime=Number(e.startTime):n.startTime=void 0,void 0!==e.endTime&&null!==e.endTime?n.endTime=Number(e.endTime):n.endTime=void 0,n},toJSON:function(e){var n={};return void 0!==e.pubsubTopic&&(n.pubsubTopic=e.pubsubTopic),e.contentFilters?n.contentFilters=e.contentFilters.map((function(e){return e?t.ContentFilter.toJSON(e):void 0})):n.contentFilters=[],void 0!==e.pagingInfo&&(n.pagingInfo=e.pagingInfo?t.PagingInfo.toJSON(e.pagingInfo):void 0),void 0!==e.startTime&&(n.startTime=e.startTime),void 0!==e.endTime&&(n.endTime=e.endTime),n},fromPartial:function(e){var n=Object.assign({},v);if(n.contentFilters=[],void 0!==e.pubsubTopic&&null!==e.pubsubTopic?n.pubsubTopic=e.pubsubTopic:n.pubsubTopic=void 0,void 0!==e.contentFilters&&null!==e.contentFilters){var o,i=r(e.contentFilters);try{for(i.s();!(o=i.n()).done;){var a=o.value;n.contentFilters.push(t.ContentFilter.fromPartial(a))}}catch(s){i.e(s)}finally{i.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromPartial(e.pagingInfo):n.pagingInfo=void 0,void 0!==e.startTime&&null!==e.startTime?n.startTime=e.startTime:n.startTime=void 0,void 0!==e.endTime&&null!==e.endTime?n.endTime=e.endTime:n.endTime=void 0,n}};var g={};t.HistoryResponse={encode:function(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create(),i=r(e.messages);try{for(i.s();!(n=i.n()).done;){var a=n.value;u.WakuMessage.encode(a,o.uint32(10).fork()).ldelim()}}catch(c){i.e(c)}finally{i.f()}return void 0!==e.pagingInfo&&t.PagingInfo.encode(e.pagingInfo,o.uint32(18).fork()).ldelim(),o},decode:function(e,n){var r=e instanceof s.default.Reader?e:new s.default.Reader(e),o=void 0===n?r.len:r.pos+n,i=Object.assign({},g);for(i.messages=[];r.pos<o;){var a=r.uint32();switch(a>>>3){case 1:i.messages.push(u.WakuMessage.decode(r,r.uint32()));break;case 2:i.pagingInfo=t.PagingInfo.decode(r,r.uint32());break;default:r.skipType(7&a)}}return i},fromJSON:function(e){var n=Object.assign({},g);if(n.messages=[],void 0!==e.messages&&null!==e.messages){var o,i=r(e.messages);try{for(i.s();!(o=i.n()).done;){var a=o.value;n.messages.push(u.WakuMessage.fromJSON(a))}}catch(s){i.e(s)}finally{i.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromJSON(e.pagingInfo):n.pagingInfo=void 0,n},toJSON:function(e){var n={};return e.messages?n.messages=e.messages.map((function(e){return e?u.WakuMessage.toJSON(e):void 0})):n.messages=[],void 0!==e.pagingInfo&&(n.pagingInfo=e.pagingInfo?t.PagingInfo.toJSON(e.pagingInfo):void 0),n},fromPartial:function(e){var n=Object.assign({},g);if(n.messages=[],void 0!==e.messages&&null!==e.messages){var o,i=r(e.messages);try{for(i.s();!(o=i.n()).done;){var a=o.value;n.messages.push(u.WakuMessage.fromPartial(a))}}catch(s){i.e(s)}finally{i.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromPartial(e.pagingInfo):n.pagingInfo=void 0,n}};var h={requestId:""};t.HistoryRPC={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return""!==e.requestId&&n.uint32(10).string(e.requestId),void 0!==e.query&&t.HistoryQuery.encode(e.query,n.uint32(18).fork()).ldelim(),void 0!==e.response&&t.HistoryResponse.encode(e.response,n.uint32(26).fork()).ldelim(),n},decode:function(e,n){for(var r=e instanceof s.default.Reader?e:new s.default.Reader(e),o=void 0===n?r.len:r.pos+n,i=Object.assign({},h);r.pos<o;){var a=r.uint32();switch(a>>>3){case 1:i.requestId=r.string();break;case 2:i.query=t.HistoryQuery.decode(r,r.uint32());break;case 3:i.response=t.HistoryResponse.decode(r,r.uint32());break;default:r.skipType(7&a)}}return i},fromJSON:function(e){var n=Object.assign({},h);return void 0!==e.requestId&&null!==e.requestId?n.requestId=String(e.requestId):n.requestId="",void 0!==e.query&&null!==e.query?n.query=t.HistoryQuery.fromJSON(e.query):n.query=void 0,void 0!==e.response&&null!==e.response?n.response=t.HistoryResponse.fromJSON(e.response):n.response=void 0,n},toJSON:function(e){var n={};return void 0!==e.requestId&&(n.requestId=e.requestId),void 0!==e.query&&(n.query=e.query?t.HistoryQuery.toJSON(e.query):void 0),void 0!==e.response&&(n.response=e.response?t.HistoryResponse.toJSON(e.response):void 0),n},fromPartial:function(e){var n=Object.assign({},h);return void 0!==e.requestId&&null!==e.requestId?n.requestId=e.requestId:n.requestId="",void 0!==e.query&&null!==e.query?n.query=t.HistoryQuery.fromPartial(e.query):n.query=void 0,void 0!==e.response&&null!==e.response?n.response=t.HistoryResponse.fromPartial(e.response):n.response=void 0,n}};var b=function(){if("undefined"!==typeof b)return b;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),m=b.atob||function(e){return b.Buffer.from(e,"base64").toString("binary")};var y=b.btoa||function(e){return b.Buffer.from(e,"binary").toString("base64")};function k(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new b.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}s.default.util.Long!==a.default&&(s.default.util.Long=a.default,s.default.configure())}).call(this,n(34))},261:function(e,t,n){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessage=t.protobufPackage=void 0;var o=r(n(146)),i=r(n(29));t.protobufPackage="chat.v2";var a={timestamp:0,nick:""};t.ChatMessage={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.Writer.create();return 0!==e.timestamp&&t.uint32(8).uint64(e.timestamp),""!==e.nick&&t.uint32(18).string(e.nick),0!==e.payload.length&&t.uint32(26).bytes(e.payload),t},decode:function(e,t){var n=e instanceof i.default.Reader?e:new i.default.Reader(e),r=void 0===t?n.len:n.pos+t,o=Object.assign({},a);for(o.payload=new Uint8Array;n.pos<r;){var s=n.uint32();switch(s>>>3){case 1:o.timestamp=f(n.uint64());break;case 2:o.nick=n.string();break;case 3:o.payload=n.bytes();break;default:n.skipType(7&s)}}return o},fromJSON:function(e){var t=Object.assign({},a);return t.payload=new Uint8Array,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=Number(e.timestamp):t.timestamp=0,void 0!==e.nick&&null!==e.nick?t.nick=String(e.nick):t.nick="",void 0!==e.payload&&null!==e.payload&&(t.payload=function(e){for(var t=u(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}(e.payload)),t},toJSON:function(e){var t={};return void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.nick&&(t.nick=e.nick),void 0!==e.payload&&(t.payload=function(e){for(var t=[],n=0;n<e.byteLength;++n)t.push(String.fromCharCode(e[n]));return c(t.join(""))}(void 0!==e.payload?e.payload:new Uint8Array)),t},fromPartial:function(e){var t=Object.assign({},a);return void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=e.timestamp:t.timestamp=0,void 0!==e.nick&&null!==e.nick?t.nick=e.nick:t.nick="",void 0!==e.payload&&null!==e.payload?t.payload=e.payload:t.payload=new Uint8Array,t}};var s=function(){if("undefined"!==typeof s)return s;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),u=s.atob||function(e){return s.Buffer.from(e,"base64").toString("binary")};var c=s.btoa||function(e){return s.Buffer.from(e,"binary").toString("base64")};function f(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new s.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}i.default.util.Long!==o.default&&(i.default.util.Long=o.default,i.default.configure())}).call(this,n(34))},263:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(20),o=n(16),i=n.n(o);function a(e,t,n){var o=[],a=function(e){return e.trim().replaceAll(/\s\s+/g," ").split(" ")}(e),s=a.shift();switch(s){case"/help":["/nick <nickname>: set a new nickname","/info: some information about the node","/connect <Multiaddr>: connect to the given peer","/help: Display this help"].map((function(e){return o.push(e)}));break;case"/nick":(function(e,t){return e?(t(e),["New nick: ".concat(e)]):["No nick provided"]})(a.shift(),n).map((function(e){return o.push(e)}));break;case"/info":(function(e){return e?["PeerId: ".concat(e.libp2p.peerId.toB58String())]:["Waku node is starting"]})(t).map((function(e){return o.push(e)}));break;case"/connect":(function(e,t){if(!t)return["Waku node is starting"];if(!e)return["No peer provided"];try{var n=Object(r.multiaddr)(e),o=n.getPeerId();return o?(t.addPeerToAddressBook(i.a.createFromB58String(o),[n]),["".concat(o,": ").concat(n.toString()," added to address book, autodial in progress")]):["Peer Id needed to dial"]}catch(a){return["Invalid multiaddr: "+a]}})(a.shift(),t).map((function(e){return o.push(e)}));break;case"/peers":(function(e){if(!e)return["Waku node is starting"];var t=[];return e.libp2p.peerStore.peers.forEach((function(e,n){t.push(n+":");var r="  addresses: [";e.addresses.forEach((function(e){var t=e.multiaddr;r+=" "+t.toString()+","})),r=r.replace(/,$/,""),r+="]",t.push(r);var o="  protocols: [";o+=e.protocols,o+="]",t.push(o)})),0===t.length&&t.push("Not connected to any peer."),t})(t).map((function(e){return o.push(e)}));break;case"/connections":(function(e){if(!e)return["Waku node is starting"];var t=[];return e.libp2p.connections.forEach((function(e,n){t.push(n+":");var r="  connections: [";e.forEach((function(e){r+=JSON.stringify(e.stat),r+="; "+JSON.stringify(e.streams)})),r+="]",t.push(r)})),0===t.length&&t.push("Not connected to any peer."),t})(t).map((function(e){return o.push(e)}));break;default:o.push("Unknown Command '".concat(s,"'"))}return{command:s,response:o}}},272:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n(1),o=n.n(r),i=n(19),a=n(36),s=n(98),u=n(35),c=n(39),f=n(0),d=n(26),l=n(13);function p(e){var t,n=Object(f.useState)([]),r=Object(c.a)(n,2),o=r[0],i=r[1],a=Object(f.useState)([]),s=Object(c.a)(a,2),p=s[0],b=s[1];g(e.newMessages,o)?(t=o.concat(e.newMessages),g(e.archivedMessages,t)&&(t=h(e.archivedMessages,t))):g(e.archivedMessages,o)&&(t=h(e.archivedMessages,o)),t&&(b(function(e){var t,n=-1,r="",o=[],i=0,a=Object(u.a)(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;r!==s.nick&&(o[++n]=[],i=0,r=s.nick),o[n][i++]=s}}catch(c){a.e(c)}finally{a.f()}return o}(t)),i(t));var m=p.map((function(e){return Object(l.jsx)(d.d,{onlyFirstWithMeta:!0,children:e.map((function(e){return Object(l.jsx)(d.c,{authorName:e.nick,date:(t=e,t.timestamp.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!1})),children:Object(l.jsx)(d.f,{children:e.payloadAsUtf8})},e.timestamp.valueOf()+e.nick+e.payloadAsUtf8);var t}))})}));return Object(l.jsxs)(d.e,{active:!0,containScrollInSubtree:!0,children:[m,Object(l.jsx)(v,{newMessages:e.newMessages})]})}var v=function(e){var t=Object(f.useRef)();return Object(f.useEffect)((function(){t.current.scrollIntoView()}),[e.newMessages]),Object(l.jsx)("div",{ref:t})};function g(e,t){return 0!==e.length&&(0===t.length||!e.find((function(e){return t.find(b.bind({},e))})))}function h(e,t){var n=t.slice();return e.forEach((function(e){n.find(b.bind({},e))||n.push(e)})),n.sort((function(e,t){return e.timestamp.valueOf()-t.timestamp.valueOf()})),n}function b(e,t){return e.nick===t.nick&&e.payloadAsUtf8===t.payloadAsUtf8&&e.timestamp.toString()===t.timestamp.toString()}var m=n(65);function y(e){var t=Object(f.useState)(""),n=Object(c.a)(t,2),r=n[0],a=n[1],s=Object(m.b)().waku,u=function(){var t=Object(i.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.sendMessage){t.next=4;break}return t.next=3,e.sendMessage(r);case 3:a("");case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),p=function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=3;break}return e.next=3,u();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=s&&0!==s.relay.getPeers().size||r.startsWith("/");return Object(l.jsx)(d.i,{onKeyDown:p,onChange:function(e){a(e.target.value)},active:v,onButtonClick:u,children:Object(l.jsxs)(d.g,{align:"center",children:[Object(l.jsx)(d.a,{children:Object(l.jsx)(d.j,{value:r})}),Object(l.jsx)(d.b,{children:Object(l.jsx)(d.h,{})})]})})}function k(e){var t=Object(m.b)().waku;return Object(l.jsxs)("div",{className:"chat-container",style:{height:"98vh",display:"flex",flexDirection:"column"},children:[Object(l.jsx)(d.l,{title:"Waku v2 chat app"}),Object(l.jsx)(p,{newMessages:e.newMessages,archivedMessages:e.archivedMessages}),Object(l.jsx)(y,{sendMessage:t?function(){var n=Object(i.a)(o.a.mark((function n(r){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",O(r,e.nick,e.commandHandler,t.relay.send.bind(t.relay)));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}():void 0})]})}function O(e,t,n,r){return T.apply(this,arguments)}function T(){return(T=Object(i.a)(o.a.mark((function e(t,n,r,i){var u,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.startsWith("/")){e.next=4;break}r(t),e.next=7;break;case 4:return u=a.ChatMessage.fromUtf8String(new Date,n,t),c=a.WakuMessage.fromBytes(u.encode(),s.a),e.abrupt("return",i(c));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},273:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(66),a=n.n(i),s=(n(279),n(98)),u=n(13);a.a.render(Object(u.jsx)(o.a.StrictMode,{children:Object(u.jsx)(s.b,{})}),document.getElementById("root"))},279:function(e,t,n){},281:function(e,t,n){},282:function(e,t,n){"use strict";var r=n(1),o=n(5),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getStatusFleetNodes=t.Environment=t.Protocol=void 0;var a,s,u=i(n(283));function c(){return(c=o(r.mark((function e(){var t,n,o,i,c=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:s.Prod,n=c.length>1&&void 0!==c[1]?c[1]:a.websocket,e.next=4,u.default.get("https://fleets.status.im/",{headers:{"Content-Type":"application/json"}});case 4:o=e.sent,i=o.data.fleets["wakuv2.".concat(t)],e.t0=n,e.next=e.t0===a.tcp?9:10;break;case 9:return e.abrupt("return",Object.values(i.waku));case 10:return e.abrupt("return",Object.values(i["waku-websocket"]));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e.websocket="websocket",e.tcp="tcp"}(a=t.Protocol||(t.Protocol={})),function(e){e.Test="test",e.Prod="prod"}(s=t.Environment||(t.Environment={})),t.getStatusFleetNodes=function(){return c.apply(this,arguments)}},301:function(e,t,n){"use strict";var r=n(42),o=n(1),i=n(5),a=n(3),s=n(4),u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Waku=void 0;var c=u(n(302)),f=u(n(611)),d=n(621),l=u(n(654)),p=u(n(249)),v=n(20),g=u(n(16)),h=n(97),b=n(259),m=l.default.prototype[Symbol.toStringTag],y=function(){function e(t,n){a(this,e),this.libp2p=t,this.relay=t.pubsub,this.store=n}return s(e,[{key:"dial",value:function(){var e=i(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.libp2p.dialProtocol(t,[h.RelayCodec,b.StoreCodec]));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addPeerToAddressBook",value:function(e,t){var n;n="string"===typeof e?g.default.createFromB58String(e):e;var r=t.map((function(e){return"string"===typeof e?v.multiaddr(e):e}));this.libp2p.peerStore.addressBook.set(n,r)}},{key:"stop",value:function(){var e=i(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.libp2p.stop());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLocalMultiaddrWithID",value:function(){var e=this.libp2p.multiaddrs.find((function(e){return e.toString().match(/127\.0\.0\.1/)}));if(!e||""===e.toString())throw"Not listening on localhost";return e+"/p2p/"+this.libp2p.peerId.toB58String()}}],[{key:"create",value:function(){var t=i(o.mark((function t(n){var i,a,s,u,v,g;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(s=Object.assign({listenAddresses:[],staticNoiseKey:void 0},n)).config=Object.assign({transport:r({},m,{filter:p.default.all})},n.config),s.modules=Object.assign({},n.modules),u=[l.default],(null===(i=s.modules)||void 0===i?void 0:i.transport)&&(u=u.concat(null===(a=s.modules)||void 0===a?void 0:a.transport)),t.next=7,c.default.create({addresses:{listen:s.listenAddresses},modules:{transport:u,streamMuxer:[f.default],connEncryption:[new d.Noise(s.staticNoiseKey)],pubsub:h.WakuRelay},config:s.config});case 7:return v=t.sent,g=new b.WakuStore(v),t.next=11,v.start();case 11:return t.abrupt("return",new e(v,g));case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}();t.Waku=y},36:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.proto=t.StoreCodec=t.WakuStore=t.RelayCodec=t.WakuRelay=t.ChatMessage=t.WakuMessage=t.Waku=t.Protocol=t.Environment=t.getStatusFleetNodes=void 0;var a=n(282);Object.defineProperty(t,"getStatusFleetNodes",{enumerable:!0,get:function(){return a.getStatusFleetNodes}}),Object.defineProperty(t,"Environment",{enumerable:!0,get:function(){return a.Environment}}),Object.defineProperty(t,"Protocol",{enumerable:!0,get:function(){return a.Protocol}});var s=n(301);Object.defineProperty(t,"Waku",{enumerable:!0,get:function(){return s.Waku}});var u=n(144);Object.defineProperty(t,"WakuMessage",{enumerable:!0,get:function(){return u.WakuMessage}});var c=n(712);Object.defineProperty(t,"ChatMessage",{enumerable:!0,get:function(){return c.ChatMessage}});var f=n(97);Object.defineProperty(t,"WakuRelay",{enumerable:!0,get:function(){return f.WakuRelay}}),Object.defineProperty(t,"RelayCodec",{enumerable:!0,get:function(){return f.RelayCodec}});var d=n(259);Object.defineProperty(t,"WakuStore",{enumerable:!0,get:function(){return d.WakuStore}}),Object.defineProperty(t,"StoreCodec",{enumerable:!0,get:function(){return d.StoreCodec}}),t.proto=i(n(713))},398:function(e,t){},399:function(e,t){},536:function(e,t){},602:function(e,t){},65:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var r=n(0),o=Object(r.createContext)({waku:void 0}),i=function(){return Object(r.useContext)(o)}},657:function(e,t){},708:function(e,t,n){"use strict";var r=n(3),o=n(4),i=n(11),a=n(12),s=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),u=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return u(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RelayHeartbeat=void 0;var f=n(254),d=n(49),l=c(n(147)),p=n(258),v=function(e){i(n,e);var t=a(n);function n(e){return r(this,n),t.call(this,e)}return o(n,[{key:"start",value:function(){var e=this;if(!this._heartbeatTimer){var t=this._heartbeat.bind(this),n=setTimeout((function(){var n;t(),null===(n=e._heartbeatTimer)||void 0===n||n.runPeriodically(t,l.RelayHeartbeatInterval)}),l.RelayHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:function(t,n){e._heartbeatTimer._intervalId=setInterval(t,n)},cancel:function(){var t;clearTimeout(n),clearInterval(null===(t=e._heartbeatTimer)||void 0===t?void 0:t._intervalId)}}}}},{key:"stop",value:function(){this._heartbeatTimer&&(this._heartbeatTimer.cancel(),this._heartbeatTimer=null)}},{key:"_heartbeat",value:function(){var e=this,t=this.gossipsub._options,n=t.D,r=t.Dlo,o=t.Dhi,i=t.Dscore,a=t.Dout;this.gossipsub.heartbeatTicks++;var s=new Map,u=function(t){var n=s.get(t);return void 0===n&&(n=e.gossipsub.score.score(t),s.set(t,n)),n},c=new Map,f=new Map,v=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((function(t,s){var g=function(n){e.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",n,s),e.gossipsub.score.prune(n,s),e.gossipsub._addBackoff(n,s),t.delete(n);var r=f.get(n);r?r.push(s):f.set(n,[s])},h=function(n){e.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",n,s),e.gossipsub.score.graft(n,s),t.add(n);var r=c.get(n);r?r.push(s):c.set(n,[s])};if(t.forEach((function(t){var n=u(t);n<0&&(e.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",t,n,s),g(t),v.set(t,!0))})),t.size<r){var b=e.gossipsub.backoff.get(s),m=n-t.size;p.getRelayPeers(e.gossipsub,s,m,(function(n){return!t.has(n)&&!e.gossipsub.direct.has(n)&&(!b||!b.has(n))&&u(n)>=0})).forEach(h)}if(t.size>o){var y=Array.from(t);y.sort((function(e,t){return u(t)-u(e)})),y=y.slice(0,i).concat(d.shuffle(y.slice(i)));var k=0;if(y.slice(0,n).forEach((function(t){e.gossipsub.outbound.get(t)&&k++})),k<a){var O=function(e){for(var t=y[e],n=e;n>0;n--)y[n]=y[n-1];y[0]=t};if(k>0)for(var T=k,_=1;_<n&&T>0;_++)e.gossipsub.outbound.get(y[_])&&(O(_),T--);for(var I=n-k,j=n;j<y.length&&I>0;j++)e.gossipsub.outbound.get(y[j])&&(O(j),I--)}y.slice(n).forEach(g)}if(t.size>=r){var P=0;if(t.forEach((function(t){e.gossipsub.outbound.get(t)&&P++})),P<a){var S=a-P,R=e.gossipsub.backoff.get(s);p.getRelayPeers(e.gossipsub,s,S,(function(n){return!t.has(n)&&!e.gossipsub.direct.has(n)&&(!R||!R.has(n))&&u(n)>=0})).forEach(h)}}if(e.gossipsub.heartbeatTicks%l.RelayOpportunisticGraftTicks===0&&t.size>1){var w=Array.from(t).sort((function(e,t){return u(e)-u(t)})),C=t.size/2,D=u(w[C]);if(D<e.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){var E=e.gossipsub.backoff.get(s);p.getRelayPeers(e.gossipsub,s,l.RelayOpportunisticGraftPeers,(function(n){return t.has(n)&&!e.gossipsub.direct.has(n)&&(!E||!E.has(n))&&u(n)>D})).forEach((function(t){e.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,s),h(t)}))}}e.gossipsub._emitGossip(s,t)}));var g=this.gossipsub._now();this.gossipsub.lastpub.forEach((function(t,n){t+l.RelayFanoutTTL<g&&(e.gossipsub.fanout.delete(n),e.gossipsub.lastpub.delete(n))})),this.gossipsub.fanout.forEach((function(t,r){var o=e.gossipsub.topics.get(r);if(t.forEach((function(n){(!(null===o||void 0===o?void 0:o.has(n))||u(n)<e.gossipsub._options.scoreThresholds.publishThreshold)&&t.delete(n)})),t.size<n){var i=n-t.size;p.getRelayPeers(e.gossipsub,r,i,(function(n){return!t.has(n)&&!e.gossipsub.direct.has(n)&&u(n)>=e.gossipsub._options.scoreThresholds.publishThreshold})).forEach((function(e){t.add(e)}))}e.gossipsub._emitGossip(r,t)})),this.gossipsub._sendGraftPrune(c,f,v),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}]),n}(f.Heartbeat);t.RelayHeartbeat=v},711:function(e,t,n){"use strict";var r=n(3),o=n(4),i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.Direction=void 0;var u,c=n(29),f=n(720),d=s(n(260));!function(e){e.BACKWARD="backward",e.FORWARD="forward"}(u=t.Direction||(t.Direction={}));var l=function(){function e(t){r(this,e),this.proto=t}return o(e,[{key:"encode",value:function(){return d.HistoryRPC.encode(this.proto).finish()}},{key:"query",get:function(){return this.proto.query}},{key:"response",get:function(){return this.proto.response}}],[{key:"createQuery",value:function(t){var n=function(e){switch(e){case u.BACKWARD:return d.PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED;case u.FORWARD:return d.PagingInfo_Direction.DIRECTION_FORWARD;default:return d.PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED}}(t.direction),r={pageSize:t.pageSize,cursor:t.cursor,direction:n},o=t.contentTopics.map((function(e){return{contentTopic:e}}));return new e({requestId:f.v4(),query:{pubsubTopic:t.pubsubTopic,contentFilters:o,pagingInfo:r,startTime:void 0,endTime:void 0},response:void 0})}},{key:"decode",value:function(t){return new e(d.HistoryRPC.decode(c.Reader.create(t)))}}]),e}();t.HistoryRPC=l},712:function(e,t,n){"use strict";(function(e){var r=n(3),o=n(4),i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessage=void 0;var u=n(29),c=s(n(261)),f=function(){function t(e){r(this,t),this.proto=e}return o(t,[{key:"encode",value:function(){return c.ChatMessage.encode(this.proto).finish()}},{key:"timestamp",get:function(){return new Date(1e3*this.proto.timestamp)}},{key:"nick",get:function(){return this.proto.nick}},{key:"payloadAsUtf8",get:function(){return this.proto.payload?Array.from(this.proto.payload).map((function(e){return String.fromCharCode(e)})).join(""):""}}],[{key:"fromUtf8String",value:function(n,r,o){return new t({timestamp:Math.floor(n.valueOf()/1e3),nick:r,payload:e.from(o,"utf-8")})}},{key:"decode",value:function(e){return new t(c.ChatMessage.decode(u.Reader.create(e)))}}]),t}();t.ChatMessage=f}).call(this,n(7).Buffer)},713:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.HistoryResponse=t.HistoryQuery=t.ContentFilter=t.PagingInfo_Direction=t.PagingInfo=t.Index=t.WakuMessage=t.ChatMessage=void 0;var r=n(261);Object.defineProperty(t,"ChatMessage",{enumerable:!0,get:function(){return r.ChatMessage}});var o=n(145);Object.defineProperty(t,"WakuMessage",{enumerable:!0,get:function(){return o.WakuMessage}});var i=n(260);Object.defineProperty(t,"Index",{enumerable:!0,get:function(){return i.Index}}),Object.defineProperty(t,"PagingInfo",{enumerable:!0,get:function(){return i.PagingInfo}}),Object.defineProperty(t,"PagingInfo_Direction",{enumerable:!0,get:function(){return i.PagingInfo_Direction}}),Object.defineProperty(t,"ContentFilter",{enumerable:!0,get:function(){return i.ContentFilter}}),Object.defineProperty(t,"HistoryQuery",{enumerable:!0,get:function(){return i.HistoryQuery}}),Object.defineProperty(t,"HistoryResponse",{enumerable:!0,get:function(){return i.HistoryResponse}}),Object.defineProperty(t,"HistoryRPC",{enumerable:!0,get:function(){return i.HistoryRPC}})},97:function(e,t,n){"use strict";(function(e){var r=n(1),o=n(5),i=n(3),a=n(4),s=n(27),u=n(53),c=n(43),f=n(11),d=n(12),l=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),p=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&l(t,e,n);return p(t,e),t},g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuRelay=t.DefaultPubsubTopic=t.RelayCodec=void 0;var h=g(n(676)),b=n(49),m=n(251),y=g(n(16)),k=n(144),O=v(n(147)),T=n(147);Object.defineProperty(t,"DefaultPubsubTopic",{enumerable:!0,get:function(){return T.DefaultPubsubTopic}}),Object.defineProperty(t,"RelayCodec",{enumerable:!0,get:function(){return T.RelayCodec}});var _=n(258),I=n(708),j=function(t){f(l,t);var n=d(l);function l(e,t){var r;i(this,l),(r=n.call(this,e,Object.assign(t,{globalSignaturePolicy:m.SignaturePolicy.StrictNoSign}))).heartbeat=new I.RelayHeartbeat(s(r)),r.observers={};var o=[O.RelayCodec];return Object.assign(s(r),{multicodecs:o}),r}return a(l,[{key:"start",value:function(){var e=this;this.on(O.DefaultPubsubTopic,(function(t){var n=k.WakuMessage.decode(t.data);e.observers[""]&&e.observers[""].forEach((function(e){e(n)})),n.contentTopic&&e.observers[n.contentTopic]&&e.observers[n.contentTopic].forEach((function(e){e(n)}))})),u(c(l.prototype),"start",this).call(this),u(c(l.prototype),"subscribe",this).call(this,O.DefaultPubsubTopic)}},{key:"send",value:function(){var t=o(r.mark((function t(n){var o;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.encode(),t.next=3,u(c(l.prototype),"publish",this).call(this,O.DefaultPubsubTopic,e.from(o));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addObserver",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===n.length?(this.observers[""]||(this.observers[""]=[]),this.observers[""].push(e)):n.forEach((function(n){t.observers[n]||(t.observers[n]=[]),t.observers[n].push(e)}))}},{key:"getPeers",value:function(){var e=this;return _.getRelayPeers(this,T.DefaultPubsubTopic,this._options.D,(function(t){return e.score.score(t)>=e._options.scoreThresholds.publishThreshold}))}},{key:"join",value:function(e){var t,n=this;if(!this.started)throw new Error("WakuRelayPubsub has not started");var r=this.fanout.get(e);if(r)r.forEach((function(e){n.score.score(e)<0&&r.delete(e)})),r.size<this._options.D&&_.getRelayPeers(this,e,this._options.D-r.size,(function(e){return!r.has(e)&&!n.direct.has(e)&&n.score.score(e)>=0})).forEach((function(e){return r.add(e)})),this.mesh.set(e,r),this.fanout.delete(e),this.lastpub.delete(e);else{var o=_.getRelayPeers(this,e,this._options.D,(function(e){return!n.direct.has(e)&&n.score.score(e)>=0}));this.mesh.set(e,o)}null===(t=this.mesh.get(e))||void 0===t||t.forEach((function(t){n.log("JOIN: Add mesh link to %s in %s",t,e),n._sendGraft(t,e)}))}},{key:"_publish",value:function(){var e=o(r.mark((function e(t){var n,o,i,a,s=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(t),this.gossipTracer.deliverMessage(t)),n=this.getMsgId(t),o=b.messageIdToString(n),this.seenCache.put(o),this.messageCache.put(t),i=new Set,t.topicIDs.forEach((function(e){if(s.topics.get(e)){s.direct.forEach((function(e){i.add(e)}));var t=s.mesh.get(e);if(!t||!t.size){if(!(t=s.fanout.get(e))){var n=_.getRelayPeers(s,e,s._options.D,(function(e){return s.score.score(e)>=s._options.scoreThresholds.publishThreshold}));n.size>0?(t=n,s.fanout.set(e,n)):t=new Set}s.lastpub.set(e,s._now())}null===t||void 0===t||t.forEach((function(e){i.add(e)}))}})),a=b.createGossipRpc([h.default.utils.normalizeOutRpcMessage(t)]),i.forEach((function(e){e!==t.from&&s._sendRpc(e,a)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_emitGossip",value:function(e,t){var n=this,r=this.messageCache.getGossipIDs(e);if(r.length){b.shuffle(r),r.length>O.RelayMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length);var o=[],i=this.topics.get(e);if(i){i.forEach((function(e){var r=n.peers.get(e);r&&!t.has(e)&&!n.direct.has(e)&&r.protocol==O.RelayCodec&&n.score.score(e)>=n._options.scoreThresholds.gossipThreshold&&o.push(e)}));var a=this._options.Dlazy,s=O.RelayGossipFactor*o.length;s>a&&(a=s),a>o.length?a=o.length:b.shuffle(o),o.slice(0,a).forEach((function(t){var o=r;r.length>O.RelayMaxIHaveLength&&(o=b.shuffle(o.slice()).slice(0,O.RelayMaxIHaveLength)),n._pushGossip(t,{topicID:e,messageIDs:o})}))}}}},{key:"_makePrune",value:function(e,t,n){var r=this,o=O.RelayPruneBackoff/1e3,i=[];n&&_.getRelayPeers(this,t,O.RelayPrunePeers,(function(t){return t!==e&&r.score.score(t)>=0})).forEach((function(e){var t=y.default.createFromB58String(e);i.push({peerID:t.toBytes(),signedPeerRecord:r._libp2p.peerStore.addressBook.getRawEnvelope(t)})}));return{topicID:t,peers:i,backoff:o}}}]),l}(h.default);t.WakuRelay=j}).call(this,n(7).Buffer)},98:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return y}));var r=n(1),o=n.n(r),i=n(39),a=n(19),s=n(0),u=(n(281),n(36)),c=n(263),f=n(272),d=n(65),l=n(26),p=n(271),v=n(13),g={AuthorName:{css:{fontSize:"1.1em"}},Message:{css:{margin:"0em",padding:"0em",fontSize:"0.83em"}},MessageText:{css:{margin:"0em",padding:"0.1em",paddingLeft:"1em",fontSize:"1.1em"}},MessageGroup:{css:{margin:"0em",padding:"0.2em"}}},h="dingpu";function b(e,t,n){return m.apply(this,arguments)}function m(){return(m=Object(a.a)(o.a.mark((function e(t,n,r){var i,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e){var t=e.map((function(e){return e.payload})).filter((function(e){return!!e})).map((function(e){return u.ChatMessage.decode(e)}));r(t)},e.next=3,t.store.queryHistory({peerId:n,contentTopics:[h],pageSize:5,callback:i});case 3:return a=e.sent,e.abrupt("return",a?a.length:0);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){var e=Object(s.useState)([]),t=Object(i.a)(e,2),n=t[0],r=t[1],m=Object(s.useState)([]),y=Object(i.a)(m,2),O=y[0],T=y[1],_=Object(s.useState)(void 0),I=Object(i.a)(_,2),j=I[0],P=I[1],S=Object(s.useState)(Object(p.generate)()),R=Object(i.a)(S,2),w=R[0],C=R[1];return Object(s.useEffect)((function(){var e=function(){var e=Object(a.a)(o.a.mark((function e(t,n){var r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.peerId,!n.protocols.includes(u.StoreCodec)){e.next=13;break}return console.log("".concat(r.toB58String(),": retrieving archived messages}")),e.prev=3,e.next=6,b(t,r,T);case 6:i=e.sent,console.log("".concat(r.toB58String(),": messages retrieved:"),i),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log("".concat(r.toB58String(),": error encountered when retrieving archived messages"),e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}();if(j)return j.relay.addObserver((function(e){if(e.payload){var t=u.ChatMessage.decode(e.payload);t&&r([t])}}),[h]),j.libp2p.peerStore.on("change:protocols",e.bind({},j)),function(){null===j||void 0===j||j.libp2p.peerStore.removeListener("change:protocols",e.bind({},j))};(function(e){return k.apply(this,arguments)})(P).then((function(){return console.log("Waku init done")})).catch((function(e){return console.log("Waku init failed ",e)}))}),[j]),Object(v.jsx)("div",{className:"chat-app",style:{height:"100vh",width:"100vw",overflow:"hidden"},children:Object(v.jsx)(d.a.Provider,{value:{waku:j},children:Object(v.jsx)(l.k,{theme:g,children:Object(v.jsx)(f.a,{nick:w,newMessages:n,archivedMessages:O,commandHandler:function(e){var t=Object(c.a)(e,j,C),n=t.command,o=t.response.map((function(e){return u.ChatMessage.fromUtf8String(new Date,n,e)}));r(o)}})})})})}function k(){return(k=Object(a.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.Waku.create({config:{pubsub:{enabled:!0,emitSelf:!0}}});case 3:return n=e.sent,t(n),e.next=7,O();case 7:return r=e.sent,e.next=10,Promise.all(r.map((function(e){return n.dial(e)})));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("Issue starting waku ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function O(){var t,n;return"development"===(null===(t=e)||void 0===t||null===(n=Object({NODE_ENV:"production",PUBLIC_URL:"/js-waku",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}))||void 0===n?void 0:n.NODE_ENV)?Object(u.getStatusFleetNodes)(u.Environment.Test):Object(u.getStatusFleetNodes)(u.Environment.Prod)}}).call(this,n(46))}},[[273,1,2]]]);
//# sourceMappingURL=main.8709c2c2.chunk.js.map