(this["webpackJsonpweb-chat"]=this["webpackJsonpweb-chat"]||[]).push([[0],{129:function(e,t,n){"use strict";(function(e){var r=n(12),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuMessage=t.protobufPackage=void 0;var o=i(n(128)),s=i(n(23));t.protobufPackage="waku.v2";var a={};t.WakuMessage={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return void 0!==e.payload&&t.uint32(10).bytes(e.payload),void 0!==e.contentTopic&&t.uint32(18).string(e.contentTopic),void 0!==e.version&&t.uint32(24).uint32(e.version),void 0!==e.timestamp&&t.uint32(33).double(e.timestamp),t},decode:function(e,t){for(var n=e instanceof s.default.Reader?e:new s.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},a);n.pos<r;){var o=n.uint32();switch(o>>>3){case 1:i.payload=n.bytes();break;case 2:i.contentTopic=n.string();break;case 3:i.version=n.uint32();break;case 4:i.timestamp=n.double();break;default:n.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},a);return void 0!==e.payload&&null!==e.payload&&(t.payload=function(e){for(var t=c(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}(e.payload)),void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=String(e.contentTopic):t.contentTopic=void 0,void 0!==e.version&&null!==e.version?t.version=Number(e.version):t.version=void 0,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=Number(e.timestamp):t.timestamp=void 0,t},toJSON:function(e){var t={};return void 0!==e.payload&&(t.payload=void 0!==e.payload?function(e){var t,n=[],i=r(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n.push(String.fromCharCode(o))}}catch(s){i.e(s)}finally{i.f()}return f(n.join(""))}(e.payload):void 0),void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),void 0!==e.version&&(t.version=e.version),void 0!==e.timestamp&&(t.timestamp=e.timestamp),t},fromPartial:function(e){var t=Object.assign({},a);return void 0!==e.payload&&null!==e.payload?t.payload=e.payload:t.payload=void 0,void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=e.contentTopic:t.contentTopic=void 0,void 0!==e.version&&null!==e.version?t.version=e.version:t.version=void 0,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=e.timestamp:t.timestamp=void 0,t}};var u=function(){if("undefined"!==typeof u)return u;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),c=u.atob||function(e){return u.Buffer.from(e,"base64").toString("binary")};var f=u.btoa||function(e){return u.Buffer.from(e,"binary").toString("base64")};s.default.util.Long!==o.default&&(s.default.util.Long=o.default,s.default.configure())}).call(this,n(27))},130:function(e,t,n){"use strict";var r=n(1),i=n(4),o=n(3),s=n(5),a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),u=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return u(t,e),t},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuMessage=t.DefaultContentTopic=void 0;var l=n(6),d=f(n(9)),p=n(23),v=c(n(129)),g=c(n(286));t.DefaultContentTopic="/waku/2/default-content/proto";var h=d.default("waku:message"),b=function(){function e(t,n,r){o(this,e),this.proto=t,this._signaturePublicKey=n,this._signature=r}return s(e,[{key:"encode",value:function(){return v.WakuMessage.encode(this.proto).finish()}},{key:"payloadAsUtf8",get:function(){return this.proto.payload?Array.from(this.proto.payload).map((function(e){return String.fromCharCode(e)})).join(""):""}},{key:"payload",get:function(){return this.proto.payload}},{key:"contentTopic",get:function(){return this.proto.contentTopic}},{key:"version",get:function(){return this.proto.version}},{key:"timestamp",get:function(){if(this.proto.timestamp)return new Date(1e3*this.proto.timestamp)}},{key:"signaturePublicKey",get:function(){return this._signaturePublicKey}},{key:"signature",get:function(){return this._signature}}],[{key:"fromUtf8String",value:function(){var t=i(r.mark((function t(n,i){var o;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=l.Buffer.from(n,"utf-8"),t.abrupt("return",e.fromBytes(o,i));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"fromBytes",value:function(){var n=i(r.mark((function n(i,o){var s,a,u,c,f,l,d,p,v,h,b;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=Object.assign({timestamp:new Date,contentTopic:t.DefaultContentTopic},o||{}),a=s.timestamp,u=s.contentTopic,c=s.encPublicKey,f=s.symKey,l=s.sigPrivKey,d=i,p=0,!c||!f){n.next=5;break}throw"Pass either `encPublicKey` or `symKey`, not both.";case 5:if(!c){n.next=14;break}return h=g.clearEncode(d,l),n.next=9,g.encryptAsymmetric(h.payload,c);case 9:d=n.sent,v=h.sig,p=1,n.next=21;break;case 14:if(!f){n.next=21;break}return b=g.clearEncode(d,l),n.next=18,g.encryptSymmetric(b.payload,f);case 18:d=n.sent,v=b.sig,p=1;case 21:return n.abrupt("return",new e({payload:d,timestamp:a.valueOf()/1e3,version:p,contentTopic:u},null===v||void 0===v?void 0:v.publicKey,null===v||void 0===v?void 0:v.signature));case 22:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},{key:"decode",value:function(){var t=i(r.mark((function t(n,i){var o;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=v.WakuMessage.decode(p.Reader.create(n)),t.abrupt("return",e.decodeProto(o,i));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"decodeProto",value:function(){var t=i(r.mark((function t(n,o){var s,a,u,c,f,l,d,p,v,b;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==n.payload){t.next=3;break}return h("Payload is undefined"),t.abrupt("return");case 3:if(u=n.payload,1!==n.version||!n.payload){t.next=26;break}if(void 0!==o){t.next=8;break}return h("Payload is encrypted but no private keys have been provided."),t.abrupt("return");case 8:return t.next=10,Promise.all(o.map(function(){var e=i(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.decryptSymmetric(u,t);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),h("Failed to decrypt message using symmetric encryption",e.t0),e.prev=9,e.next=12,g.decryptAsymmetric(u,t);case 12:return e.abrupt("return",e.sent);case 15:return e.prev=15,e.t1=e.catch(9),h("Failed to decrypt message using asymmetric encryption",e.t1),e.abrupt("return");case 19:case"end":return e.stop()}}),e,null,[[0,6],[9,15]])})));return function(t){return e.apply(this,arguments)}}()));case 10:if(l=t.sent,d=function(e){return!!e},0!==(p=l.filter(d)).length){t.next=16;break}return h("Failed to decrypt payload."),t.abrupt("return");case 16:return v=p[0],t.next=19,g.clearDecode(v);case 19:if(b=t.sent){t.next=23;break}return h("Failed to decode payload."),t.abrupt("return");case 23:Object.assign(n,{payload:b.payload}),c=null===(s=b.sig)||void 0===s?void 0:s.publicKey,f=null===(a=b.sig)||void 0===a?void 0:a.signature;case 26:return t.abrupt("return",new e(n,c,f));case 27:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();t.WakuMessage=b},136:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RelayMaxIHaveLength=t.RelayOpportunisticGraftPeers=t.RelayOpportunisticGraftTicks=t.RelayFanoutTTL=t.RelayPruneBackoff=t.RelayPrunePeers=t.RelayHeartbeatInterval=t.RelayHeartbeatInitialDelay=t.RelayGossipFactor=t.RelayPingContentTopic=t.DefaultPubsubTopic=t.RelayCodecs=t.minute=t.second=void 0,t.second=1e3,t.minute=60*t.second,t.RelayCodecs=["/vac/waku/relay/2.0.0-beta2","/vac/waku/relay/2.0.0"],t.DefaultPubsubTopic="/waku/2/default-waku/proto",t.RelayPingContentTopic="/relay-ping/1/ping/null",t.RelayGossipFactor=.25,t.RelayHeartbeatInitialDelay=100,t.RelayHeartbeatInterval=t.second,t.RelayPrunePeers=16,t.RelayPruneBackoff=t.minute,t.RelayFanoutTTL=t.minute,t.RelayOpportunisticGraftTicks=60,t.RelayOpportunisticGraftPeers=2,t.RelayMaxIHaveLength=5e3},137:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return k}));var r=n(1),i=n.n(r),o=n(38),s=n(19),a=n(0),u=(n(359),n(34)),c=n(341),f=n(350),l=n(87),d=n(35),p=n(349),v=n(139),g=n(17),h={AuthorName:{css:{fontSize:"1.1em"}},Message:{css:{margin:"0em",padding:"0em",fontSize:"0.83em"}},MessageText:{css:{margin:"0em",padding:"0.1em",paddingLeft:"1em",fontSize:"1.1em"}},MessageGroup:{css:{margin:"0em",padding:"0.2em"}}},b="/toy-chat/2/huilong/proto";function m(e,t,n){return y.apply(this,arguments)}function y(){return(y=Object(s.a)(i.a.mark((function e(t,n,r){var o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(e){var t=[];e.map((function(e){return v.a.fromWakuMessage(e)})).forEach((function(e){e&&t.push(e)})),r(t)},e.next=3,t.store.queryHistory({peerId:n,contentTopics:[b],pageSize:5,callback:o});case 3:return s=e.sent,e.abrupt("return",s?s.length:0);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],r=t[1],y=Object(a.useState)([]),k=Object(o.a)(y,2),T=k[0],_=k[1],R=Object(a.useState)(void 0),S=Object(o.a)(R,2),I=S[0],w=S[1],j=Object(a.useState)((function(){var e=window.localStorage.getItem("nick");return null!==e?e:Object(p.generate)()})),E=Object(o.a)(j,2),C=E[0],N=E[1],D=Object(a.useState)(P),M=Object(o.a)(D,2),x=M[0],A=M[1];return Object(a.useEffect)((function(){localStorage.setItem("nick",C)}),[C]),Object(a.useEffect)((function(){(function(e,t){return O.apply(this,arguments)})(x,w).then((function(){return console.log("Waku init done")})).catch((function(e){return console.log("Waku init failed ",e)}))}),[x]),Object(a.useEffect)((function(){if(I){var e=function(e){console.log("Message received: ",e);var t=v.a.fromWakuMessage(e);t&&r([t])};return I.relay.addObserver(e,[b]),function(){null===I||void 0===I||I.relay.deleteObserver(e,[b])}}}),[I]),Object(a.useEffect)((function(){if(I){var e=function(){var e=Object(s.a)(i.a.mark((function e(t,n){var r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.peerId,!n.protocols.includes(u.StoreCodec)){e.next=13;break}return console.log("".concat(r.toB58String(),": retrieving archived messages}")),e.prev=3,e.next=6,m(t,r,_);case 6:o=e.sent,console.log("".concat(r.toB58String(),": messages retrieved:"),o),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log("".concat(r.toB58String(),": error encountered when retrieving archived messages"),e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}();return I.libp2p.peerStore.on("change:protocols",e.bind({},I)),function(){null===I||void 0===I||I.libp2p.peerStore.removeListener("change:protocols",e.bind({},I))}}}),[I]),Object(g.jsx)("div",{className:"chat-app",style:{height:"100vh",width:"100vw",overflow:"hidden"},children:Object(g.jsx)(l.a.Provider,{value:{waku:I},children:Object(g.jsx)(d.k,{theme:h,children:Object(g.jsx)(f.a,{nick:C,newMessages:n,archivedMessages:T,fleetEnv:x,commandHandler:function(e){var t=Object(c.a)(e,I,N,x,A),n=t.command,i=t.response.map((function(e){return v.a.fromUtf8String(n,e)}));r(i)}})})})})}function O(){return(O=Object(s.a)(i.a.mark((function e(t,n){var r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.Waku.create({libp2p:{config:{pubsub:{enabled:!0,emitSelf:!0}}}});case 3:return r=e.sent,n(r),e.next=7,Object(u.getStatusFleetNodes)(t);case 7:return o=e.sent,e.next=10,Promise.all(o.map((function(e){return r.dial(e)})));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("Issue starting waku ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function P(){var t,n;return"development"===(null===(t=e)||void 0===t||null===(n=Object({NODE_ENV:"production",PUBLIC_URL:"/js-waku",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}))||void 0===n?void 0:n.NODE_ENV)?u.Environment.Test:u.Environment.Prod}}).call(this,n(22))},139:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(65),i=n(86),o=n(34),s=function(){function e(t,n){Object(r.a)(this,e),this.chatMessage=void 0,this.sentTimestamp=void 0,this.chatMessage=t,this.sentTimestamp=n}return Object(i.a)(e,[{key:"nick",get:function(){return this.chatMessage.nick}},{key:"timestamp",get:function(){return this.chatMessage.timestamp}},{key:"payloadAsUtf8",get:function(){return this.chatMessage.payloadAsUtf8}}],[{key:"fromWakuMessage",value:function(t){if(t.payload)try{var n=o.ChatMessage.decode(t.payload);if(n)return new e(n,t.timestamp)}catch(r){console.error("Failed to decode chat message",t.payloadAsUtf8,r)}}},{key:"fromUtf8String",value:function(t,n){var r=new Date;return new e(o.ChatMessage.fromUtf8String(r,t,n),r)}}]),e}()},146:function(e,t){},188:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.symmetric=t.TagSize=t.IvSize=t.SymmetricKeySize=void 0,t.SymmetricKeySize=32,t.IvSize=12,t.TagSize=16,t.symmetric={},Promise.resolve().then((function(){return o(n(764))})).then((function(e){t.symmetric=e})).catch((function(e){Promise.resolve().then((function(){return o(n(765))})).then((function(e){t.symmetric=e})).catch((function(t){throw"Could not load any symmetric crypto modules: ".concat(e,", ").concat(t)}))}))},189:function(e,t,n){"use strict";(function(e){var r=n(12),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.HistoryResponse=t.HistoryQuery=t.ContentFilter=t.PagingInfo=t.Index=t.historyResponse_ErrorToJSON=t.historyResponse_ErrorFromJSON=t.HistoryResponse_Error=t.pagingInfo_DirectionToJSON=t.pagingInfo_DirectionFromJSON=t.PagingInfo_Direction=t.protobufPackage=void 0;var o,s,a=i(n(128)),u=i(n(23)),c=n(129);function f(e){switch(e){case 0:case"DIRECTION_BACKWARD_UNSPECIFIED":return o.DIRECTION_BACKWARD_UNSPECIFIED;case 1:case"DIRECTION_FORWARD":return o.DIRECTION_FORWARD;case-1:case"UNRECOGNIZED":default:return o.UNRECOGNIZED}}function l(e){switch(e){case o.DIRECTION_BACKWARD_UNSPECIFIED:return"DIRECTION_BACKWARD_UNSPECIFIED";case o.DIRECTION_FORWARD:return"DIRECTION_FORWARD";default:return"UNKNOWN"}}function d(e){switch(e){case 0:case"ERROR_NONE_UNSPECIFIED":return s.ERROR_NONE_UNSPECIFIED;case 1:case"ERROR_INVALID_CURSOR":return s.ERROR_INVALID_CURSOR;case-1:case"UNRECOGNIZED":default:return s.UNRECOGNIZED}}function p(e){switch(e){case s.ERROR_NONE_UNSPECIFIED:return"ERROR_NONE_UNSPECIFIED";case s.ERROR_INVALID_CURSOR:return"ERROR_INVALID_CURSOR";default:return"UNKNOWN"}}t.protobufPackage="waku.v2",function(e){e[e.DIRECTION_BACKWARD_UNSPECIFIED=0]="DIRECTION_BACKWARD_UNSPECIFIED",e[e.DIRECTION_FORWARD=1]="DIRECTION_FORWARD",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(o=t.PagingInfo_Direction||(t.PagingInfo_Direction={})),t.pagingInfo_DirectionFromJSON=f,t.pagingInfo_DirectionToJSON=l,function(e){e[e.ERROR_NONE_UNSPECIFIED=0]="ERROR_NONE_UNSPECIFIED",e[e.ERROR_INVALID_CURSOR=1]="ERROR_INVALID_CURSOR",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(s=t.HistoryResponse_Error||(t.HistoryResponse_Error={})),t.historyResponse_ErrorFromJSON=d,t.historyResponse_ErrorToJSON=p;var v={receivedTime:0,senderTime:0};t.Index={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.default.Writer.create();return 0!==e.digest.length&&t.uint32(10).bytes(e.digest),0!==e.receivedTime&&t.uint32(17).double(e.receivedTime),0!==e.senderTime&&t.uint32(25).double(e.senderTime),t},decode:function(e,t){var n=e instanceof u.default.Reader?e:new u.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},v);for(i.digest=new Uint8Array;n.pos<r;){var o=n.uint32();switch(o>>>3){case 1:i.digest=n.bytes();break;case 2:i.receivedTime=n.double();break;case 3:i.senderTime=n.double();break;default:n.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},v);return t.digest=new Uint8Array,void 0!==e.digest&&null!==e.digest&&(t.digest=function(e){for(var t=O(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}(e.digest)),void 0!==e.receivedTime&&null!==e.receivedTime?t.receivedTime=Number(e.receivedTime):t.receivedTime=0,void 0!==e.senderTime&&null!==e.senderTime?t.senderTime=Number(e.senderTime):t.senderTime=0,t},toJSON:function(e){var t={};return void 0!==e.digest&&(t.digest=function(e){var t,n=[],i=r(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n.push(String.fromCharCode(o))}}catch(s){i.e(s)}finally{i.f()}return P(n.join(""))}(void 0!==e.digest?e.digest:new Uint8Array)),void 0!==e.receivedTime&&(t.receivedTime=e.receivedTime),void 0!==e.senderTime&&(t.senderTime=e.senderTime),t},fromPartial:function(e){var t=Object.assign({},v);return void 0!==e.digest&&null!==e.digest?t.digest=e.digest:t.digest=new Uint8Array,void 0!==e.receivedTime&&null!==e.receivedTime?t.receivedTime=e.receivedTime:t.receivedTime=0,void 0!==e.senderTime&&null!==e.senderTime?t.senderTime=e.senderTime:t.senderTime=0,t}};var g={pageSize:0,direction:0};t.PagingInfo={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.default.Writer.create();return 0!==e.pageSize&&n.uint32(8).uint64(e.pageSize),void 0!==e.cursor&&t.Index.encode(e.cursor,n.uint32(18).fork()).ldelim(),0!==e.direction&&n.uint32(24).int32(e.direction),n},decode:function(e,n){for(var r=e instanceof u.default.Reader?e:new u.default.Reader(e),i=void 0===n?r.len:r.pos+n,o=Object.assign({},g);r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.pageSize=T(r.uint64());break;case 2:o.cursor=t.Index.decode(r,r.uint32());break;case 3:o.direction=r.int32();break;default:r.skipType(7&s)}}return o},fromJSON:function(e){var n=Object.assign({},g);return void 0!==e.pageSize&&null!==e.pageSize?n.pageSize=Number(e.pageSize):n.pageSize=0,void 0!==e.cursor&&null!==e.cursor?n.cursor=t.Index.fromJSON(e.cursor):n.cursor=void 0,void 0!==e.direction&&null!==e.direction?n.direction=f(e.direction):n.direction=0,n},toJSON:function(e){var n={};return void 0!==e.pageSize&&(n.pageSize=e.pageSize),void 0!==e.cursor&&(n.cursor=e.cursor?t.Index.toJSON(e.cursor):void 0),void 0!==e.direction&&(n.direction=l(e.direction)),n},fromPartial:function(e){var n=Object.assign({},g);return void 0!==e.pageSize&&null!==e.pageSize?n.pageSize=e.pageSize:n.pageSize=0,void 0!==e.cursor&&null!==e.cursor?n.cursor=t.Index.fromPartial(e.cursor):n.cursor=void 0,void 0!==e.direction&&null!==e.direction?n.direction=e.direction:n.direction=0,n}};var h={contentTopic:""};t.ContentFilter={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.default.Writer.create();return""!==e.contentTopic&&t.uint32(10).string(e.contentTopic),t},decode:function(e,t){for(var n=e instanceof u.default.Reader?e:new u.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},h);n.pos<r;){var o=n.uint32();switch(o>>>3){case 1:i.contentTopic=n.string();break;default:n.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},h);return void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=String(e.contentTopic):t.contentTopic="",t},toJSON:function(e){var t={};return void 0!==e.contentTopic&&(t.contentTopic=e.contentTopic),t},fromPartial:function(e){var t=Object.assign({},h);return void 0!==e.contentTopic&&null!==e.contentTopic?t.contentTopic=e.contentTopic:t.contentTopic="",t}};var b={};t.HistoryQuery={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.default.Writer.create();void 0!==e.pubsubTopic&&n.uint32(18).string(e.pubsubTopic);var i,o=r(e.contentFilters);try{for(o.s();!(i=o.n()).done;){var s=i.value;t.ContentFilter.encode(s,n.uint32(26).fork()).ldelim()}}catch(a){o.e(a)}finally{o.f()}return void 0!==e.pagingInfo&&t.PagingInfo.encode(e.pagingInfo,n.uint32(34).fork()).ldelim(),void 0!==e.startTime&&n.uint32(41).double(e.startTime),void 0!==e.endTime&&n.uint32(49).double(e.endTime),n},decode:function(e,n){var r=e instanceof u.default.Reader?e:new u.default.Reader(e),i=void 0===n?r.len:r.pos+n,o=Object.assign({},b);for(o.contentFilters=[];r.pos<i;){var s=r.uint32();switch(s>>>3){case 2:o.pubsubTopic=r.string();break;case 3:o.contentFilters.push(t.ContentFilter.decode(r,r.uint32()));break;case 4:o.pagingInfo=t.PagingInfo.decode(r,r.uint32());break;case 5:o.startTime=r.double();break;case 6:o.endTime=r.double();break;default:r.skipType(7&s)}}return o},fromJSON:function(e){var n=Object.assign({},b);if(n.contentFilters=[],void 0!==e.pubsubTopic&&null!==e.pubsubTopic?n.pubsubTopic=String(e.pubsubTopic):n.pubsubTopic=void 0,void 0!==e.contentFilters&&null!==e.contentFilters){var i,o=r(e.contentFilters);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.contentFilters.push(t.ContentFilter.fromJSON(s))}}catch(a){o.e(a)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromJSON(e.pagingInfo):n.pagingInfo=void 0,void 0!==e.startTime&&null!==e.startTime?n.startTime=Number(e.startTime):n.startTime=void 0,void 0!==e.endTime&&null!==e.endTime?n.endTime=Number(e.endTime):n.endTime=void 0,n},toJSON:function(e){var n={};return void 0!==e.pubsubTopic&&(n.pubsubTopic=e.pubsubTopic),e.contentFilters?n.contentFilters=e.contentFilters.map((function(e){return e?t.ContentFilter.toJSON(e):void 0})):n.contentFilters=[],void 0!==e.pagingInfo&&(n.pagingInfo=e.pagingInfo?t.PagingInfo.toJSON(e.pagingInfo):void 0),void 0!==e.startTime&&(n.startTime=e.startTime),void 0!==e.endTime&&(n.endTime=e.endTime),n},fromPartial:function(e){var n=Object.assign({},b);if(n.contentFilters=[],void 0!==e.pubsubTopic&&null!==e.pubsubTopic?n.pubsubTopic=e.pubsubTopic:n.pubsubTopic=void 0,void 0!==e.contentFilters&&null!==e.contentFilters){var i,o=r(e.contentFilters);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.contentFilters.push(t.ContentFilter.fromPartial(s))}}catch(a){o.e(a)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromPartial(e.pagingInfo):n.pagingInfo=void 0,void 0!==e.startTime&&null!==e.startTime?n.startTime=e.startTime:n.startTime=void 0,void 0!==e.endTime&&null!==e.endTime?n.endTime=e.endTime:n.endTime=void 0,n}};var m={error:0};t.HistoryResponse={encode:function(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.default.Writer.create(),o=r(e.messages);try{for(o.s();!(n=o.n()).done;){var s=n.value;c.WakuMessage.encode(s,i.uint32(18).fork()).ldelim()}}catch(a){o.e(a)}finally{o.f()}return void 0!==e.pagingInfo&&t.PagingInfo.encode(e.pagingInfo,i.uint32(26).fork()).ldelim(),0!==e.error&&i.uint32(32).int32(e.error),i},decode:function(e,n){var r=e instanceof u.default.Reader?e:new u.default.Reader(e),i=void 0===n?r.len:r.pos+n,o=Object.assign({},m);for(o.messages=[];r.pos<i;){var s=r.uint32();switch(s>>>3){case 2:o.messages.push(c.WakuMessage.decode(r,r.uint32()));break;case 3:o.pagingInfo=t.PagingInfo.decode(r,r.uint32());break;case 4:o.error=r.int32();break;default:r.skipType(7&s)}}return o},fromJSON:function(e){var n=Object.assign({},m);if(n.messages=[],void 0!==e.messages&&null!==e.messages){var i,o=r(e.messages);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.messages.push(c.WakuMessage.fromJSON(s))}}catch(a){o.e(a)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromJSON(e.pagingInfo):n.pagingInfo=void 0,void 0!==e.error&&null!==e.error?n.error=d(e.error):n.error=0,n},toJSON:function(e){var n={};return e.messages?n.messages=e.messages.map((function(e){return e?c.WakuMessage.toJSON(e):void 0})):n.messages=[],void 0!==e.pagingInfo&&(n.pagingInfo=e.pagingInfo?t.PagingInfo.toJSON(e.pagingInfo):void 0),void 0!==e.error&&(n.error=p(e.error)),n},fromPartial:function(e){var n=Object.assign({},m);if(n.messages=[],void 0!==e.messages&&null!==e.messages){var i,o=r(e.messages);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.messages.push(c.WakuMessage.fromPartial(s))}}catch(a){o.e(a)}finally{o.f()}}return void 0!==e.pagingInfo&&null!==e.pagingInfo?n.pagingInfo=t.PagingInfo.fromPartial(e.pagingInfo):n.pagingInfo=void 0,void 0!==e.error&&null!==e.error?n.error=e.error:n.error=0,n}};var y={requestId:""};t.HistoryRPC={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.default.Writer.create();return""!==e.requestId&&n.uint32(10).string(e.requestId),void 0!==e.query&&t.HistoryQuery.encode(e.query,n.uint32(18).fork()).ldelim(),void 0!==e.response&&t.HistoryResponse.encode(e.response,n.uint32(26).fork()).ldelim(),n},decode:function(e,n){for(var r=e instanceof u.default.Reader?e:new u.default.Reader(e),i=void 0===n?r.len:r.pos+n,o=Object.assign({},y);r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.requestId=r.string();break;case 2:o.query=t.HistoryQuery.decode(r,r.uint32());break;case 3:o.response=t.HistoryResponse.decode(r,r.uint32());break;default:r.skipType(7&s)}}return o},fromJSON:function(e){var n=Object.assign({},y);return void 0!==e.requestId&&null!==e.requestId?n.requestId=String(e.requestId):n.requestId="",void 0!==e.query&&null!==e.query?n.query=t.HistoryQuery.fromJSON(e.query):n.query=void 0,void 0!==e.response&&null!==e.response?n.response=t.HistoryResponse.fromJSON(e.response):n.response=void 0,n},toJSON:function(e){var n={};return void 0!==e.requestId&&(n.requestId=e.requestId),void 0!==e.query&&(n.query=e.query?t.HistoryQuery.toJSON(e.query):void 0),void 0!==e.response&&(n.response=e.response?t.HistoryResponse.toJSON(e.response):void 0),n},fromPartial:function(e){var n=Object.assign({},y);return void 0!==e.requestId&&null!==e.requestId?n.requestId=e.requestId:n.requestId="",void 0!==e.query&&null!==e.query?n.query=t.HistoryQuery.fromPartial(e.query):n.query=void 0,void 0!==e.response&&null!==e.response?n.response=t.HistoryResponse.fromPartial(e.response):n.response=void 0,n}};var k=function(){if("undefined"!==typeof k)return k;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),O=k.atob||function(e){return k.Buffer.from(e,"base64").toString("binary")};var P=k.btoa||function(e){return k.Buffer.from(e,"binary").toString("base64")};function T(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new k.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}u.default.util.Long!==a.default&&(u.default.util.Long=a.default,u.default.configure())}).call(this,n(27))},202:function(e,t,n){"use strict";(function(e){function n(t){return"string"===typeof t?e.from(t.replace(/^0x/i,""),"hex"):e.from(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.equalByteArrays=t.bufToHex=t.hexToBuf=void 0,t.hexToBuf=n,t.bufToHex=function(t){return e.from(t).toString("hex")},t.equalByteArrays=function(t,r){var i,o;return i="string"===typeof t?n(t):e.from(t),o="string"===typeof r?n(r):e.from(r),0===i.compare(o)}}).call(this,n(6).Buffer)},277:function(e,t,n){"use strict";var r=n(1),i=n(4),o=n(3),s=n(5),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuLightPush=t.PushResponse=t.LightPushCodec=void 0;var u=a(n(278)),c=a(n(55)),f=a(n(37)),l=n(279);Object.defineProperty(t,"PushResponse",{enumerable:!0,get:function(){return l.PushResponse}});var d=n(280),p=n(79),v=n(767);t.LightPushCodec="/vac/waku/lightpush/2.0.0-beta1";var g=function(){function e(t,n){o(this,e),this.libp2p=t,(null===n||void 0===n?void 0:n.pubsubTopic)?this.pubsubTopic=n.pubsubTopic:this.pubsubTopic=p.DefaultPubsubTopic}return s(e,[{key:"push",value:function(){var e=i(r.mark((function e(n,i){var o,s,a,l,d,p,g,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===i||void 0===i?void 0:i.peerId)){e.next=6;break}if(o=this.libp2p.peerStore.get(i.peerId)){e.next=4;break}throw"Peer is unknown";case 4:e.next=7;break;case 6:o=this.randomPeer;case 7:if(o){e.next=9;break}throw"No peer available";case 9:if(o.protocols.includes(t.LightPushCodec)){e.next=11;break}throw"Peer does not register waku light push protocol";case 11:if(s=this.libp2p.connectionManager.get(o.id)){e.next=14;break}throw"Failed to get a connection to the peer";case 14:return e.next=16,s.newStream(t.LightPushCodec);case 16:return a=e.sent,l=a.stream,e.prev=18,d=(null===i||void 0===i?void 0:i.pubsubTopic)?i.pubsubTopic:this.pubsubTopic,p=v.PushRPC.createRequest(n,d),e.next=23,f.default([p.encode()],c.default.encode(),l,c.default.decode(),u.default);case 23:if(g=e.sent,e.prev=24,h=v.PushRPC.decode(g.slice()).response){e.next=29;break}return console.log("No response in PushRPC"),e.abrupt("return",null);case 29:return e.abrupt("return",h);case 32:e.prev=32,e.t0=e.catch(24),console.log("Failed to decode push reply",e.t0);case 35:e.next=40;break;case 37:e.prev=37,e.t1=e.catch(18),console.log("Failed to send waku light push request",e.t1);case 40:return e.abrupt("return",null);case 41:case"end":return e.stop()}}),e,this,[[18,37],[24,32]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"peers",get:function(){return d.getPeersForProtocol(this.libp2p,t.LightPushCodec)}},{key:"randomPeer",get:function(){return d.selectRandomPeer(this.peers)}}]),e}();t.WakuLightPush=g},279:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PushRPC=t.PushResponse=t.PushRequest=t.protobufPackage=void 0;var i=r(n(128)),o=r(n(23)),s=n(129);t.protobufPackage="waku.v2";var a={pubsubTopic:""};t.PushRequest={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.default.Writer.create();return""!==e.pubsubTopic&&t.uint32(10).string(e.pubsubTopic),void 0!==e.message&&s.WakuMessage.encode(e.message,t.uint32(18).fork()).ldelim(),t},decode:function(e,t){for(var n=e instanceof o.default.Reader?e:new o.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},a);n.pos<r;){var u=n.uint32();switch(u>>>3){case 1:i.pubsubTopic=n.string();break;case 2:i.message=s.WakuMessage.decode(n,n.uint32());break;default:n.skipType(7&u)}}return i},fromJSON:function(e){var t=Object.assign({},a);return void 0!==e.pubsubTopic&&null!==e.pubsubTopic?t.pubsubTopic=String(e.pubsubTopic):t.pubsubTopic="",void 0!==e.message&&null!==e.message?t.message=s.WakuMessage.fromJSON(e.message):t.message=void 0,t},toJSON:function(e){var t={};return void 0!==e.pubsubTopic&&(t.pubsubTopic=e.pubsubTopic),void 0!==e.message&&(t.message=e.message?s.WakuMessage.toJSON(e.message):void 0),t},fromPartial:function(e){var t=Object.assign({},a);return void 0!==e.pubsubTopic&&null!==e.pubsubTopic?t.pubsubTopic=e.pubsubTopic:t.pubsubTopic="",void 0!==e.message&&null!==e.message?t.message=s.WakuMessage.fromPartial(e.message):t.message=void 0,t}};var u={isSuccess:!1,info:""};t.PushResponse={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.default.Writer.create();return!0===e.isSuccess&&t.uint32(8).bool(e.isSuccess),""!==e.info&&t.uint32(18).string(e.info),t},decode:function(e,t){for(var n=e instanceof o.default.Reader?e:new o.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},u);n.pos<r;){var s=n.uint32();switch(s>>>3){case 1:i.isSuccess=n.bool();break;case 2:i.info=n.string();break;default:n.skipType(7&s)}}return i},fromJSON:function(e){var t=Object.assign({},u);return void 0!==e.isSuccess&&null!==e.isSuccess?t.isSuccess=Boolean(e.isSuccess):t.isSuccess=!1,void 0!==e.info&&null!==e.info?t.info=String(e.info):t.info="",t},toJSON:function(e){var t={};return void 0!==e.isSuccess&&(t.isSuccess=e.isSuccess),void 0!==e.info&&(t.info=e.info),t},fromPartial:function(e){var t=Object.assign({},u);return void 0!==e.isSuccess&&null!==e.isSuccess?t.isSuccess=e.isSuccess:t.isSuccess=!1,void 0!==e.info&&null!==e.info?t.info=e.info:t.info="",t}};var c={requestId:""};t.PushRPC={encode:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.default.Writer.create();return""!==e.requestId&&n.uint32(10).string(e.requestId),void 0!==e.request&&t.PushRequest.encode(e.request,n.uint32(18).fork()).ldelim(),void 0!==e.response&&t.PushResponse.encode(e.response,n.uint32(26).fork()).ldelim(),n},decode:function(e,n){for(var r=e instanceof o.default.Reader?e:new o.default.Reader(e),i=void 0===n?r.len:r.pos+n,s=Object.assign({},c);r.pos<i;){var a=r.uint32();switch(a>>>3){case 1:s.requestId=r.string();break;case 2:s.request=t.PushRequest.decode(r,r.uint32());break;case 3:s.response=t.PushResponse.decode(r,r.uint32());break;default:r.skipType(7&a)}}return s},fromJSON:function(e){var n=Object.assign({},c);return void 0!==e.requestId&&null!==e.requestId?n.requestId=String(e.requestId):n.requestId="",void 0!==e.request&&null!==e.request?n.request=t.PushRequest.fromJSON(e.request):n.request=void 0,void 0!==e.response&&null!==e.response?n.response=t.PushResponse.fromJSON(e.response):n.response=void 0,n},toJSON:function(e){var n={};return void 0!==e.requestId&&(n.requestId=e.requestId),void 0!==e.request&&(n.request=e.request?t.PushRequest.toJSON(e.request):void 0),void 0!==e.response&&(n.response=e.response?t.PushResponse.toJSON(e.response):void 0),n},fromPartial:function(e){var n=Object.assign({},c);return void 0!==e.requestId&&null!==e.requestId?n.requestId=e.requestId:n.requestId="",void 0!==e.request&&null!==e.request?n.request=t.PushRequest.fromPartial(e.request):n.request=void 0,void 0!==e.response&&null!==e.response?n.response=t.PushResponse.fromPartial(e.response):n.response=void 0,n}},o.default.util.Long!==i.default&&(o.default.util.Long=i.default,o.default.configure())},280:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPeersForProtocol=t.selectRandomPeer=void 0,t.selectRandomPeer=function(e){if(0!==e.length)return e[Math.round(Math.random()*(e.length-1))]},t.getPeersForProtocol=function(e,t){return Array.from(e.peerStore.peers.values()).filter((function(e){return e.protocols.includes(t)}))}},286:function(e,t,n){"use strict";var r=n(1),i=n(4),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getPublicKey=t.generatePrivateKey=t.decryptSymmetric=t.encryptSymmetric=t.decryptAsymmetric=t.encryptAsymmetric=t.clearDecode=t.clearEncode=void 0;var u=n(6),c=a(n(287)),f=a(n(760)),l=n(762),d=a(n(219)),p=n(202),v=n(188);function g(){return(g=i(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.encrypt(p.hexToBuf(n),u.Buffer.from(t)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=i(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.decrypt(u.Buffer.from(n),u.Buffer.from(t)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=i(r.mark((function e(t,n){var i,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=v.symmetric.generateIv(),e.next=3,v.symmetric.encrypt(i,p.hexToBuf(n),u.Buffer.from(t));case 3:return o=e.sent,e.abrupt("return",u.Buffer.concat([o,i]));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return(m=i(r.mark((function e(t,n){var i,o,s,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.Buffer.from(t),o=i.length-v.IvSize,s=i.slice(0,o),a=i.slice(o),e.abrupt("return",v.symmetric.decrypt(a,p.hexToBuf(n),s));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return d.publicKeyCreate(e,!1)}function k(e){for(var t=1,n=e.length;n>=256;n/=256)t++;return t}function O(e){if("undefined"!==typeof window&&window&&window.crypto){var t=new Uint8Array(e);return window.crypto.getRandomValues(t),t}return c.randomBytes(e)}t.clearEncode=function(e,t){var n=u.Buffer.from([0]);n=function(e,t){var n=k(t),r=u.Buffer.alloc(4);return r.writeUInt32LE(t.length,0),r=r.slice(0,n),(e=u.Buffer.concat([e,r]))[0]|=n,e}(n,e),n=u.Buffer.concat([n,u.Buffer.from(e)]);var r=1+k(e)+e.length;t&&(r+=65);var i,o=256-r%256,s=u.Buffer.from(O(o));if(!function(e,t){if(e.length!==t)return!1;return!(t>3&&u.Buffer.from(e).equals(u.Buffer.alloc(e.length)))}(s,o))throw new Error("failed to generate random padding of size "+o);if(n=u.Buffer.concat([n,s]),t){n[0]|=4;var a=l.keccak256(n),c=d.ecdsaSign(p.hexToBuf(a),t);n=u.Buffer.concat([n,c.signature,u.Buffer.from([c.recid])]),i={signature:u.Buffer.from(c.signature),publicKey:y(t)}}return{payload:n,sig:i}},t.clearDecode=function(e){var t,n=u.Buffer.from(e),r=1,i=3&n.readUIntLE(0,1);if(0!==i){var o=n.readUIntLE(r,i);r+=i;var s=n.slice(r,r+o),a=4==(4&n.readUIntLE(0,1));if(a){var c=function(e){return e.slice(e.length-65,e.length)}(n),f=function(e,t){var n=t.slice(64).readIntBE(0,1);return d.ecdsaRecover(t.slice(0,64),n,p.hexToBuf(e),!1)}(function(e,t){if(t)return l.keccak256(e.slice(0,e.length-65));return l.keccak256(e)}(n,a),c);t={signature:c,publicKey:f}}return{payload:s,sig:t}}},t.encryptAsymmetric=function(e,t){return g.apply(this,arguments)},t.decryptAsymmetric=function(e,t){return h.apply(this,arguments)},t.encryptSymmetric=function(e,t){return b.apply(this,arguments)},t.decryptSymmetric=function(e,t){return m.apply(this,arguments)},t.generatePrivateKey=function(){return O(32)},t.getPublicKey=y},336:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRelayPeers=void 0;var r=n(57),i=n(79);t.getRelayPeers=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},s=e.topics.get(t);if(!s)return new Set;var a=[];return s.forEach((function(t){var n=e.peers.get(t);n&&i.RelayCodecs.includes(n.protocol)&&o(t)&&a.push(t)})),a=r.shuffle(a),n>0&&a.length>n&&(a=a.slice(0,n)),new Set(a)}},337:function(e,t,n){"use strict";var r=n(1),i=n(4),o=n(3),s=n(5),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuStore=t.Direction=t.StoreCodec=void 0;var u=a(n(9)),c=a(n(278)),f=a(n(55)),l=a(n(37)),d=n(189),p=n(280),v=n(130),g=n(79),h=n(768);Object.defineProperty(t,"Direction",{enumerable:!0,get:function(){return h.Direction}});var b=u.default("waku:store");t.StoreCodec="/vac/waku/store/2.0.0-beta3";var m=function(){function e(t,n){o(this,e),this.libp2p=t,(null===n||void 0===n?void 0:n.pubsubTopic)?this.pubsubTopic=n.pubsubTopic:this.pubsubTopic=g.DefaultPubsubTopic}return s(e,[{key:"queryHistory",value:function(){var e=i(r.mark((function e(n){var o,s,a,u,p,g,m,y,k,O,P,T,_,R,S;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=Object.assign({pubsubTopic:this.pubsubTopic,direction:h.Direction.BACKWARD,pageSize:10},n),b("Querying history with the following options",n),!p.peerId){e.next=8;break}if(g=this.libp2p.peerStore.get(p.peerId)){e.next=6;break}throw"Peer is unknown";case 6:e.next=9;break;case 8:g=this.randomPeer;case 9:if(g){e.next=11;break}throw"No peer available";case 11:if(g.protocols.includes(t.StoreCodec)){e.next=13;break}throw"Peer does not register waku store protocol";case 13:if(m=this.libp2p.connectionManager.get(g.id)){e.next=16;break}throw"Failed to get a connection to the peer";case 16:y=[],k=void 0;case 18:return e.prev=19,e.next=22,m.newStream(t.StoreCodec);case 22:return O=e.sent,P=O.stream,e.prev=24,T=Object.assign(p,{cursor:k}),_=h.HistoryRPC.createQuery(T),e.next=29,l.default([_.encode()],f.default.encode(),P,f.default.decode(),c.default);case 29:return R=e.sent,e.prev=30,e.delegateYield(r.mark((function e(){var t,n,c,f,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.HistoryRPC.decode(R.slice()),n=t.response){e.next=5;break}return console.log("No response in HistoryRPC"),e.abrupt("return",{v:null});case 5:if(!n.error||n.error!==d.HistoryResponse_Error.ERROR_INVALID_CURSOR){e.next=8;break}return console.log("Error in response: INVALID CURSOR"),e.abrupt("return",{v:null});case 8:if(n.messages&&n.messages.length){e.next=11;break}return console.log("No messages present in HistoryRPC response"),e.abrupt("return",{v:y});case 11:return b("".concat(n.messages.length," messages retrieved for pubsub topic ").concat(p.pubsubTopic)),c=[],e.next=15,Promise.all(n.messages.map(function(){var e=i(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.WakuMessage.decodeProto(t,p.decryptionKeys);case 2:(n=e.sent)&&(y.push(n),c.push(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:if(p.callback&&p.callback(c),f=null===(o=n.pagingInfo)||void 0===o?void 0:o.pageSize,l=null===(a=null===(s=_.query)||void 0===s?void 0:s.pagingInfo)||void 0===a?void 0:a.pageSize,!(f&&l&&f<l)){e.next=20;break}return e.abrupt("return",{v:y});case 20:if(void 0!==(k=null===(u=n.pagingInfo)||void 0===u?void 0:u.cursor)){e.next=24;break}return console.log("No cursor returned by peer."),e.abrupt("return",{v:y});case 24:case"end":return e.stop()}}),e)}))(),"t0",32);case 32:if("object"!==typeof(S=e.t0)){e.next=35;break}return e.abrupt("return",S.v);case 35:e.next=41;break;case 37:return e.prev=37,e.t1=e.catch(30),console.log("Failed to decode store reply",e.t1),e.abrupt("return",null);case 41:e.next=47;break;case 43:return e.prev=43,e.t2=e.catch(24),console.log("Failed to send waku store query",e.t2),e.abrupt("return",null);case 47:e.next=53;break;case 49:return e.prev=49,e.t3=e.catch(19),console.log("Failed to negotiate waku store protocol stream with peer",e.t3),e.abrupt("return",null);case 53:e.next=18;break;case 55:case"end":return e.stop()}}),e,this,[[19,49],[24,43],[30,37]])})));return function(t){return e.apply(this,arguments)}}()},{key:"peers",get:function(){return p.getPeersForProtocol(this.libp2p,t.StoreCodec)}},{key:"randomPeer",get:function(){return p.selectRandomPeer(this.peers)}}]),e}();t.WakuStore=m},338:function(e,t,n){"use strict";(function(e){var r=n(12),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessage=t.protobufPackage=void 0;var o=i(n(128)),s=i(n(23));t.protobufPackage="chat.v2";var a={timestamp:0,nick:""};t.ChatMessage={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.Writer.create();return 0!==e.timestamp&&t.uint32(8).uint64(e.timestamp),""!==e.nick&&t.uint32(18).string(e.nick),0!==e.payload.length&&t.uint32(26).bytes(e.payload),t},decode:function(e,t){var n=e instanceof s.default.Reader?e:new s.default.Reader(e),r=void 0===t?n.len:n.pos+t,i=Object.assign({},a);for(i.payload=new Uint8Array;n.pos<r;){var o=n.uint32();switch(o>>>3){case 1:i.timestamp=l(n.uint64());break;case 2:i.nick=n.string();break;case 3:i.payload=n.bytes();break;default:n.skipType(7&o)}}return i},fromJSON:function(e){var t=Object.assign({},a);return t.payload=new Uint8Array,void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=Number(e.timestamp):t.timestamp=0,void 0!==e.nick&&null!==e.nick?t.nick=String(e.nick):t.nick="",void 0!==e.payload&&null!==e.payload&&(t.payload=function(e){for(var t=c(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}(e.payload)),t},toJSON:function(e){var t={};return void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.nick&&(t.nick=e.nick),void 0!==e.payload&&(t.payload=function(e){var t,n=[],i=r(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n.push(String.fromCharCode(o))}}catch(s){i.e(s)}finally{i.f()}return f(n.join(""))}(void 0!==e.payload?e.payload:new Uint8Array)),t},fromPartial:function(e){var t=Object.assign({},a);return void 0!==e.timestamp&&null!==e.timestamp?t.timestamp=e.timestamp:t.timestamp=0,void 0!==e.nick&&null!==e.nick?t.nick=e.nick:t.nick="",void 0!==e.payload&&null!==e.payload?t.payload=e.payload:t.payload=new Uint8Array,t}};var u=function(){if("undefined"!==typeof u)return u;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw"Unable to locate global object"}(),c=u.atob||function(e){return u.Buffer.from(e,"base64").toString("binary")};var f=u.btoa||function(e){return u.Buffer.from(e,"binary").toString("base64")};function l(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new u.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}s.default.util.Long!==o.default&&(s.default.util.Long=o.default,s.default.configure())}).call(this,n(27))},34:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.proto=t.StoreCodec=t.WakuStore=t.Direction=t.RelayCodecs=t.WakuRelay=t.PushResponse=t.LightPushCodec=t.WakuLightPush=t.ChatMessage=t.getPublicKey=t.generatePrivateKey=t.WakuMessage=t.Waku=t.utils=t.Protocol=t.Environment=t.getStatusFleetNodes=void 0;var s=n(360);Object.defineProperty(t,"getStatusFleetNodes",{enumerable:!0,get:function(){return s.getStatusFleetNodes}}),Object.defineProperty(t,"Environment",{enumerable:!0,get:function(){return s.Environment}}),Object.defineProperty(t,"Protocol",{enumerable:!0,get:function(){return s.Protocol}}),t.utils=o(n(202));var a=n(381);Object.defineProperty(t,"Waku",{enumerable:!0,get:function(){return a.Waku}});var u=n(130);Object.defineProperty(t,"WakuMessage",{enumerable:!0,get:function(){return u.WakuMessage}});var c=n(286);Object.defineProperty(t,"generatePrivateKey",{enumerable:!0,get:function(){return c.generatePrivateKey}}),Object.defineProperty(t,"getPublicKey",{enumerable:!0,get:function(){return c.getPublicKey}});var f=n(769);Object.defineProperty(t,"ChatMessage",{enumerable:!0,get:function(){return f.ChatMessage}});var l=n(277);Object.defineProperty(t,"WakuLightPush",{enumerable:!0,get:function(){return l.WakuLightPush}}),Object.defineProperty(t,"LightPushCodec",{enumerable:!0,get:function(){return l.LightPushCodec}}),Object.defineProperty(t,"PushResponse",{enumerable:!0,get:function(){return l.PushResponse}});var d=n(79);Object.defineProperty(t,"WakuRelay",{enumerable:!0,get:function(){return d.WakuRelay}}),Object.defineProperty(t,"RelayCodecs",{enumerable:!0,get:function(){return d.RelayCodecs}});var p=n(337);Object.defineProperty(t,"Direction",{enumerable:!0,get:function(){return p.Direction}}),Object.defineProperty(t,"WakuStore",{enumerable:!0,get:function(){return p.WakuStore}}),Object.defineProperty(t,"StoreCodec",{enumerable:!0,get:function(){return p.StoreCodec}}),t.proto=o(n(770))},341:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(29),i=n(64),o=n.n(i),s=n(34);function a(e,t,n,i,a){var u=[],c=function(e){return e.trim().replaceAll(/\s\s+/g," ").split(" ")}(e),f=c.shift();switch(f){case"/help":["/nick <nickname>: set a new nickname","/info: some information about the node","/connect <Multiaddr>: connect to the given peer","/fleet <prod|test>: connect to this fleet; beware it restarts waku node.","/help: Display this help"].map((function(e){return u.push(e)}));break;case"/nick":(function(e,t){return e?(t(e),["New nick: ".concat(e)]):["No nick provided"]})(c.shift(),n).map((function(e){return u.push(e)}));break;case"/info":(function(e,t){return e?["PeerId: ".concat(e.libp2p.peerId.toB58String()),"Fleet environment: ".concat(t)]:["Waku node is starting"]})(t,i).map((function(e){return u.push(e)}));break;case"/connect":(function(e,t){if(!t)return["Waku node is starting"];if(!e)return["No peer provided"];try{var n=Object(r.multiaddr)(e),i=n.getPeerId();return i?(t.addPeerToAddressBook(o.a.createFromB58String(i),[n]),["".concat(i,": ").concat(n.toString()," added to address book, autodial in progress")]):["Peer Id needed to dial"]}catch(s){return["Invalid multiaddr: "+s]}})(c.shift(),t).map((function(e){return u.push(e)}));break;case"/peers":(function(e){if(!e)return["Waku node is starting"];var t=[];return e.libp2p.peerStore.peers.forEach((function(e,n){t.push(n+":");var r="  addresses: [";e.addresses.forEach((function(e){var t=e.multiaddr;r+=" "+t.toString()+","})),r=r.replace(/,$/,""),r+="]",t.push(r);var i="  protocols: [";i+=e.protocols,i+="]",t.push(i)})),0===t.length&&t.push("Not connected to any peer."),t})(t).map((function(e){return u.push(e)}));break;case"/connections":(function(e){if(!e)return["Waku node is starting"];var t=[];return e.libp2p.connections.forEach((function(e,n){t.push(n+":");var r="  connections: [";e.forEach((function(e){r+=JSON.stringify(e.stat),r+="; "+JSON.stringify(e.streams)})),r+="]",t.push(r)})),0===t.length&&t.push("Not connected to any peer."),t})(t).map((function(e){return u.push(e)}));break;case"/fleet":(function(e,t,n){switch(e){case s.Environment.Test:case s.Environment.Prod:n(e);break;default:return["Incorrect values, acceptable values are ".concat(s.Environment.Test,", ").concat(s.Environment.Prod),"Current fleet environment is ".concat(t)]}return["New fleet Environment: ".concat(e)]})(c.shift(),i,a).map((function(e){return u.push(e)}));break;default:u.push("Unknown Command '".concat(f,"'"))}return{command:f,response:u}}},350:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n(1),i=n.n(r),o=n(19),s=n(34),a=n(137),u=n(42),c=n(38),f=n(0),l=n(35),d=n(17);function p(e){var t,n=Object(f.useState)([]),r=Object(c.a)(n,2),i=r[0],o=r[1],s=Object(f.useState)([]),a=Object(c.a)(s,2),p=a[0],b=a[1];g(e.newMessages,i)?(t=i.concat(e.newMessages),g(e.archivedMessages,t)&&(t=h(e.archivedMessages,t))):g(e.archivedMessages,i)&&(t=h(e.archivedMessages,i)),t&&(b(function(e){var t,n=-1,r="",i=[],o=0,s=Object(u.a)(e);try{for(s.s();!(t=s.n()).done;){var a=t.value;r!==a.nick&&(i[++n]=[],o=0,r=a.nick),i[n][o++]=a}}catch(c){s.e(c)}finally{s.f()}return i}(t)),o(t));var m=p.map((function(e){return Object(d.jsx)(l.d,{onlyFirstWithMeta:!0,children:e.map((function(e){return Object(d.jsx)(l.c,{authorName:e.nick,date:(t=e,t.timestamp.toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!1})),children:Object(d.jsx)(l.f,{children:e.payloadAsUtf8})},e.sentTimestamp?e.sentTimestamp.valueOf():""+e.timestamp.valueOf()+e.nick+e.payloadAsUtf8);var t}))})}));return Object(d.jsxs)(l.e,{active:!0,containScrollInSubtree:!0,children:[m,Object(d.jsx)(v,{newMessages:e.newMessages})]})}var v=function(e){var t=Object(f.useRef)();return Object(f.useEffect)((function(){t.current.scrollIntoView()}),[e.newMessages]),Object(d.jsx)("div",{ref:t})};function g(e,t){return 0!==e.length&&(0===t.length||!e.find((function(e){return t.find(b.bind({},e))})))}function h(e,t){var n=t.slice();return e.forEach((function(e){n.find(b.bind({},e))||n.push(e)})),n.sort((function(e,t){return e.timestamp.valueOf()-t.timestamp.valueOf()})),n}function b(e,t){var n,r;return e.nick===t.nick&&e.payloadAsUtf8===t.payloadAsUtf8&&e.timestamp.valueOf()===t.timestamp.valueOf()&&(null===(n=e.sentTimestamp)||void 0===n?void 0:n.valueOf())===(null===(r=t.sentTimestamp)||void 0===r?void 0:r.valueOf())}var m=n(87);function y(e){var t=Object(f.useState)(""),n=Object(c.a)(t,2),r=n[0],s=n[1],a=Object(m.b)().waku,u=function(){var t=Object(o.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.sendMessage){t.next=4;break}return t.next=3,e.sendMessage(r);case 3:s("");case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),p=function(){var e=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key||t.altKey||t.ctrlKey||t.shiftKey){e.next=3;break}return e.next=3,u();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=a&&0!==a.relay.getPeers().size||r.startsWith("/");return Object(d.jsx)(l.i,{onKeyDown:p,onChange:function(e){s(e.target.value)},active:v,onButtonClick:u,children:Object(d.jsxs)(l.g,{align:"center",children:[Object(d.jsx)(l.a,{children:Object(d.jsx)(l.j,{value:r})}),Object(d.jsx)(l.b,{children:Object(d.jsx)(l.h,{})})]})})}function k(e){var t=Object(m.b)().waku,n=0,r=0;return t&&(n=t.relay.getPeers().size,r=t.store.peers.length),Object(d.jsxs)("div",{className:"chat-container",style:{height:"98vh",display:"flex",flexDirection:"column"},children:[Object(d.jsx)(l.l,{leftIcons:"Peers: ".concat(n," relay, ").concat(r," store. Fleet: ").concat(e.fleetEnv),title:"Waku v2 chat app"}),Object(d.jsx)(p,{newMessages:e.newMessages,archivedMessages:e.archivedMessages}),Object(d.jsx)(y,{sendMessage:t?function(){var n=Object(o.a)(i.a.mark((function n(r){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",O(r,e.nick,e.commandHandler,t.relay.send.bind(t.relay)));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}():void 0})]})}function O(e,t,n,r){return P.apply(this,arguments)}function P(){return(P=Object(o.a)(i.a.mark((function e(t,n,r,o){var u,c,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.startsWith("/")){e.next=4;break}r(t),e.next=10;break;case 4:return u=new Date,c=s.ChatMessage.fromUtf8String(u,n,t),e.next=8,s.WakuMessage.fromBytes(c.encode(),{contentTopic:a.a,timestamp:u});case 8:return f=e.sent,e.abrupt("return",o(f));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},351:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=n(88),s=n.n(o),a=(n(357),n(137)),u=n(17);s.a.render(Object(u.jsx)(i.a.StrictMode,{children:Object(u.jsx)(a.b,{})}),document.getElementById("root"))},357:function(e,t,n){},359:function(e,t,n){},360:function(e,t,n){"use strict";var r=n(1),i=n(4),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getStatusFleetNodes=t.Environment=t.Protocol=void 0;var s,a,u=o(n(361));function c(){return(c=i(r.mark((function e(){var t,n,i,o,c=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:a.Prod,n=c.length>1&&void 0!==c[1]?c[1]:s.websocket,e.next=4,u.default.get("https://fleets.status.im/",{headers:{"Content-Type":"application/json"}});case 4:i=e.sent,o=i.data.fleets["wakuv2.".concat(t)],e.t0=n,e.next=e.t0===s.tcp?9:10;break;case 9:return e.abrupt("return",Object.values(o.waku));case 10:return e.abrupt("return",Object.values(o["waku-websocket"]));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e.websocket="websocket",e.tcp="tcp"}(s=t.Protocol||(t.Protocol={})),function(e){e.Test="test",e.Prod="prod"}(a=t.Environment||(t.Environment={})),t.getStatusFleetNodes=function(){return c.apply(this,arguments)}},381:function(e,t,n){"use strict";var r=n(52),i=n(1),o=n(4),s=n(3),a=n(5),u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Waku=void 0;var c=u(n(382)),f=u(n(582)),l=n(588),d=u(n(615)),p=u(n(274)),v=u(n(265)),g=n(29),h=u(n(64)),b=n(277),m=n(130),y=n(79),k=n(136),O=n(337),P=d.default.prototype[Symbol.toStringTag],T=function(){function e(t,n,r,i){var o=this;s(this,e),this.libp2p=n,this.relay=n.pubsub,this.store=r,this.lightPush=i,this.pingKeepAliveTimers={},this.relayKeepAliveTimers={};var a=t.pingKeepAlive||0,u=t.relayKeepAlive||300;n.connectionManager.on("peer:connect",(function(e){o.startKeepAlive(e.remotePeer,a,u)})),n.connectionManager.on("peer:disconnect",(function(e){o.stopKeepAlive(e.remotePeer)}))}return a(e,[{key:"dial",value:function(){var e=o(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.libp2p.dialProtocol(t,[O.StoreCodec].concat(y.RelayCodecs)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addPeerToAddressBook",value:function(e,t){var n;n="string"===typeof e?h.default.createFromB58String(e):e;var r=t.map((function(e){return"string"===typeof e?g.multiaddr(e):e}));this.libp2p.peerStore.addressBook.set(n,r)}},{key:"stop",value:function(){var e=o(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.libp2p.stop());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLocalMultiaddrWithID",value:function(){var e=this.libp2p.multiaddrs.find((function(e){return e.toString().match(/127\.0\.0\.1/)}));if(!e||""===e.toString())throw"Not listening on localhost";return e+"/p2p/"+this.libp2p.peerId.toB58String()}},{key:"startKeepAlive",value:function(e,t,n){var r=this;this.stopKeepAlive(e);var i=e.toB58String();0!==t&&(this.pingKeepAliveTimers[i]=setInterval((function(){v.default(r.libp2p,e)}),1e3*t)),0!==n&&(this.relayKeepAliveTimers[i]=setInterval((function(){m.WakuMessage.fromBytes(new Uint8Array,{contentTopic:k.RelayPingContentTopic}).then((function(e){return r.relay.send(e)}))}),1e3*n))}},{key:"stopKeepAlive",value:function(e){var t=e.toB58String();this.pingKeepAliveTimers[t]&&(clearInterval(this.pingKeepAliveTimers[t]),delete this.pingKeepAliveTimers[t]),this.relayKeepAliveTimers[t]&&(clearInterval(this.relayKeepAliveTimers[t]),delete this.relayKeepAliveTimers[t])}}],[{key:"create",value:function(){var t=o(i.mark((function t(n){var o,s,a,u,v,g,h;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(u=Object.assign({},null===n||void 0===n?void 0:n.libp2p)).config=Object.assign({transport:r({},P,{filter:p.default.all})},null===(o=null===n||void 0===n?void 0:n.libp2p)||void 0===o?void 0:o.config),(null===n||void 0===n?void 0:n.pubsubTopic)&&(u.config.pubsub=Object.assign({pubsubTopic:n.pubsubTopic},u.config.pubsub)),u.modules=Object.assign({},null===(s=null===n||void 0===n?void 0:n.libp2p)||void 0===s?void 0:s.modules),u.modules=Object.assign({transport:[d.default]},null===(a=null===n||void 0===n?void 0:n.libp2p)||void 0===a?void 0:a.modules),u.modules=Object.assign(u.modules,{streamMuxer:[f.default],connEncryption:[new l.Noise(null===n||void 0===n?void 0:n.staticNoiseKey)],pubsub:y.WakuRelay}),t.next=8,c.default.create(u);case 8:return v=t.sent,g=new O.WakuStore(v,{pubsubTopic:null===n||void 0===n?void 0:n.pubsubTopic}),h=new b.WakuLightPush(v),t.next=13,v.start();case 13:return t.abrupt("return",new e(n||{},v,g,h));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}();t.Waku=T},435:function(e,t){},436:function(e,t){},519:function(e,t){},573:function(e,t){},593:function(e,t){},618:function(e,t){},674:function(e,t){},676:function(e,t){},686:function(e,t){},688:function(e,t){},713:function(e,t){},715:function(e,t){},716:function(e,t){},721:function(e,t){},723:function(e,t){},742:function(e,t){},754:function(e,t){},757:function(e,t){},764:function(e,t,n){"use strict";(function(e){var r=n(1),i=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.generateIv=t.generateKeyForSymmetricEnc=t.decrypt=t.encrypt=void 0;var o=n(188),s=window.crypto||window.msCrypto,a=s.subtle||s.webkitSubtle,u={name:"AES-GCM",length:128};if(void 0===a)throw new Error("Failed to load Subtle CryptoAPI");function c(){return(c=i(r.mark((function t(n,i,o){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",a.importKey("raw",i,u,!1,["encrypt"]).then((function(e){return a.encrypt(Object.assign({iv:n},u),e,o)})).then(e.from));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(){return(f=i(r.mark((function t(n,i,o){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",a.importKey("raw",i,u,!1,["decrypt"]).then((function(e){return a.decrypt(Object.assign({iv:n},u),e,o)})).then(e.from));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}t.encrypt=function(e,t,n){return c.apply(this,arguments)},t.decrypt=function(e,t,n){return f.apply(this,arguments)},t.generateKeyForSymmetricEnc=function(){return s.getRandomValues(e.alloc(o.SymmetricKeySize))},t.generateIv=function(){var e=new Uint8Array(o.IvSize);return s.getRandomValues(e),e}}).call(this,n(6).Buffer)},765:function(e,t,n){"use strict";(function(e){var r=n(1),i=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.generateIv=t.generateKeyForSymmetricEnc=t.decrypt=t.encrypt=void 0;var o=n(287),s=n(188),a="aes-256-gcm";function u(){return(u=i(r.mark((function t(n,i,s){var u,c,f,l;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=o.createCipheriv(a,i,n),c=u.update(s),f=u.final(),l=u.getAuthTag(),t.abrupt("return",e.concat([c,f,l]));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function c(){return(c=i(r.mark((function t(n,i,u){var c,f,l,d,p,v;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=u.length-s.TagSize,f=u.slice(0,c),l=u.slice(c),(d=o.createDecipheriv(a,i,n)).setAuthTag(l),p=d.update(f),v=d.final(),t.abrupt("return",e.concat([p,v]));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}t.encrypt=function(e,t,n){return u.apply(this,arguments)},t.decrypt=function(e,t,n){return c.apply(this,arguments)},t.generateKeyForSymmetricEnc=function(){return o.randomBytes(s.SymmetricKeySize)},t.generateIv=function(){return o.randomBytes(s.IvSize)}}).call(this,n(6).Buffer)},766:function(e,t,n){"use strict";var r=n(3),i=n(5),o=n(15),s=n(16),a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),u=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return u(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RelayHeartbeat=void 0;var f=n(282),l=n(57),d=c(n(136)),p=n(336),v=function(e){o(n,e);var t=s(n);function n(e){return r(this,n),t.call(this,e)}return i(n,[{key:"start",value:function(){var e=this;if(!this._heartbeatTimer){var t=this._heartbeat.bind(this),n=setTimeout((function(){var n;t(),null===(n=e._heartbeatTimer)||void 0===n||n.runPeriodically(t,d.RelayHeartbeatInterval)}),d.RelayHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:function(t,n){e._heartbeatTimer._intervalId=setInterval(t,n)},cancel:function(){var t;clearTimeout(n),clearInterval(null===(t=e._heartbeatTimer)||void 0===t?void 0:t._intervalId)}}}}},{key:"stop",value:function(){this._heartbeatTimer&&(this._heartbeatTimer.cancel(),this._heartbeatTimer=null)}},{key:"_heartbeat",value:function(){var e=this,t=this.gossipsub._options,n=t.D,r=t.Dlo,i=t.Dhi,o=t.Dscore,s=t.Dout;this.gossipsub.heartbeatTicks++;var a=new Map,u=function(t){var n=a.get(t);return void 0===n&&(n=e.gossipsub.score.score(t),a.set(t,n)),n},c=new Map,f=new Map,v=new Map;this.gossipsub._clearBackoff(),this.gossipsub.peerhave.clear(),this.gossipsub.iasked.clear(),this.gossipsub._applyIwantPenalties(),this.gossipsub._directConnect(),this.gossipsub.mesh.forEach((function(t,a){var g=function(n){e.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",n,a),e.gossipsub.score.prune(n,a),e.gossipsub._addBackoff(n,a),t.delete(n);var r=f.get(n);r?r.push(a):f.set(n,[a])},h=function(n){e.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",n,a),e.gossipsub.score.graft(n,a),t.add(n);var r=c.get(n);r?r.push(a):c.set(n,[a])};if(t.forEach((function(t){var n=u(t);n<0&&(e.gossipsub.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",t,n,a),g(t),v.set(t,!0))})),t.size<r){var b=e.gossipsub.backoff.get(a),m=n-t.size;p.getRelayPeers(e.gossipsub,a,m,(function(n){return!t.has(n)&&!e.gossipsub.direct.has(n)&&(!b||!b.has(n))&&u(n)>=0})).forEach(h)}if(t.size>i){var y=Array.from(t);y.sort((function(e,t){return u(t)-u(e)})),y=y.slice(0,o).concat(l.shuffle(y.slice(o)));var k=0;if(y.slice(0,n).forEach((function(t){e.gossipsub.outbound.get(t)&&k++})),k<s){var O=function(e){for(var t=y[e],n=e;n>0;n--)y[n]=y[n-1];y[0]=t};if(k>0)for(var P=k,T=1;T<n&&P>0;T++)e.gossipsub.outbound.get(y[T])&&(O(T),P--);for(var _=n-k,R=n;R<y.length&&_>0;R++)e.gossipsub.outbound.get(y[R])&&(O(R),_--)}y.slice(n).forEach(g)}if(t.size>=r){var S=0;if(t.forEach((function(t){e.gossipsub.outbound.get(t)&&S++})),S<s){var I=s-S,w=e.gossipsub.backoff.get(a);p.getRelayPeers(e.gossipsub,a,I,(function(n){return!t.has(n)&&!e.gossipsub.direct.has(n)&&(!w||!w.has(n))&&u(n)>=0})).forEach(h)}}if(e.gossipsub.heartbeatTicks%d.RelayOpportunisticGraftTicks===0&&t.size>1){var j=Array.from(t).sort((function(e,t){return u(e)-u(t)})),E=t.size/2,C=u(j[E]);if(C<e.gossipsub._options.scoreThresholds.opportunisticGraftThreshold){var N=e.gossipsub.backoff.get(a);p.getRelayPeers(e.gossipsub,a,d.RelayOpportunisticGraftPeers,(function(n){return t.has(n)&&!e.gossipsub.direct.has(n)&&(!N||!N.has(n))&&u(n)>C})).forEach((function(t){e.gossipsub.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,a),h(t)}))}}e.gossipsub._emitGossip(a,t)}));var g=this.gossipsub._now();this.gossipsub.lastpub.forEach((function(t,n){t+d.RelayFanoutTTL<g&&(e.gossipsub.fanout.delete(n),e.gossipsub.lastpub.delete(n))})),this.gossipsub.fanout.forEach((function(t,r){var i=e.gossipsub.topics.get(r);if(t.forEach((function(n){(!(null===i||void 0===i?void 0:i.has(n))||u(n)<e.gossipsub._options.scoreThresholds.publishThreshold)&&t.delete(n)})),t.size<n){var o=n-t.size;p.getRelayPeers(e.gossipsub,r,o,(function(n){return!t.has(n)&&!e.gossipsub.direct.has(n)&&u(n)>=e.gossipsub._options.scoreThresholds.publishThreshold})).forEach((function(e){t.add(e)}))}e.gossipsub._emitGossip(r,t)})),this.gossipsub._sendGraftPrune(c,f,v),this.gossipsub._flush(),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}]),n}(f.Heartbeat);t.RelayHeartbeat=v},767:function(e,t,n){"use strict";var r=n(3),i=n(5),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.PushRPC=void 0;var u=n(23),c=n(339),f=a(n(279)),l=n(79),d=function(){function e(t){r(this,e),this.proto=t}return i(e,[{key:"encode",value:function(){return f.PushRPC.encode(this.proto).finish()}},{key:"query",get:function(){return this.proto.request}},{key:"response",get:function(){return this.proto.response}}],[{key:"createRequest",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.DefaultPubsubTopic;return new e({requestId:c.v4(),request:{message:t.proto,pubsubTopic:n},response:void 0})}},{key:"decode",value:function(t){return new e(f.PushRPC.decode(u.Reader.create(t)))}}]),e}();t.PushRPC=d},768:function(e,t,n){"use strict";var r=n(3),i=n(5),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.Direction=void 0;var u,c=n(23),f=n(339),l=a(n(189));!function(e){e.BACKWARD="backward",e.FORWARD="forward"}(u=t.Direction||(t.Direction={}));var d=function(){function e(t){r(this,e),this.proto=t}return i(e,[{key:"encode",value:function(){return l.HistoryRPC.encode(this.proto).finish()}},{key:"query",get:function(){return this.proto.query}},{key:"response",get:function(){return this.proto.response}}],[{key:"createQuery",value:function(t){var n=function(e){switch(e){case u.BACKWARD:return l.PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED;case u.FORWARD:return l.PagingInfo_Direction.DIRECTION_FORWARD;default:return l.PagingInfo_Direction.DIRECTION_BACKWARD_UNSPECIFIED}}(t.direction),r={pageSize:t.pageSize,cursor:t.cursor,direction:n},i=t.contentTopics.map((function(e){return{contentTopic:e}}));return new e({requestId:f.v4(),query:{pubsubTopic:t.pubsubTopic,contentFilters:i,pagingInfo:r,startTime:void 0,endTime:void 0},response:void 0})}},{key:"decode",value:function(t){return new e(l.HistoryRPC.decode(c.Reader.create(t)))}}]),e}();t.HistoryRPC=d},769:function(e,t,n){"use strict";(function(e){var r=n(3),i=n(5),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatMessage=void 0;var u=n(23),c=a(n(338)),f=function(){function t(e){r(this,t),this.proto=e}return i(t,[{key:"encode",value:function(){return c.ChatMessage.encode(this.proto).finish()}},{key:"timestamp",get:function(){return new Date(1e3*this.proto.timestamp)}},{key:"nick",get:function(){return this.proto.nick}},{key:"payloadAsUtf8",get:function(){return this.proto.payload?Array.from(this.proto.payload).map((function(e){return String.fromCharCode(e)})).join(""):""}}],[{key:"fromUtf8String",value:function(n,r,i){return new t({timestamp:Math.floor(n.valueOf()/1e3),nick:r,payload:e.from(i,"utf-8")})}},{key:"decode",value:function(e){return new t(c.ChatMessage.decode(u.Reader.create(e)))}}]),t}();t.ChatMessage=f}).call(this,n(6).Buffer)},770:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryRPC=t.HistoryResponse=t.HistoryQuery=t.ContentFilter=t.PagingInfo_Direction=t.PagingInfo=t.Index=t.WakuMessage=t.ChatMessage=void 0;var r=n(338);Object.defineProperty(t,"ChatMessage",{enumerable:!0,get:function(){return r.ChatMessage}});var i=n(129);Object.defineProperty(t,"WakuMessage",{enumerable:!0,get:function(){return i.WakuMessage}});var o=n(189);Object.defineProperty(t,"Index",{enumerable:!0,get:function(){return o.Index}}),Object.defineProperty(t,"PagingInfo",{enumerable:!0,get:function(){return o.PagingInfo}}),Object.defineProperty(t,"PagingInfo_Direction",{enumerable:!0,get:function(){return o.PagingInfo_Direction}}),Object.defineProperty(t,"ContentFilter",{enumerable:!0,get:function(){return o.ContentFilter}}),Object.defineProperty(t,"HistoryQuery",{enumerable:!0,get:function(){return o.HistoryQuery}}),Object.defineProperty(t,"HistoryResponse",{enumerable:!0,get:function(){return o.HistoryResponse}}),Object.defineProperty(t,"HistoryRPC",{enumerable:!0,get:function(){return o.HistoryRPC}})},79:function(e,t,n){"use strict";(function(e){var r=n(1),i=n(4),o=n(3),s=n(5),a=n(39),u=n(89),c=n(59),f=n(15),l=n(16),d=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),p=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&d(t,e,n);return p(t,e),t},g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WakuRelay=t.DefaultPubsubTopic=t.RelayCodecs=void 0;var h=g(n(9)),b=g(n(648)),m=n(57),y=n(672),k=g(n(64)),O=n(130),P=v(n(136)),T=n(136);Object.defineProperty(t,"DefaultPubsubTopic",{enumerable:!0,get:function(){return T.DefaultPubsubTopic}}),Object.defineProperty(t,"RelayCodecs",{enumerable:!0,get:function(){return T.RelayCodecs}});var _=n(336),R=n(766),S=h.default("waku:relay"),I=function(t){f(d,t);var n=l(d);function d(e,t){var r;o(this,d),(r=n.call(this,e,Object.assign(t,{globalSignaturePolicy:y.SignaturePolicy.StrictNoSign}))).heartbeat=new R.RelayHeartbeat(a(r)),r.observers={},r.decryptionKeys=new Set;var i=P.RelayCodecs;return Object.assign(a(r),{multicodecs:i}),r.pubsubTopic=(null===t||void 0===t?void 0:t.pubsubTopic)||P.DefaultPubsubTopic,r}return s(d,[{key:"start",value:function(){u(c(d.prototype),"start",this).call(this),this.subscribe(this.pubsubTopic)}},{key:"send",value:function(){var t=i(r.mark((function t(n){var i;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.encode(),t.next=3,u(c(d.prototype),"publish",this).call(this,this.pubsubTopic,e.from(i));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addDecryptionKey",value:function(e){this.decryptionKeys.add(e)}},{key:"deleteDecryptionKey",value:function(e){this.decryptionKeys.delete(e)}},{key:"addObserver",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===n.length?(this.observers[""]||(this.observers[""]=new Set),this.observers[""].add(e)):n.forEach((function(n){t.observers[n]||(t.observers[n]=new Set),t.observers[n].add(e)}))}},{key:"deleteObserver",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===n.length?this.observers[""]&&this.observers[""].delete(e):n.forEach((function(n){t.observers[n]&&t.observers[n].delete(e)}))}},{key:"getPeers",value:function(){var e=this;return _.getRelayPeers(this,this.pubsubTopic,this._options.D,(function(t){return e.score.score(t)>=e._options.scoreThresholds.publishThreshold}))}},{key:"subscribe",value:function(e){var t=this;this.on(e,(function(n){S("Message received on ".concat(e)),O.WakuMessage.decode(n.data,Array.from(t.decryptionKeys)).then((function(e){e?(t.observers[""]&&t.observers[""].forEach((function(t){t(e)})),e.contentTopic&&t.observers[e.contentTopic]&&t.observers[e.contentTopic].forEach((function(t){t(e)}))):S("Failed to decode Waku Message")})).catch((function(e){S("Failed to decode Waku Message",e)}))})),u(c(d.prototype),"subscribe",this).call(this,e)}},{key:"join",value:function(e){var t,n=this;if(!this.started)throw new Error("WakuRelayPubsub has not started");var r=this.fanout.get(e);if(r)r.forEach((function(e){n.score.score(e)<0&&r.delete(e)})),r.size<this._options.D&&_.getRelayPeers(this,e,this._options.D-r.size,(function(e){return!r.has(e)&&!n.direct.has(e)&&n.score.score(e)>=0})).forEach((function(e){return r.add(e)})),this.mesh.set(e,r),this.fanout.delete(e),this.lastpub.delete(e);else{var i=_.getRelayPeers(this,e,this._options.D,(function(e){return!n.direct.has(e)&&n.score.score(e)>=0}));this.mesh.set(e,i)}null===(t=this.mesh.get(e))||void 0===t||t.forEach((function(t){n.log("JOIN: Add mesh link to %s in %s",t,e),n._sendGraft(t,e)}))}},{key:"_publish",value:function(){var e=i(r.mark((function e(t){var n,i,o,s,a=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.receivedFrom!==this.peerId.toB58String()&&(this.score.deliverMessage(t),this.gossipTracer.deliverMessage(t)),n=this.getMsgId(t),i=m.messageIdToString(n),this.seenCache.put(i),this.messageCache.put(t),o=new Set,t.topicIDs.forEach((function(e){if(a.topics.get(e)){a.direct.forEach((function(e){o.add(e)}));var t=a.mesh.get(e);if(!t||!t.size){if(!(t=a.fanout.get(e))){var n=_.getRelayPeers(a,e,a._options.D,(function(e){return a.score.score(e)>=a._options.scoreThresholds.publishThreshold}));n.size>0?(t=n,a.fanout.set(e,n)):t=new Set}a.lastpub.set(e,a._now())}null===t||void 0===t||t.forEach((function(e){o.add(e)}))}})),s=m.createGossipRpc([b.default.utils.normalizeOutRpcMessage(t)]),o.forEach((function(e){e!==t.from&&a._sendRpc(e,s)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_emitGossip",value:function(e,t){var n=this,r=this.messageCache.getGossipIDs(e);if(r.length){m.shuffle(r),r.length>P.RelayMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length);var i=[],o=this.topics.get(e);if(o){o.forEach((function(e){var r=n.peers.get(e);r&&!t.has(e)&&!n.direct.has(e)&&P.RelayCodecs.includes(r.protocol)&&n.score.score(e)>=n._options.scoreThresholds.gossipThreshold&&i.push(e)}));var s=this._options.Dlazy,a=P.RelayGossipFactor*i.length;a>s&&(s=a),s>i.length?s=i.length:m.shuffle(i),i.slice(0,s).forEach((function(t){var i=r;r.length>P.RelayMaxIHaveLength&&(i=m.shuffle(i.slice()).slice(0,P.RelayMaxIHaveLength)),n._pushGossip(t,{topicID:e,messageIDs:i})}))}}}},{key:"_makePrune",value:function(e,t,n){var r=this,i=P.RelayPruneBackoff/1e3,o=[];n&&_.getRelayPeers(this,t,P.RelayPrunePeers,(function(t){return t!==e&&r.score.score(t)>=0})).forEach((function(e){var t=k.default.createFromB58String(e);o.push({peerID:t.toBytes(),signedPeerRecord:r._libp2p.peerStore.addressBook.getRawEnvelope(t)})}));return{topicID:t,peers:o,backoff:i}}}]),d}(b.default);t.WakuRelay=I}).call(this,n(6).Buffer)},87:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n(0),i=Object(r.createContext)({waku:void 0}),o=function(){return Object(r.useContext)(i)}}},[[351,1,2]]]);
//# sourceMappingURL=main.1f0fccd9.chunk.js.map